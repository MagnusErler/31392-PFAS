

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->

<!-- Mirrored from www.open3d.org/docs/release/python_example/visualization/index.html by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 14 May 2023 10:14:40 GMT -->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Visualization &mdash; Open3D 0.17.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/open3d_logo.ico"/>
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-3TQPKGV6Z3"></script>
        <script >
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-3TQPKGV6Z3');</script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="../../../../../cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="../../../../../cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latestdda6.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="prev" title="Utility" href="../utility/index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index-2.html" class="icon icon-home"> Open3D
          

          
          </a>

          
            
            
              <div class="version">
                0.17.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="http://www.open3d.org/docs/release/search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../compilation.html">Build from source</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cpp_project.html">Link Open3D in C++ projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../builddocs.html">Build documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../open3d_ml.html">Open3D-ML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../arm.html">ARM support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docker.html">Docker</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorial</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/geometry/index.html">Geometry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/t_geometry/index.html">Geometry (Tensor)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/pipelines/index.html">Pipelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/t_pipelines/index.html">Pipelines (Tensor)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/visualization/index.html">Visualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/core/index.html">Core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/data/index.html">Dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/reconstruction_system/index.html">Reconstruction system</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/t_reconstruction_system/index.html">Reconstruction system (Tensor)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/sensor/index.html">Sensor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/reference.html">Reference</a></li>
</ul>
<p class="caption"><span class="caption-text">Contribute</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../contribute/contribute.html">Contributing to Open3D</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contribute/contribution_recipes.html">Contribution methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contribute/styleguide.html">Open3D style guide</a></li>
</ul>
<p class="caption"><span class="caption-text">C++ API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../cpp_api.html">C++ documentation</a></li>
</ul>
<p class="caption"><span class="caption-text">Python API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../python_api/open3d.camera.html">open3d.camera</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../python_api/open3d.core.html">open3d.core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../python_api/open3d.data.html">open3d.data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../python_api/open3d.geometry.html">open3d.geometry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../python_api/open3d.io.html">open3d.io</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../python_api/open3d.t.html">open3d.t</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../python_api/open3d.ml.html">open3d.ml</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../python_api/open3d.pipelines.html">open3d.pipelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../python_api/open3d.utility.html">open3d.utility</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../python_api/open3d.visualization.html">open3d.visualization</a></li>
</ul>
<p class="caption"><span class="caption-text">Python Examples</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../camera/index.html">Camera</a></li>
<li class="toctree-l1"><a class="reference internal" href="../geometry/index.html">Geometry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../io/index.html">IO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pipelines/index.html">Pipelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../utility/index.html">Utility</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Visualization</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#add-geometry-py">add_geometry.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="#all-widgets-py">all_widgets.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="#customized-visualization-py">customized_visualization.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="#customized-visualization-key-action-py">customized_visualization_key_action.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="#demo-scene-py">demo_scene.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="#draw-py">draw.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="#draw-webrtc-py">draw_webrtc.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="#headless-rendering-py">headless_rendering.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="#interactive-visualization-py">interactive_visualization.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="#line-width-py">line_width.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="#load-save-viewpoint-py">load_save_viewpoint.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="#mitsuba-material-estimation-py">mitsuba_material_estimation.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="#mouse-and-point-coord-py">mouse_and_point_coord.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="#multiple-windows-py">multiple_windows.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="#non-blocking-visualization-py">non_blocking_visualization.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="#non-english-py">non_english.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="#online-processing-py">online_processing.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="#remove-geometry-py">remove_geometry.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="#render-to-image-py">render_to_image.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="#tensorboard-pytorch-py">tensorboard_pytorch.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="#tensorboard-tensorflow-py">tensorboard_tensorflow.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="#text3d-py">text3d.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="#textured-mesh-py">textured_mesh.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="#textured-model-py">textured_model.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="#to-mitsuba-py">to_mitsuba.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="#video-py">video.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="#vis-gui-py">vis_gui.py</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index-2.html">Open3D</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index-2.html">Docs</a> &raquo;</li>
        
      <li>Visualization</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="visualization">
<h1>Visualization<a class="headerlink" href="#visualization" title="Permalink to this headline">¶</a></h1>
<div class="section" id="add-geometry-py">
<h2>add_geometry.py<a class="headerlink" href="#add-geometry-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span></pre></div></td><td class="code"><div><pre><span></span><span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># -                        Open3D: www.open3d.org                            -</span>
<span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># Copyright (c) 2018-2023 www.open3d.org</span>
<span class="c1"># SPDX-License-Identifier: MIT</span>
<span class="c1"># ----------------------------------------------------------------------------</span>

<span class="kn">import</span> <span class="nn">open3d</span> <span class="k">as</span> <span class="nn">o3d</span>
<span class="kn">import</span> <span class="nn">open3d.visualization.gui</span> <span class="k">as</span> <span class="nn">gui</span>
<span class="kn">import</span> <span class="nn">open3d.visualization.rendering</span> <span class="k">as</span> <span class="nn">rendering</span>
<span class="kn">import</span> <span class="nn">platform</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="n">isMacOS</span> <span class="o">=</span> <span class="p">(</span><span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Darwin&quot;</span><span class="p">)</span>


<span class="c1"># This example shows two methods of adding geometry to an existing scene.</span>
<span class="c1"># 1) add via a UI callback (in this case a menu, but a button would be similar,</span>
<span class="c1">#    you would call `button.set_on_clicked(self.on_menu_sphere_)` when</span>
<span class="c1">#    configuring the button. See `on_menu_sphere()`.</span>
<span class="c1"># 2) add asynchronously by polling from another thread. GUI functions must be</span>
<span class="c1">#    called from the UI thread, so use Application.post_to_main_thread().</span>
<span class="c1">#    See `on_menu_random()`.</span>
<span class="c1"># Running the example will show a simple window with a Debug menu item with the</span>
<span class="c1"># two different options. The second method will add random spheres for</span>
<span class="c1"># 20 seconds, during which time you can be interacting with the scene, rotating,</span>
<span class="c1"># etc.</span>
<span class="k">class</span> <span class="nc">SpheresApp</span><span class="p">:</span>
    <span class="n">MENU_SPHERE</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">MENU_RANDOM</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">MENU_QUIT</span> <span class="o">=</span> <span class="mi">3</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_id</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Application</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">create_window</span><span class="p">(</span>
            <span class="s2">&quot;Add Spheres Example&quot;</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="mi">768</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">SceneWidget</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">scene</span> <span class="o">=</span> <span class="n">rendering</span><span class="o">.</span><span class="n">Open3DScene</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">renderer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">set_background</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">set_sun_light</span><span class="p">(</span>
            <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>  <span class="c1"># direction</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>  <span class="c1"># color</span>
            <span class="mi">100000</span><span class="p">)</span>  <span class="c1"># intensity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">enable_sun_light</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">bbox</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">AxisAlignedBoundingBox</span><span class="p">([</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">],</span>
                                                   <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">setup_camera</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="n">bbox</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="p">)</span>

        <span class="c1"># The menu is global (because the macOS menu is global), so only create</span>
        <span class="c1"># it once, no matter how many windows are created</span>
        <span class="k">if</span> <span class="n">gui</span><span class="o">.</span><span class="n">Application</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">menubar</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">isMacOS</span><span class="p">:</span>
                <span class="n">app_menu</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Menu</span><span class="p">()</span>
                <span class="n">app_menu</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="s2">&quot;Quit&quot;</span><span class="p">,</span> <span class="n">SpheresApp</span><span class="o">.</span><span class="n">MENU_QUIT</span><span class="p">)</span>
            <span class="n">debug_menu</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Menu</span><span class="p">()</span>
            <span class="n">debug_menu</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="s2">&quot;Add Sphere&quot;</span><span class="p">,</span> <span class="n">SpheresApp</span><span class="o">.</span><span class="n">MENU_SPHERE</span><span class="p">)</span>
            <span class="n">debug_menu</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="s2">&quot;Add Random Spheres&quot;</span><span class="p">,</span> <span class="n">SpheresApp</span><span class="o">.</span><span class="n">MENU_RANDOM</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">isMacOS</span><span class="p">:</span>
                <span class="n">debug_menu</span><span class="o">.</span><span class="n">add_separator</span><span class="p">()</span>
                <span class="n">debug_menu</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="s2">&quot;Quit&quot;</span><span class="p">,</span> <span class="n">SpheresApp</span><span class="o">.</span><span class="n">MENU_QUIT</span><span class="p">)</span>

            <span class="n">menu</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Menu</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">isMacOS</span><span class="p">:</span>
                <span class="c1"># macOS will name the first menu item for the running application</span>
                <span class="c1"># (in our case, probably &quot;Python&quot;), regardless of what we call</span>
                <span class="c1"># it. This is the application menu, and it is where the</span>
                <span class="c1"># About..., Preferences..., and Quit menu items typically go.</span>
                <span class="n">menu</span><span class="o">.</span><span class="n">add_menu</span><span class="p">(</span><span class="s2">&quot;Example&quot;</span><span class="p">,</span> <span class="n">app_menu</span><span class="p">)</span>
                <span class="n">menu</span><span class="o">.</span><span class="n">add_menu</span><span class="p">(</span><span class="s2">&quot;Debug&quot;</span><span class="p">,</span> <span class="n">debug_menu</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">menu</span><span class="o">.</span><span class="n">add_menu</span><span class="p">(</span><span class="s2">&quot;Debug&quot;</span><span class="p">,</span> <span class="n">debug_menu</span><span class="p">)</span>
            <span class="n">gui</span><span class="o">.</span><span class="n">Application</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">menubar</span> <span class="o">=</span> <span class="n">menu</span>

        <span class="c1"># The menubar is global, but we need to connect the menu items to the</span>
        <span class="c1"># window, so that the window can call the appropriate function when the</span>
        <span class="c1"># menu item is activated.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">set_on_menu_item_activated</span><span class="p">(</span><span class="n">SpheresApp</span><span class="o">.</span><span class="n">MENU_SPHERE</span><span class="p">,</span>
                                               <span class="bp">self</span><span class="o">.</span><span class="n">_on_menu_sphere</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">set_on_menu_item_activated</span><span class="p">(</span><span class="n">SpheresApp</span><span class="o">.</span><span class="n">MENU_RANDOM</span><span class="p">,</span>
                                               <span class="bp">self</span><span class="o">.</span><span class="n">_on_menu_random</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">set_on_menu_item_activated</span><span class="p">(</span><span class="n">SpheresApp</span><span class="o">.</span><span class="n">MENU_QUIT</span><span class="p">,</span>
                                               <span class="bp">self</span><span class="o">.</span><span class="n">_on_menu_quit</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_sphere</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_id</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">mat</span> <span class="o">=</span> <span class="n">rendering</span><span class="o">.</span><span class="n">MaterialRecord</span><span class="p">()</span>
        <span class="n">mat</span><span class="o">.</span><span class="n">base_color</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(),</span>
            <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(),</span>
            <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(),</span> <span class="mf">1.0</span>
        <span class="p">]</span>
        <span class="n">mat</span><span class="o">.</span><span class="n">shader</span> <span class="o">=</span> <span class="s2">&quot;defaultLit&quot;</span>
        <span class="n">sphere</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">TriangleMesh</span><span class="o">.</span><span class="n">create_sphere</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">sphere</span><span class="o">.</span><span class="n">compute_vertex_normals</span><span class="p">()</span>
        <span class="n">sphere</span><span class="o">.</span><span class="n">translate</span><span class="p">([</span>
            <span class="mf">10.0</span> <span class="o">*</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="mf">10.0</span> <span class="o">*</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
            <span class="mf">10.0</span> <span class="o">*</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">add_geometry</span><span class="p">(</span><span class="s2">&quot;sphere&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_id</span><span class="p">),</span> <span class="n">sphere</span><span class="p">,</span> <span class="n">mat</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_on_menu_sphere</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># GUI callbacks happen on the main thread, so we can do everything</span>
        <span class="c1"># normally here.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_sphere</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_on_menu_random</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># This adds spheres asynchronously. This pattern is useful if you have</span>
        <span class="c1"># data coming in from another source than user interaction.</span>
        <span class="k">def</span> <span class="nf">thread_main</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">):</span>
                <span class="c1"># We can only modify GUI objects on the main thread, so we</span>
                <span class="c1"># need to post the function to call to the main thread.</span>
                <span class="n">gui</span><span class="o">.</span><span class="n">Application</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">post_to_main_thread</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_sphere</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">thread_main</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_on_menu_quit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">gui</span><span class="o">.</span><span class="n">Application</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">gui</span><span class="o">.</span><span class="n">Application</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
    <span class="n">SpheresApp</span><span class="p">()</span>
    <span class="n">gui</span><span class="o">.</span><span class="n">Application</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div></td></tr></table></div>
</div>
</div>
<div class="section" id="all-widgets-py">
<h2>all_widgets.py<a class="headerlink" href="#all-widgets-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span></pre></div></td><td class="code"><div><pre><span></span><span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># -                        Open3D: www.open3d.org                            -</span>
<span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># Copyright (c) 2018-2023 www.open3d.org</span>
<span class="c1"># SPDX-License-Identifier: MIT</span>
<span class="c1"># ----------------------------------------------------------------------------</span>

<span class="kn">import</span> <span class="nn">open3d.visualization.gui</span> <span class="k">as</span> <span class="nn">gui</span>
<span class="kn">import</span> <span class="nn">os.path</span>

<span class="n">basedir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>


<span class="k">class</span> <span class="nc">ExampleWindow</span><span class="p">:</span>
    <span class="n">MENU_CHECKABLE</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">MENU_DISABLED</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">MENU_QUIT</span> <span class="o">=</span> <span class="mi">3</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Application</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">create_window</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">768</span><span class="p">)</span>
        <span class="c1"># self.window = gui.Application.instance.create_window(&quot;Test&quot;, 400, 768,</span>
        <span class="c1">#                                                        x=50, y=100)</span>
        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">window</span>  <span class="c1"># for more concise code</span>

        <span class="c1"># Rather than specifying sizes in pixels, which may vary in size based</span>
        <span class="c1"># on the monitor, especially on macOS which has 220 dpi monitors, use</span>
        <span class="c1"># the em-size. This way sizings will be proportional to the font size,</span>
        <span class="c1"># which will create a more visually consistent size across platforms.</span>
        <span class="n">em</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">theme</span><span class="o">.</span><span class="n">font_size</span>

        <span class="c1"># Widgets are laid out in layouts: gui.Horiz, gui.Vert,</span>
        <span class="c1"># gui.CollapsableVert, and gui.VGrid. By nesting the layouts we can</span>
        <span class="c1"># achieve complex designs. Usually we use a vertical layout as the</span>
        <span class="c1"># topmost widget, since widgets tend to be organized from top to bottom.</span>
        <span class="c1"># Within that, we usually have a series of horizontal layouts for each</span>
        <span class="c1"># row.</span>
        <span class="n">layout</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Vert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">gui</span><span class="o">.</span><span class="n">Margins</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">em</span><span class="p">,</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">em</span><span class="p">,</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">em</span><span class="p">,</span>
                                         <span class="mf">0.5</span> <span class="o">*</span> <span class="n">em</span><span class="p">))</span>

        <span class="c1"># Create the menu. The menu is global (because the macOS menu is global),</span>
        <span class="c1"># so only create it once.</span>
        <span class="k">if</span> <span class="n">gui</span><span class="o">.</span><span class="n">Application</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">menubar</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">menubar</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Menu</span><span class="p">()</span>
            <span class="n">test_menu</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Menu</span><span class="p">()</span>
            <span class="n">test_menu</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="s2">&quot;An option&quot;</span><span class="p">,</span> <span class="n">ExampleWindow</span><span class="o">.</span><span class="n">MENU_CHECKABLE</span><span class="p">)</span>
            <span class="n">test_menu</span><span class="o">.</span><span class="n">set_checked</span><span class="p">(</span><span class="n">ExampleWindow</span><span class="o">.</span><span class="n">MENU_CHECKABLE</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">test_menu</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="s2">&quot;Unavailable feature&quot;</span><span class="p">,</span>
                               <span class="n">ExampleWindow</span><span class="o">.</span><span class="n">MENU_DISABLED</span><span class="p">)</span>
            <span class="n">test_menu</span><span class="o">.</span><span class="n">set_enabled</span><span class="p">(</span><span class="n">ExampleWindow</span><span class="o">.</span><span class="n">MENU_DISABLED</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="n">test_menu</span><span class="o">.</span><span class="n">add_separator</span><span class="p">()</span>
            <span class="n">test_menu</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="s2">&quot;Quit&quot;</span><span class="p">,</span> <span class="n">ExampleWindow</span><span class="o">.</span><span class="n">MENU_QUIT</span><span class="p">)</span>
            <span class="c1"># On macOS the first menu item is the application menu item and will</span>
            <span class="c1"># always be the name of the application (probably &quot;Python&quot;),</span>
            <span class="c1"># regardless of what you pass in here. The application menu is</span>
            <span class="c1"># typically where About..., Preferences..., and Quit go.</span>
            <span class="n">menubar</span><span class="o">.</span><span class="n">add_menu</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span><span class="p">,</span> <span class="n">test_menu</span><span class="p">)</span>
            <span class="n">gui</span><span class="o">.</span><span class="n">Application</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">menubar</span> <span class="o">=</span> <span class="n">menubar</span>

        <span class="c1"># Each window needs to know what to do with the menu items, so we need</span>
        <span class="c1"># to tell the window how to handle menu items.</span>
        <span class="n">w</span><span class="o">.</span><span class="n">set_on_menu_item_activated</span><span class="p">(</span><span class="n">ExampleWindow</span><span class="o">.</span><span class="n">MENU_CHECKABLE</span><span class="p">,</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">_on_menu_checkable</span><span class="p">)</span>
        <span class="n">w</span><span class="o">.</span><span class="n">set_on_menu_item_activated</span><span class="p">(</span><span class="n">ExampleWindow</span><span class="o">.</span><span class="n">MENU_QUIT</span><span class="p">,</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">_on_menu_quit</span><span class="p">)</span>

        <span class="c1"># Create a file-chooser widget. One part will be a text edit widget for</span>
        <span class="c1"># the filename and clicking on the button will let the user choose using</span>
        <span class="c1"># the file dialog.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fileedit</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">TextEdit</span><span class="p">()</span>
        <span class="n">filedlgbutton</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="s2">&quot;...&quot;</span><span class="p">)</span>
        <span class="n">filedlgbutton</span><span class="o">.</span><span class="n">horizontal_padding_em</span> <span class="o">=</span> <span class="mf">0.5</span>
        <span class="n">filedlgbutton</span><span class="o">.</span><span class="n">vertical_padding_em</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">filedlgbutton</span><span class="o">.</span><span class="n">set_on_clicked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_filedlg_button</span><span class="p">)</span>

        <span class="c1"># (Create the horizontal widget for the row. This will make sure the</span>
        <span class="c1"># text editor takes up as much space as it can.)</span>
        <span class="n">fileedit_layout</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Horiz</span><span class="p">()</span>
        <span class="n">fileedit_layout</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="s2">&quot;Model file&quot;</span><span class="p">))</span>
        <span class="n">fileedit_layout</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fileedit</span><span class="p">)</span>
        <span class="n">fileedit_layout</span><span class="o">.</span><span class="n">add_fixed</span><span class="p">(</span><span class="mf">0.25</span> <span class="o">*</span> <span class="n">em</span><span class="p">)</span>
        <span class="n">fileedit_layout</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">filedlgbutton</span><span class="p">)</span>
        <span class="c1"># add to the top-level (vertical) layout</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">fileedit_layout</span><span class="p">)</span>

        <span class="c1"># Create a collapsible vertical widget, which takes up enough vertical</span>
        <span class="c1"># space for all its children when open, but only enough for text when</span>
        <span class="c1"># closed. This is useful for property pages, so the user can hide sets</span>
        <span class="c1"># of properties they rarely use. All layouts take a spacing parameter,</span>
        <span class="c1"># which is the spacinging between items in the widget, and a margins</span>
        <span class="c1"># parameter, which specifies the spacing of the left, top, right,</span>
        <span class="c1"># bottom margins. (This acts like the &#39;padding&#39; property in CSS.)</span>
        <span class="n">collapse</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">CollapsableVert</span><span class="p">(</span><span class="s2">&quot;Widgets&quot;</span><span class="p">,</span> <span class="mf">0.33</span> <span class="o">*</span> <span class="n">em</span><span class="p">,</span>
                                       <span class="n">gui</span><span class="o">.</span><span class="n">Margins</span><span class="p">(</span><span class="n">em</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_label</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="s2">&quot;Lorem ipsum dolor&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_label</span><span class="o">.</span><span class="n">text_color</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="n">collapse</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_label</span><span class="p">)</span>

        <span class="c1"># Create a checkbox. Checking or unchecking would usually be used to set</span>
        <span class="c1"># a binary property, but in this case it will show a simple message box,</span>
        <span class="c1"># which illustrates how to create simple dialogs.</span>
        <span class="n">cb</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Checkbox</span><span class="p">(</span><span class="s2">&quot;Enable some really cool effect&quot;</span><span class="p">)</span>
        <span class="n">cb</span><span class="o">.</span><span class="n">set_on_checked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_cb</span><span class="p">)</span>  <span class="c1"># set the callback function</span>
        <span class="n">collapse</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">cb</span><span class="p">)</span>

        <span class="c1"># Create a color editor. We will change the color of the orange label</span>
        <span class="c1"># above when the color changes.</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">ColorEdit</span><span class="p">()</span>
        <span class="n">color</span><span class="o">.</span><span class="n">color_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_label</span><span class="o">.</span><span class="n">text_color</span>
        <span class="n">color</span><span class="o">.</span><span class="n">set_on_value_changed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_color</span><span class="p">)</span>
        <span class="n">collapse</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>

        <span class="c1"># This is a combobox, nothing fancy here, just set a simple function to</span>
        <span class="c1"># handle the user selecting an item.</span>
        <span class="n">combo</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Combobox</span><span class="p">()</span>
        <span class="n">combo</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="s2">&quot;Show point labels&quot;</span><span class="p">)</span>
        <span class="n">combo</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="s2">&quot;Show point velocity&quot;</span><span class="p">)</span>
        <span class="n">combo</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="s2">&quot;Show bounding boxes&quot;</span><span class="p">)</span>
        <span class="n">combo</span><span class="o">.</span><span class="n">set_on_selection_changed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_combo</span><span class="p">)</span>
        <span class="n">collapse</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">combo</span><span class="p">)</span>

        <span class="c1"># This is a toggle switch, which is similar to a checkbox. To my way of</span>
        <span class="c1"># thinking the difference is subtle: a checkbox toggles properties</span>
        <span class="c1"># (for example, purely visual changes like enabling lighting) while a</span>
        <span class="c1"># toggle switch is better for changing the behavior of the app (for</span>
        <span class="c1"># example, turning on processing from the camera).</span>
        <span class="n">switch</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">ToggleSwitch</span><span class="p">(</span><span class="s2">&quot;Continuously update from camera&quot;</span><span class="p">)</span>
        <span class="n">switch</span><span class="o">.</span><span class="n">set_on_clicked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_switch</span><span class="p">)</span>
        <span class="n">collapse</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">switch</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logo_idx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">proxy</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">WidgetProxy</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">switch_proxy</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logo_idx</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">logo_idx</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">proxy</span><span class="o">.</span><span class="n">set_widget</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">logo_idx</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># Add a simple image</span>
                <span class="n">logo</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">ImageWidget</span><span class="p">(</span><span class="n">basedir</span> <span class="o">+</span> <span class="s2">&quot;/icon-32.png&quot;</span><span class="p">)</span>
                <span class="n">proxy</span><span class="o">.</span><span class="n">set_widget</span><span class="p">(</span><span class="n">logo</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">label</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span>
                    <span class="s1">&#39;Open3D: A Modern Library for 3D Data Processing&#39;</span><span class="p">)</span>
                <span class="n">proxy</span><span class="o">.</span><span class="n">set_widget</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="n">w</span><span class="o">.</span><span class="n">set_needs_layout</span><span class="p">()</span>

        <span class="n">logo_btn</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="s1">&#39;Switch Logo By WidgetProxy&#39;</span><span class="p">)</span>
        <span class="n">logo_btn</span><span class="o">.</span><span class="n">vertical_padding_em</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">logo_btn</span><span class="o">.</span><span class="n">background_color</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="n">r</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">g</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">logo_btn</span><span class="o">.</span><span class="n">set_on_clicked</span><span class="p">(</span><span class="n">switch_proxy</span><span class="p">)</span>
        <span class="n">collapse</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">logo_btn</span><span class="p">)</span>
        <span class="n">collapse</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">proxy</span><span class="p">)</span>

        <span class="c1"># Widget stack demo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_widget_idx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">hz</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Horiz</span><span class="p">(</span><span class="n">spacing</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">push_widget_btn</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="s1">&#39;Push widget&#39;</span><span class="p">)</span>
        <span class="n">push_widget_btn</span><span class="o">.</span><span class="n">vertical_padding_em</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">pop_widget_btn</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="s1">&#39;Pop widget&#39;</span><span class="p">)</span>
        <span class="n">pop_widget_btn</span><span class="o">.</span><span class="n">vertical_padding_em</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">stack</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">WidgetStack</span><span class="p">()</span>
        <span class="n">stack</span><span class="o">.</span><span class="n">set_on_top</span><span class="p">(</span><span class="k">lambda</span> <span class="n">w</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;New widget is: </span><span class="si">{</span><span class="n">w</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">))</span>
        <span class="n">hz</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="s1">&#39;WidgetStack &#39;</span><span class="p">))</span>
        <span class="n">hz</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">push_widget_btn</span><span class="p">)</span>
        <span class="n">hz</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">pop_widget_btn</span><span class="p">)</span>
        <span class="n">hz</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">stack</span><span class="p">)</span>
        <span class="n">collapse</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">hz</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">push_widget</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_widget_idx</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">stack</span><span class="o">.</span><span class="n">push_widget</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Widget </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_widget_idx</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">))</span>

        <span class="n">push_widget_btn</span><span class="o">.</span><span class="n">set_on_clicked</span><span class="p">(</span><span class="n">push_widget</span><span class="p">)</span>
        <span class="n">pop_widget_btn</span><span class="o">.</span><span class="n">set_on_clicked</span><span class="p">(</span><span class="n">stack</span><span class="o">.</span><span class="n">pop_widget</span><span class="p">)</span>

        <span class="c1"># Add a list of items</span>
        <span class="n">lv</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">ListView</span><span class="p">()</span>
        <span class="n">lv</span><span class="o">.</span><span class="n">set_items</span><span class="p">([</span><span class="s2">&quot;Ground&quot;</span><span class="p">,</span> <span class="s2">&quot;Trees&quot;</span><span class="p">,</span> <span class="s2">&quot;Buildings&quot;</span><span class="p">,</span> <span class="s2">&quot;Cars&quot;</span><span class="p">,</span> <span class="s2">&quot;People&quot;</span><span class="p">,</span> <span class="s2">&quot;Cats&quot;</span><span class="p">])</span>
        <span class="n">lv</span><span class="o">.</span><span class="n">selected_index</span> <span class="o">=</span> <span class="n">lv</span><span class="o">.</span><span class="n">selected_index</span> <span class="o">+</span> <span class="mi">2</span>  <span class="c1"># initially is -1, so now 1</span>
        <span class="n">lv</span><span class="o">.</span><span class="n">set_max_visible_items</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">lv</span><span class="o">.</span><span class="n">set_on_selection_changed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_list</span><span class="p">)</span>
        <span class="n">collapse</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">lv</span><span class="p">)</span>

        <span class="c1"># Add a tree view</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">TreeView</span><span class="p">()</span>
        <span class="n">tree</span><span class="o">.</span><span class="n">add_text_item</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">get_root_item</span><span class="p">(),</span> <span class="s2">&quot;Camera&quot;</span><span class="p">)</span>
        <span class="n">geo_id</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">add_text_item</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">get_root_item</span><span class="p">(),</span> <span class="s2">&quot;Geometries&quot;</span><span class="p">)</span>
        <span class="n">mesh_id</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">add_text_item</span><span class="p">(</span><span class="n">geo_id</span><span class="p">,</span> <span class="s2">&quot;Mesh&quot;</span><span class="p">)</span>
        <span class="n">tree</span><span class="o">.</span><span class="n">add_text_item</span><span class="p">(</span><span class="n">mesh_id</span><span class="p">,</span> <span class="s2">&quot;Triangles&quot;</span><span class="p">)</span>
        <span class="n">tree</span><span class="o">.</span><span class="n">add_text_item</span><span class="p">(</span><span class="n">mesh_id</span><span class="p">,</span> <span class="s2">&quot;Albedo texture&quot;</span><span class="p">)</span>
        <span class="n">tree</span><span class="o">.</span><span class="n">add_text_item</span><span class="p">(</span><span class="n">mesh_id</span><span class="p">,</span> <span class="s2">&quot;Normal map&quot;</span><span class="p">)</span>
        <span class="n">points_id</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">add_text_item</span><span class="p">(</span><span class="n">geo_id</span><span class="p">,</span> <span class="s2">&quot;Points&quot;</span><span class="p">)</span>
        <span class="n">tree</span><span class="o">.</span><span class="n">can_select_items_with_children</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">tree</span><span class="o">.</span><span class="n">set_on_selection_changed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_tree</span><span class="p">)</span>
        <span class="c1"># does not call on_selection_changed: user did not change selection</span>
        <span class="n">tree</span><span class="o">.</span><span class="n">selected_item</span> <span class="o">=</span> <span class="n">points_id</span>
        <span class="n">collapse</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>

        <span class="c1"># Add two number editors, one for integers and one for floating point</span>
        <span class="c1"># Number editor can clamp numbers to a range, although this is more</span>
        <span class="c1"># useful for integers than for floating point.</span>
        <span class="n">intedit</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">NumberEdit</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">NumberEdit</span><span class="o">.</span><span class="n">INT</span><span class="p">)</span>
        <span class="n">intedit</span><span class="o">.</span><span class="n">int_value</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">intedit</span><span class="o">.</span><span class="n">set_limits</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">19</span><span class="p">)</span>  <span class="c1"># value coerced to 1</span>
        <span class="n">intedit</span><span class="o">.</span><span class="n">int_value</span> <span class="o">=</span> <span class="n">intedit</span><span class="o">.</span><span class="n">int_value</span> <span class="o">+</span> <span class="mi">2</span>  <span class="c1"># value should be 3</span>
        <span class="n">doubleedit</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">NumberEdit</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">NumberEdit</span><span class="o">.</span><span class="n">DOUBLE</span><span class="p">)</span>
        <span class="n">numlayout</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Horiz</span><span class="p">()</span>
        <span class="n">numlayout</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">))</span>
        <span class="n">numlayout</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">intedit</span><span class="p">)</span>
        <span class="n">numlayout</span><span class="o">.</span><span class="n">add_fixed</span><span class="p">(</span><span class="n">em</span><span class="p">)</span>  <span class="c1"># manual spacing (could set it in Horiz() ctor)</span>
        <span class="n">numlayout</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="s2">&quot;double&quot;</span><span class="p">))</span>
        <span class="n">numlayout</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">doubleedit</span><span class="p">)</span>
        <span class="n">collapse</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">numlayout</span><span class="p">)</span>

        <span class="c1"># Create a progress bar. It ranges from 0.0 to 1.0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_progress</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">ProgressBar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_progress</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mf">0.25</span>  <span class="c1"># 25% complete</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_progress</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_progress</span><span class="o">.</span><span class="n">value</span> <span class="o">+</span> <span class="mf">0.08</span>  <span class="c1"># 0.25 + 0.08 = 33%</span>
        <span class="n">prog_layout</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Horiz</span><span class="p">(</span><span class="n">em</span><span class="p">)</span>
        <span class="n">prog_layout</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="s2">&quot;Progress...&quot;</span><span class="p">))</span>
        <span class="n">prog_layout</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_progress</span><span class="p">)</span>
        <span class="n">collapse</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">prog_layout</span><span class="p">)</span>

        <span class="c1"># Create a slider. It acts very similar to NumberEdit except that the</span>
        <span class="c1"># user moves a slider and cannot type the number.</span>
        <span class="n">slider</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Slider</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">Slider</span><span class="o">.</span><span class="n">INT</span><span class="p">)</span>
        <span class="n">slider</span><span class="o">.</span><span class="n">set_limits</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">13</span><span class="p">)</span>
        <span class="n">slider</span><span class="o">.</span><span class="n">set_on_value_changed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_slider</span><span class="p">)</span>
        <span class="n">collapse</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">slider</span><span class="p">)</span>

        <span class="c1"># Create a text editor. The placeholder text (if not empty) will be</span>
        <span class="c1"># displayed when there is no text, as concise help, or visible tooltip.</span>
        <span class="n">tedit</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">TextEdit</span><span class="p">()</span>
        <span class="n">tedit</span><span class="o">.</span><span class="n">placeholder_text</span> <span class="o">=</span> <span class="s2">&quot;Edit me some text here&quot;</span>

        <span class="c1"># on_text_changed fires whenever the user changes the text (but not if</span>
        <span class="c1"># the text_value property is assigned to).</span>
        <span class="n">tedit</span><span class="o">.</span><span class="n">set_on_text_changed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_text_changed</span><span class="p">)</span>

        <span class="c1"># on_value_changed fires whenever the user signals that they are finished</span>
        <span class="c1"># editing the text, either by pressing return or by clicking outside of</span>
        <span class="c1"># the text editor, thus losing text focus.</span>
        <span class="n">tedit</span><span class="o">.</span><span class="n">set_on_value_changed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_value_changed</span><span class="p">)</span>
        <span class="n">collapse</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">tedit</span><span class="p">)</span>

        <span class="c1"># Create a widget for showing/editing a 3D vector</span>
        <span class="n">vedit</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">VectorEdit</span><span class="p">()</span>
        <span class="n">vedit</span><span class="o">.</span><span class="n">vector_value</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
        <span class="n">vedit</span><span class="o">.</span><span class="n">set_on_value_changed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_vedit</span><span class="p">)</span>
        <span class="n">collapse</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">vedit</span><span class="p">)</span>

        <span class="c1"># Create a VGrid layout. This layout specifies the number of columns</span>
        <span class="c1"># (two, in this case), and will place the first child in the first</span>
        <span class="c1"># column, the second in the second, the third in the first, the fourth</span>
        <span class="c1"># in the second, etc.</span>
        <span class="c1"># So:</span>
        <span class="c1">#      2 cols             3 cols                  4 cols</span>
        <span class="c1">#   |  1  |  2  |   |  1  |  2  |  3  |   |  1  |  2  |  3  |  4  |</span>
        <span class="c1">#   |  3  |  4  |   |  4  |  5  |  6  |   |  5  |  6  |  7  |  8  |</span>
        <span class="c1">#   |  5  |  6  |   |  7  |  8  |  9  |   |  9  | 10  | 11  | 12  |</span>
        <span class="c1">#   |    ...    |   |       ...       |   |         ...           |</span>
        <span class="n">vgrid</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">VGrid</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">vgrid</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="s2">&quot;Trees&quot;</span><span class="p">))</span>
        <span class="n">vgrid</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="s2">&quot;12 items&quot;</span><span class="p">))</span>
        <span class="n">vgrid</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="s2">&quot;People&quot;</span><span class="p">))</span>
        <span class="n">vgrid</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="s2">&quot;2 (93</span><span class="si">% c</span><span class="s2">ertainty)&quot;</span><span class="p">))</span>
        <span class="n">vgrid</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="s2">&quot;Cars&quot;</span><span class="p">))</span>
        <span class="n">vgrid</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="s2">&quot;5 (87</span><span class="si">% c</span><span class="s2">ertainty)&quot;</span><span class="p">))</span>
        <span class="n">collapse</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">vgrid</span><span class="p">)</span>

        <span class="c1"># Create a tab control. This is really a set of N layouts on top of each</span>
        <span class="c1"># other, but with only one selected.</span>
        <span class="n">tabs</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">TabControl</span><span class="p">()</span>
        <span class="n">tab1</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Vert</span><span class="p">()</span>
        <span class="n">tab1</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">Checkbox</span><span class="p">(</span><span class="s2">&quot;Enable option 1&quot;</span><span class="p">))</span>
        <span class="n">tab1</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">Checkbox</span><span class="p">(</span><span class="s2">&quot;Enable option 2&quot;</span><span class="p">))</span>
        <span class="n">tab1</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">Checkbox</span><span class="p">(</span><span class="s2">&quot;Enable option 3&quot;</span><span class="p">))</span>
        <span class="n">tabs</span><span class="o">.</span><span class="n">add_tab</span><span class="p">(</span><span class="s2">&quot;Options&quot;</span><span class="p">,</span> <span class="n">tab1</span><span class="p">)</span>
        <span class="n">tab2</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Vert</span><span class="p">()</span>
        <span class="n">tab2</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="s2">&quot;No plugins detected&quot;</span><span class="p">))</span>
        <span class="n">tab2</span><span class="o">.</span><span class="n">add_stretch</span><span class="p">()</span>
        <span class="n">tabs</span><span class="o">.</span><span class="n">add_tab</span><span class="p">(</span><span class="s2">&quot;Plugins&quot;</span><span class="p">,</span> <span class="n">tab2</span><span class="p">)</span>
        <span class="n">tab3</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">RadioButton</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">RadioButton</span><span class="o">.</span><span class="n">VERT</span><span class="p">)</span>
        <span class="n">tab3</span><span class="o">.</span><span class="n">set_items</span><span class="p">([</span><span class="s2">&quot;Apple&quot;</span><span class="p">,</span> <span class="s2">&quot;Orange&quot;</span><span class="p">])</span>

        <span class="k">def</span> <span class="nf">vt_changed</span><span class="p">(</span><span class="n">idx</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;current cargo: </span><span class="si">{</span><span class="n">tab3</span><span class="o">.</span><span class="n">selected_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">tab3</span><span class="o">.</span><span class="n">set_on_selection_changed</span><span class="p">(</span><span class="n">vt_changed</span><span class="p">)</span>
        <span class="n">tabs</span><span class="o">.</span><span class="n">add_tab</span><span class="p">(</span><span class="s2">&quot;Cargo&quot;</span><span class="p">,</span> <span class="n">tab3</span><span class="p">)</span>
        <span class="n">tab4</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">RadioButton</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">RadioButton</span><span class="o">.</span><span class="n">HORIZ</span><span class="p">)</span>
        <span class="n">tab4</span><span class="o">.</span><span class="n">set_items</span><span class="p">([</span><span class="s2">&quot;Air plane&quot;</span><span class="p">,</span> <span class="s2">&quot;Train&quot;</span><span class="p">,</span> <span class="s2">&quot;Bus&quot;</span><span class="p">])</span>

        <span class="k">def</span> <span class="nf">hz_changed</span><span class="p">(</span><span class="n">idx</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;current traffic plan: </span><span class="si">{</span><span class="n">tab4</span><span class="o">.</span><span class="n">selected_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">tab4</span><span class="o">.</span><span class="n">set_on_selection_changed</span><span class="p">(</span><span class="n">hz_changed</span><span class="p">)</span>
        <span class="n">tabs</span><span class="o">.</span><span class="n">add_tab</span><span class="p">(</span><span class="s2">&quot;Traffic&quot;</span><span class="p">,</span> <span class="n">tab4</span><span class="p">)</span>
        <span class="n">collapse</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">tabs</span><span class="p">)</span>

        <span class="c1"># Quit button. (Typically this is a menu item)</span>
        <span class="n">button_layout</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Horiz</span><span class="p">()</span>
        <span class="n">ok_button</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="s2">&quot;Ok&quot;</span><span class="p">)</span>
        <span class="n">ok_button</span><span class="o">.</span><span class="n">set_on_clicked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_ok</span><span class="p">)</span>
        <span class="n">button_layout</span><span class="o">.</span><span class="n">add_stretch</span><span class="p">()</span>
        <span class="n">button_layout</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">ok_button</span><span class="p">)</span>

        <span class="n">layout</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">collapse</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">button_layout</span><span class="p">)</span>

        <span class="c1"># We&#39;re done, set the window&#39;s layout</span>
        <span class="n">w</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">layout</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_on_filedlg_button</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">filedlg</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">FileDialog</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">FileDialog</span><span class="o">.</span><span class="n">OPEN</span><span class="p">,</span> <span class="s2">&quot;Select file&quot;</span><span class="p">,</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">theme</span><span class="p">)</span>
        <span class="n">filedlg</span><span class="o">.</span><span class="n">add_filter</span><span class="p">(</span><span class="s2">&quot;.obj .ply .stl&quot;</span><span class="p">,</span> <span class="s2">&quot;Triangle mesh (.obj, .ply, .stl)&quot;</span><span class="p">)</span>
        <span class="n">filedlg</span><span class="o">.</span><span class="n">add_filter</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;All files&quot;</span><span class="p">)</span>
        <span class="n">filedlg</span><span class="o">.</span><span class="n">set_on_cancel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_filedlg_cancel</span><span class="p">)</span>
        <span class="n">filedlg</span><span class="o">.</span><span class="n">set_on_done</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_filedlg_done</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">show_dialog</span><span class="p">(</span><span class="n">filedlg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_on_filedlg_cancel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">close_dialog</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_on_filedlg_done</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fileedit</span><span class="o">.</span><span class="n">text_value</span> <span class="o">=</span> <span class="n">path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">close_dialog</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_on_cb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_checked</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">is_checked</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Sorry, effects are unimplemented&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Good choice&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show_message_dialog</span><span class="p">(</span><span class="s2">&quot;There might be a problem...&quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_on_switch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_on</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">is_on</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Camera would now be running&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Camera would now be off&quot;</span><span class="p">)</span>

    <span class="c1"># This function is essentially the same as window.show_message_box(),</span>
    <span class="c1"># so for something this simple just use that, but it illustrates making a</span>
    <span class="c1"># dialog.</span>
    <span class="k">def</span> <span class="nf">show_message_dialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="c1"># A Dialog is just a widget, so you make its child a layout just like</span>
        <span class="c1"># a Window.</span>
        <span class="n">dlg</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Dialog</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

        <span class="c1"># Add the message text</span>
        <span class="n">em</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">theme</span><span class="o">.</span><span class="n">font_size</span>
        <span class="n">dlg_layout</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Vert</span><span class="p">(</span><span class="n">em</span><span class="p">,</span> <span class="n">gui</span><span class="o">.</span><span class="n">Margins</span><span class="p">(</span><span class="n">em</span><span class="p">,</span> <span class="n">em</span><span class="p">,</span> <span class="n">em</span><span class="p">,</span> <span class="n">em</span><span class="p">))</span>
        <span class="n">dlg_layout</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="n">message</span><span class="p">))</span>

        <span class="c1"># Add the Ok button. We need to define a callback function to handle</span>
        <span class="c1"># the click.</span>
        <span class="n">ok_button</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="s2">&quot;Ok&quot;</span><span class="p">)</span>
        <span class="n">ok_button</span><span class="o">.</span><span class="n">set_on_clicked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_dialog_ok</span><span class="p">)</span>

        <span class="c1"># We want the Ok button to be an the right side, so we need to add</span>
        <span class="c1"># a stretch item to the layout, otherwise the button will be the size</span>
        <span class="c1"># of the entire row. A stretch item takes up as much space as it can,</span>
        <span class="c1"># which forces the button to be its minimum size.</span>
        <span class="n">button_layout</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Horiz</span><span class="p">()</span>
        <span class="n">button_layout</span><span class="o">.</span><span class="n">add_stretch</span><span class="p">()</span>
        <span class="n">button_layout</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">ok_button</span><span class="p">)</span>

        <span class="c1"># Add the button layout,</span>
        <span class="n">dlg_layout</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">button_layout</span><span class="p">)</span>
        <span class="c1"># ... then add the layout as the child of the Dialog</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">dlg_layout</span><span class="p">)</span>
        <span class="c1"># ... and now we can show the dialog</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">show_dialog</span><span class="p">(</span><span class="n">dlg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_on_dialog_ok</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">close_dialog</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_on_color</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_color</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_label</span><span class="o">.</span><span class="n">text_color</span> <span class="o">=</span> <span class="n">new_color</span>

    <span class="k">def</span> <span class="nf">_on_combo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_val</span><span class="p">,</span> <span class="n">new_idx</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">new_idx</span><span class="p">,</span> <span class="n">new_val</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_on_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_val</span><span class="p">,</span> <span class="n">is_dbl_click</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">new_val</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_on_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_item_id</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">new_item_id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_on_slider</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_progress</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">new_val</span> <span class="o">/</span> <span class="mf">20.0</span>

    <span class="k">def</span> <span class="nf">_on_text_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_text</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;edit:&quot;</span><span class="p">,</span> <span class="n">new_text</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_on_value_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_text</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;value:&quot;</span><span class="p">,</span> <span class="n">new_text</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_on_vedit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_val</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">new_val</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_on_ok</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">gui</span><span class="o">.</span><span class="n">Application</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_on_menu_checkable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">gui</span><span class="o">.</span><span class="n">Application</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">menubar</span><span class="o">.</span><span class="n">set_checked</span><span class="p">(</span>
            <span class="n">ExampleWindow</span><span class="o">.</span><span class="n">MENU_CHECKABLE</span><span class="p">,</span>
            <span class="ow">not</span> <span class="n">gui</span><span class="o">.</span><span class="n">Application</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">menubar</span><span class="o">.</span><span class="n">is_checked</span><span class="p">(</span>
                <span class="n">ExampleWindow</span><span class="o">.</span><span class="n">MENU_CHECKABLE</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_on_menu_quit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">gui</span><span class="o">.</span><span class="n">Application</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>


<span class="c1"># This class is essentially the same as window.show_message_box(),</span>
<span class="c1"># so for something this simple just use that, but it illustrates making a</span>
<span class="c1"># dialog.</span>
<span class="k">class</span> <span class="nc">MessageBox</span><span class="p">:</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_window</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># A Dialog is just a widget, so you make its child a layout just like</span>
        <span class="c1"># a Window.</span>
        <span class="n">dlg</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Dialog</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

        <span class="c1"># Add the message text</span>
        <span class="n">em</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">theme</span><span class="o">.</span><span class="n">font_size</span>
        <span class="n">dlg_layout</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Vert</span><span class="p">(</span><span class="n">em</span><span class="p">,</span> <span class="n">gui</span><span class="o">.</span><span class="n">Margins</span><span class="p">(</span><span class="n">em</span><span class="p">,</span> <span class="n">em</span><span class="p">,</span> <span class="n">em</span><span class="p">,</span> <span class="n">em</span><span class="p">))</span>
        <span class="n">dlg_layout</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="n">message</span><span class="p">))</span>

        <span class="c1"># Add the Ok button. We need to define a callback function to handle</span>
        <span class="c1"># the click.</span>
        <span class="n">ok_button</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="s2">&quot;Ok&quot;</span><span class="p">)</span>
        <span class="n">ok_button</span><span class="o">.</span><span class="n">set_on_clicked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_ok</span><span class="p">)</span>

        <span class="c1"># We want the Ok button to be an the right side, so we need to add</span>
        <span class="c1"># a stretch item to the layout, otherwise the button will be the size</span>
        <span class="c1"># of the entire row. A stretch item takes up as much space as it can,</span>
        <span class="c1"># which forces the button to be its minimum size.</span>
        <span class="n">button_layout</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Horiz</span><span class="p">()</span>
        <span class="n">button_layout</span><span class="o">.</span><span class="n">add_stretch</span><span class="p">()</span>
        <span class="n">button_layout</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">ok_button</span><span class="p">)</span>

        <span class="c1"># Add the button layout,</span>
        <span class="n">dlg_layout</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">button_layout</span><span class="p">)</span>
        <span class="c1"># ... then add the layout as the child of the Dialog</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">dlg_layout</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_window</span> <span class="o">=</span> <span class="n">window</span>

    <span class="k">def</span> <span class="nf">_on_ok</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_window</span><span class="o">.</span><span class="n">close_dialog</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="c1"># We need to initialize the application, which finds the necessary shaders for</span>
    <span class="c1"># rendering and prepares the cross-platform window abstraction.</span>
    <span class="n">gui</span><span class="o">.</span><span class="n">Application</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>

    <span class="n">w</span> <span class="o">=</span> <span class="n">ExampleWindow</span><span class="p">()</span>

    <span class="c1"># Run the event loop. This will not return until the last window is closed.</span>
    <span class="n">gui</span><span class="o">.</span><span class="n">Application</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div></td></tr></table></div>
</div>
</div>
<div class="section" id="customized-visualization-py">
<h2>customized_visualization.py<a class="headerlink" href="#customized-visualization-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span></pre></div></td><td class="code"><div><pre><span></span><span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># -                        Open3D: www.open3d.org                            -</span>
<span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># Copyright (c) 2018-2023 www.open3d.org</span>
<span class="c1"># SPDX-License-Identifier: MIT</span>
<span class="c1"># ----------------------------------------------------------------------------</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">open3d</span> <span class="k">as</span> <span class="nn">o3d</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">pyexample_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)))</span>
<span class="n">test_data_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">pyexample_path</span><span class="p">),</span> <span class="s1">&#39;test_data&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">custom_draw_geometry</span><span class="p">(</span><span class="n">pcd</span><span class="p">):</span>
    <span class="c1"># The following code achieves the same effect as:</span>
    <span class="c1"># o3d.visualization.draw_geometries([pcd])</span>
    <span class="n">vis</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">Visualizer</span><span class="p">()</span>
    <span class="n">vis</span><span class="o">.</span><span class="n">create_window</span><span class="p">()</span>
    <span class="n">vis</span><span class="o">.</span><span class="n">add_geometry</span><span class="p">(</span><span class="n">pcd</span><span class="p">)</span>
    <span class="n">vis</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">vis</span><span class="o">.</span><span class="n">destroy_window</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">custom_draw_geometry_with_custom_fov</span><span class="p">(</span><span class="n">pcd</span><span class="p">,</span> <span class="n">fov_step</span><span class="p">):</span>
    <span class="n">vis</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">Visualizer</span><span class="p">()</span>
    <span class="n">vis</span><span class="o">.</span><span class="n">create_window</span><span class="p">()</span>
    <span class="n">vis</span><span class="o">.</span><span class="n">add_geometry</span><span class="p">(</span><span class="n">pcd</span><span class="p">)</span>
    <span class="n">ctr</span> <span class="o">=</span> <span class="n">vis</span><span class="o">.</span><span class="n">get_view_control</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Field of view (before changing) </span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ctr</span><span class="o">.</span><span class="n">get_field_of_view</span><span class="p">())</span>
    <span class="n">ctr</span><span class="o">.</span><span class="n">change_field_of_view</span><span class="p">(</span><span class="n">step</span><span class="o">=</span><span class="n">fov_step</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Field of view (after changing) </span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ctr</span><span class="o">.</span><span class="n">get_field_of_view</span><span class="p">())</span>
    <span class="n">vis</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">vis</span><span class="o">.</span><span class="n">destroy_window</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">custom_draw_geometry_with_rotation</span><span class="p">(</span><span class="n">pcd</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">rotate_view</span><span class="p">(</span><span class="n">vis</span><span class="p">):</span>
        <span class="n">ctr</span> <span class="o">=</span> <span class="n">vis</span><span class="o">.</span><span class="n">get_view_control</span><span class="p">()</span>
        <span class="n">ctr</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="n">o3d</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">draw_geometries_with_animation_callback</span><span class="p">([</span><span class="n">pcd</span><span class="p">],</span>
                                                              <span class="n">rotate_view</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">custom_draw_geometry_load_option</span><span class="p">(</span><span class="n">pcd</span><span class="p">,</span> <span class="n">render_option_path</span><span class="p">):</span>
    <span class="n">vis</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">Visualizer</span><span class="p">()</span>
    <span class="n">vis</span><span class="o">.</span><span class="n">create_window</span><span class="p">()</span>
    <span class="n">vis</span><span class="o">.</span><span class="n">add_geometry</span><span class="p">(</span><span class="n">pcd</span><span class="p">)</span>
    <span class="n">vis</span><span class="o">.</span><span class="n">get_render_option</span><span class="p">()</span><span class="o">.</span><span class="n">load_from_json</span><span class="p">(</span><span class="n">render_option_path</span><span class="p">)</span>
    <span class="n">vis</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">vis</span><span class="o">.</span><span class="n">destroy_window</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">custom_draw_geometry_with_key_callback</span><span class="p">(</span><span class="n">pcd</span><span class="p">,</span> <span class="n">render_option_path</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">change_background_to_black</span><span class="p">(</span><span class="n">vis</span><span class="p">):</span>
        <span class="n">opt</span> <span class="o">=</span> <span class="n">vis</span><span class="o">.</span><span class="n">get_render_option</span><span class="p">()</span>
        <span class="n">opt</span><span class="o">.</span><span class="n">background_color</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">load_render_option</span><span class="p">(</span><span class="n">vis</span><span class="p">):</span>
        <span class="n">vis</span><span class="o">.</span><span class="n">get_render_option</span><span class="p">()</span><span class="o">.</span><span class="n">load_from_json</span><span class="p">(</span><span class="n">render_option_path</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">capture_depth</span><span class="p">(</span><span class="n">vis</span><span class="p">):</span>
        <span class="n">depth</span> <span class="o">=</span> <span class="n">vis</span><span class="o">.</span><span class="n">capture_depth_float_buffer</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">depth</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">capture_image</span><span class="p">(</span><span class="n">vis</span><span class="p">):</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">vis</span><span class="o">.</span><span class="n">capture_screen_float_buffer</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">image</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="n">key_to_callback</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">key_to_callback</span><span class="p">[</span><span class="nb">ord</span><span class="p">(</span><span class="s2">&quot;K&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">change_background_to_black</span>
    <span class="n">key_to_callback</span><span class="p">[</span><span class="nb">ord</span><span class="p">(</span><span class="s2">&quot;R&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">load_render_option</span>
    <span class="n">key_to_callback</span><span class="p">[</span><span class="nb">ord</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">capture_depth</span>
    <span class="n">key_to_callback</span><span class="p">[</span><span class="nb">ord</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">capture_image</span>
    <span class="n">o3d</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">draw_geometries_with_key_callbacks</span><span class="p">([</span><span class="n">pcd</span><span class="p">],</span> <span class="n">key_to_callback</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">custom_draw_geometry_with_camera_trajectory</span><span class="p">(</span><span class="n">pcd</span><span class="p">,</span> <span class="n">render_option_path</span><span class="p">,</span>
                                                <span class="n">camera_trajectory_path</span><span class="p">):</span>
    <span class="n">custom_draw_geometry_with_camera_trajectory</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">custom_draw_geometry_with_camera_trajectory</span><span class="o">.</span><span class="n">trajectory</span> <span class="o">=</span>\
        <span class="n">o3d</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_pinhole_camera_trajectory</span><span class="p">(</span><span class="n">camera_trajectory_path</span><span class="p">)</span>
    <span class="n">custom_draw_geometry_with_camera_trajectory</span><span class="o">.</span><span class="n">vis</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">Visualizer</span><span class="p">(</span>
    <span class="p">)</span>
    <span class="n">image_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">test_data_path</span><span class="p">,</span> <span class="s1">&#39;image&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">image_path</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">image_path</span><span class="p">)</span>
    <span class="n">depth_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">test_data_path</span><span class="p">,</span> <span class="s1">&#39;depth&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">depth_path</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">depth_path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">move_forward</span><span class="p">(</span><span class="n">vis</span><span class="p">):</span>
        <span class="c1"># This function is called within the o3d.visualization.Visualizer::run() loop</span>
        <span class="c1"># The run loop calls the function, then re-render</span>
        <span class="c1"># So the sequence in this function is to:</span>
        <span class="c1"># 1. Capture frame</span>
        <span class="c1"># 2. index++, check ending criteria</span>
        <span class="c1"># 3. Set camera</span>
        <span class="c1"># 4. (Re-render)</span>
        <span class="n">ctr</span> <span class="o">=</span> <span class="n">vis</span><span class="o">.</span><span class="n">get_view_control</span><span class="p">()</span>
        <span class="n">glb</span> <span class="o">=</span> <span class="n">custom_draw_geometry_with_camera_trajectory</span>
        <span class="k">if</span> <span class="n">glb</span><span class="o">.</span><span class="n">index</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Capture image </span><span class="si">{:05d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">glb</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
            <span class="n">depth</span> <span class="o">=</span> <span class="n">vis</span><span class="o">.</span><span class="n">capture_depth_float_buffer</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">vis</span><span class="o">.</span><span class="n">capture_screen_float_buffer</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">imsave</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">depth_path</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{:05d}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">glb</span><span class="o">.</span><span class="n">index</span><span class="p">)),</span>
                       <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">depth</span><span class="p">),</span>
                       <span class="n">dpi</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">imsave</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">image_path</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{:05d}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">glb</span><span class="o">.</span><span class="n">index</span><span class="p">)),</span>
                       <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">image</span><span class="p">),</span>
                       <span class="n">dpi</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="c1"># vis.capture_depth_image(&quot;depth/{:05d}.png&quot;.format(glb.index), False)</span>
            <span class="c1"># vis.capture_screen_image(&quot;image/{:05d}.png&quot;.format(glb.index), False)</span>
        <span class="n">glb</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">glb</span><span class="o">.</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">glb</span><span class="o">.</span><span class="n">index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">glb</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">parameters</span><span class="p">):</span>
            <span class="n">ctr</span><span class="o">.</span><span class="n">convert_from_pinhole_camera_parameters</span><span class="p">(</span>
                <span class="n">glb</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">glb</span><span class="o">.</span><span class="n">index</span><span class="p">],</span> <span class="n">allow_arbitrary</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">custom_draw_geometry_with_camera_trajectory</span><span class="o">.</span><span class="n">vis</span><span class="o">.</span>\
                <span class="n">register_animation_callback</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="n">vis</span> <span class="o">=</span> <span class="n">custom_draw_geometry_with_camera_trajectory</span><span class="o">.</span><span class="n">vis</span>
    <span class="n">vis</span><span class="o">.</span><span class="n">create_window</span><span class="p">()</span>
    <span class="n">vis</span><span class="o">.</span><span class="n">add_geometry</span><span class="p">(</span><span class="n">pcd</span><span class="p">)</span>
    <span class="n">vis</span><span class="o">.</span><span class="n">get_render_option</span><span class="p">()</span><span class="o">.</span><span class="n">load_from_json</span><span class="p">(</span><span class="n">render_option_path</span><span class="p">)</span>
    <span class="n">vis</span><span class="o">.</span><span class="n">register_animation_callback</span><span class="p">(</span><span class="n">move_forward</span><span class="p">)</span>
    <span class="n">vis</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">vis</span><span class="o">.</span><span class="n">destroy_window</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">sample_data</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DemoCustomVisualization</span><span class="p">()</span>
    <span class="n">pcd_flipped</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_point_cloud</span><span class="p">(</span><span class="n">sample_data</span><span class="o">.</span><span class="n">point_cloud_path</span><span class="p">)</span>
    <span class="c1"># Flip it, otherwise the pointcloud will be upside down</span>
    <span class="n">pcd_flipped</span><span class="o">.</span><span class="n">transform</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                           <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;1. Customized visualization to mimic DrawGeometry&quot;</span><span class="p">)</span>
    <span class="n">custom_draw_geometry</span><span class="p">(</span><span class="n">pcd_flipped</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;2. Changing field of view&quot;</span><span class="p">)</span>
    <span class="n">custom_draw_geometry_with_custom_fov</span><span class="p">(</span><span class="n">pcd_flipped</span><span class="p">,</span> <span class="mf">90.0</span><span class="p">)</span>
    <span class="n">custom_draw_geometry_with_custom_fov</span><span class="p">(</span><span class="n">pcd_flipped</span><span class="p">,</span> <span class="o">-</span><span class="mf">90.0</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;3. Customized visualization with a rotating view&quot;</span><span class="p">)</span>
    <span class="n">custom_draw_geometry_with_rotation</span><span class="p">(</span><span class="n">pcd_flipped</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;4. Customized visualization showing normal rendering&quot;</span><span class="p">)</span>
    <span class="n">custom_draw_geometry_load_option</span><span class="p">(</span><span class="n">pcd_flipped</span><span class="p">,</span>
                                     <span class="n">sample_data</span><span class="o">.</span><span class="n">render_option_path</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;5. Customized visualization with key press callbacks&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   Press &#39;K&#39; to change background color to black&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   Press &#39;R&#39; to load a customized render option, showing normals&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   Press &#39;,&#39; to capture the depth buffer and show it&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   Press &#39;.&#39; to capture the screen and show it&quot;</span><span class="p">)</span>
    <span class="n">custom_draw_geometry_with_key_callback</span><span class="p">(</span><span class="n">pcd_flipped</span><span class="p">,</span>
                                           <span class="n">sample_data</span><span class="o">.</span><span class="n">render_option_path</span><span class="p">)</span>

    <span class="n">pcd</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_point_cloud</span><span class="p">(</span><span class="n">sample_data</span><span class="o">.</span><span class="n">point_cloud_path</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;6. Customized visualization playing a camera trajectory&quot;</span><span class="p">)</span>
    <span class="n">custom_draw_geometry_with_camera_trajectory</span><span class="p">(</span>
        <span class="n">pcd</span><span class="p">,</span> <span class="n">sample_data</span><span class="o">.</span><span class="n">render_option_path</span><span class="p">,</span> <span class="n">sample_data</span><span class="o">.</span><span class="n">camera_trajectory_path</span><span class="p">)</span>
</pre></div></td></tr></table></div>
</div>
</div>
<div class="section" id="customized-visualization-key-action-py">
<h2>customized_visualization_key_action.py<a class="headerlink" href="#customized-visualization-key-action-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span></pre></div></td><td class="code"><div><pre><span></span><span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># -                        Open3D: www.open3d.org                            -</span>
<span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># Copyright (c) 2018-2023 www.open3d.org</span>
<span class="c1"># SPDX-License-Identifier: MIT</span>
<span class="c1"># ----------------------------------------------------------------------------</span>

<span class="kn">import</span> <span class="nn">open3d</span> <span class="k">as</span> <span class="nn">o3d</span>


<span class="k">def</span> <span class="nf">custom_key_action_without_kb_repeat_delay</span><span class="p">(</span><span class="n">pcd</span><span class="p">):</span>
    <span class="n">rotating</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">vis</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">VisualizerWithKeyCallback</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">key_action_callback</span><span class="p">(</span><span class="n">vis</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">mods</span><span class="p">):</span>
        <span class="k">nonlocal</span> <span class="n">rotating</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># key down</span>
            <span class="n">rotating</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># key up</span>
            <span class="n">rotating</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># key repeat</span>
            <span class="k">pass</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">animation_callback</span><span class="p">(</span><span class="n">vis</span><span class="p">):</span>
        <span class="k">nonlocal</span> <span class="n">rotating</span>
        <span class="k">if</span> <span class="n">rotating</span><span class="p">:</span>
            <span class="n">ctr</span> <span class="o">=</span> <span class="n">vis</span><span class="o">.</span><span class="n">get_view_control</span><span class="p">()</span>
            <span class="n">ctr</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>

    <span class="c1"># key_action_callback will be triggered when there&#39;s a keyboard press, release or repeat event</span>
    <span class="n">vis</span><span class="o">.</span><span class="n">register_key_action_callback</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="n">key_action_callback</span><span class="p">)</span>  <span class="c1"># space</span>

    <span class="c1"># animation_callback is always repeatedly called by the visualizer</span>
    <span class="n">vis</span><span class="o">.</span><span class="n">register_animation_callback</span><span class="p">(</span><span class="n">animation_callback</span><span class="p">)</span>

    <span class="n">vis</span><span class="o">.</span><span class="n">create_window</span><span class="p">()</span>
    <span class="n">vis</span><span class="o">.</span><span class="n">add_geometry</span><span class="p">(</span><span class="n">pcd</span><span class="p">)</span>
    <span class="n">vis</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">ply_data</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">PLYPointCloud</span><span class="p">()</span>
    <span class="n">pcd</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_point_cloud</span><span class="p">(</span><span class="n">ply_data</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span>
        <span class="s2">&quot;Customized visualization with smooth key action (without keyboard repeat delay)&quot;</span>
    <span class="p">)</span>
    <span class="n">custom_key_action_without_kb_repeat_delay</span><span class="p">(</span><span class="n">pcd</span><span class="p">)</span>
</pre></div></td></tr></table></div>
</div>
</div>
<div class="section" id="demo-scene-py">
<h2>demo_scene.py<a class="headerlink" href="#demo-scene-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span></pre></div></td><td class="code"><div><pre><span></span><span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># -                        Open3D: www.open3d.org                            -</span>
<span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># Copyright (c) 2018-2023 www.open3d.org</span>
<span class="c1"># SPDX-License-Identifier: MIT</span>
<span class="c1"># ----------------------------------------------------------------------------</span>
<span class="sd">&quot;&quot;&quot;Demo scene demonstrating models, built-in shapes, and materials&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">open3d</span> <span class="k">as</span> <span class="nn">o3d</span>
<span class="kn">import</span> <span class="nn">open3d.visualization</span> <span class="k">as</span> <span class="nn">vis</span>


<span class="k">def</span> <span class="nf">convert_material_record</span><span class="p">(</span><span class="n">mat_record</span><span class="p">):</span>
    <span class="n">mat</span> <span class="o">=</span> <span class="n">vis</span><span class="o">.</span><span class="n">Material</span><span class="p">(</span><span class="s1">&#39;defaultLit&#39;</span><span class="p">)</span>
    <span class="c1"># Convert scalar parameters</span>
    <span class="n">mat</span><span class="o">.</span><span class="n">vector_properties</span><span class="p">[</span><span class="s1">&#39;base_color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mat_record</span><span class="o">.</span><span class="n">base_color</span>
    <span class="n">mat</span><span class="o">.</span><span class="n">scalar_properties</span><span class="p">[</span><span class="s1">&#39;metallic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mat_record</span><span class="o">.</span><span class="n">base_metallic</span>
    <span class="n">mat</span><span class="o">.</span><span class="n">scalar_properties</span><span class="p">[</span><span class="s1">&#39;roughness&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mat_record</span><span class="o">.</span><span class="n">base_roughness</span>
    <span class="n">mat</span><span class="o">.</span><span class="n">scalar_properties</span><span class="p">[</span><span class="s1">&#39;reflectance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mat_record</span><span class="o">.</span><span class="n">base_reflectance</span>
    <span class="n">mat</span><span class="o">.</span><span class="n">texture_maps</span><span class="p">[</span><span class="s1">&#39;albedo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">from_legacy</span><span class="p">(</span>
        <span class="n">mat_record</span><span class="o">.</span><span class="n">albedo_img</span><span class="p">)</span>
    <span class="n">mat</span><span class="o">.</span><span class="n">texture_maps</span><span class="p">[</span><span class="s1">&#39;normal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">from_legacy</span><span class="p">(</span>
        <span class="n">mat_record</span><span class="o">.</span><span class="n">normal_img</span><span class="p">)</span>
    <span class="n">mat</span><span class="o">.</span><span class="n">texture_maps</span><span class="p">[</span><span class="s1">&#39;ao_rough_metal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">from_legacy</span><span class="p">(</span>
        <span class="n">mat_record</span><span class="o">.</span><span class="n">ao_rough_metal_img</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mat</span>


<span class="k">def</span> <span class="nf">create_scene</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Creates the geometry and materials for the demo scene and returns a dictionary suitable for draw call</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># Create some shapes for our scene</span>
    <span class="n">a_cube</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">TriangleMesh</span><span class="o">.</span><span class="n">create_box</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span>
                                                  <span class="mi">4</span><span class="p">,</span>
                                                  <span class="mi">4</span><span class="p">,</span>
                                                  <span class="n">create_uv_map</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                  <span class="n">map_texture_to_each_face</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">a_cube</span><span class="o">.</span><span class="n">compute_triangle_normals</span><span class="p">()</span>
    <span class="n">a_cube</span><span class="o">.</span><span class="n">translate</span><span class="p">((</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">a_cube</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">TriangleMesh</span><span class="o">.</span><span class="n">from_legacy</span><span class="p">(</span><span class="n">a_cube</span><span class="p">)</span>

    <span class="n">a_sphere</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">TriangleMesh</span><span class="o">.</span><span class="n">create_sphere</span><span class="p">(</span><span class="mf">2.5</span><span class="p">,</span>
                                                       <span class="n">resolution</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span>
                                                       <span class="n">create_uv_map</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">a_sphere</span><span class="o">.</span><span class="n">compute_vertex_normals</span><span class="p">()</span>
    <span class="n">rotate_90</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">get_rotation_matrix_from_xyz</span><span class="p">((</span><span class="o">-</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">a_sphere</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">rotate_90</span><span class="p">)</span>
    <span class="n">a_sphere</span><span class="o">.</span><span class="n">translate</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span> <span class="mf">2.4</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">a_sphere</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">TriangleMesh</span><span class="o">.</span><span class="n">from_legacy</span><span class="p">(</span><span class="n">a_sphere</span><span class="p">)</span>

    <span class="n">a_cylinder</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">TriangleMesh</span><span class="o">.</span><span class="n">create_cylinder</span><span class="p">(</span>
        <span class="mf">1.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">a_cylinder</span><span class="o">.</span><span class="n">compute_triangle_normals</span><span class="p">()</span>
    <span class="n">a_cylinder</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">rotate_90</span><span class="p">)</span>
    <span class="n">a_cylinder</span><span class="o">.</span><span class="n">translate</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">a_cylinder</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">TriangleMesh</span><span class="o">.</span><span class="n">from_legacy</span><span class="p">(</span><span class="n">a_cylinder</span><span class="p">)</span>

    <span class="n">a_ico</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">TriangleMesh</span><span class="o">.</span><span class="n">create_icosahedron</span><span class="p">(</span><span class="mf">1.25</span><span class="p">,</span>
                                                         <span class="n">create_uv_map</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">a_ico</span><span class="o">.</span><span class="n">compute_triangle_normals</span><span class="p">()</span>
    <span class="n">a_ico</span><span class="o">.</span><span class="n">translate</span><span class="p">((</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">a_ico</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">TriangleMesh</span><span class="o">.</span><span class="n">from_legacy</span><span class="p">(</span><span class="n">a_ico</span><span class="p">)</span>

    <span class="c1"># Load an OBJ model for our scene</span>
    <span class="n">helmet_data</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">FlightHelmetModel</span><span class="p">()</span>
    <span class="n">helmet</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_triangle_model</span><span class="p">(</span><span class="n">helmet_data</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
    <span class="n">helmet_parts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">helmet</span><span class="o">.</span><span class="n">meshes</span><span class="p">:</span>
        <span class="c1"># m.mesh.paint_uniform_color((1.0, 0.75, 0.3))</span>
        <span class="n">m</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="mf">10.0</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>
        <span class="n">helmet_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

    <span class="c1"># Create a ground plane</span>
    <span class="n">ground_plane</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">TriangleMesh</span><span class="o">.</span><span class="n">create_box</span><span class="p">(</span>
        <span class="mf">50.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">,</span> <span class="n">create_uv_map</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">map_texture_to_each_face</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ground_plane</span><span class="o">.</span><span class="n">compute_triangle_normals</span><span class="p">()</span>
    <span class="n">rotate_180</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">get_rotation_matrix_from_xyz</span><span class="p">((</span><span class="o">-</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">ground_plane</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">rotate_180</span><span class="p">)</span>
    <span class="n">ground_plane</span><span class="o">.</span><span class="n">translate</span><span class="p">((</span><span class="o">-</span><span class="mf">25.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="o">-</span><span class="mf">25.0</span><span class="p">))</span>
    <span class="n">ground_plane</span><span class="o">.</span><span class="n">paint_uniform_color</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">ground_plane</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">TriangleMesh</span><span class="o">.</span><span class="n">from_legacy</span><span class="p">(</span><span class="n">ground_plane</span><span class="p">)</span>

    <span class="c1"># Material to make ground plane more interesting - a rough piece of glass</span>
    <span class="n">ground_plane</span><span class="o">.</span><span class="n">material</span> <span class="o">=</span> <span class="n">vis</span><span class="o">.</span><span class="n">Material</span><span class="p">(</span><span class="s2">&quot;defaultLitSSR&quot;</span><span class="p">)</span>
    <span class="n">ground_plane</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">scalar_properties</span><span class="p">[</span><span class="s1">&#39;roughness&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.15</span>
    <span class="n">ground_plane</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">scalar_properties</span><span class="p">[</span><span class="s1">&#39;reflectance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.72</span>
    <span class="n">ground_plane</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">scalar_properties</span><span class="p">[</span><span class="s1">&#39;transmission&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.6</span>
    <span class="n">ground_plane</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">scalar_properties</span><span class="p">[</span><span class="s1">&#39;thickness&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.3</span>
    <span class="n">ground_plane</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">scalar_properties</span><span class="p">[</span><span class="s1">&#39;absorption_distance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.1</span>
    <span class="n">ground_plane</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">vector_properties</span><span class="p">[</span><span class="s1">&#39;absorption_color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="p">[</span><span class="mf">0.82</span><span class="p">,</span> <span class="mf">0.98</span><span class="p">,</span> <span class="mf">0.972</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
    <span class="n">painted_plaster_texture_data</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">PaintedPlasterTexture</span><span class="p">()</span>
    <span class="n">ground_plane</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">texture_maps</span><span class="p">[</span><span class="s1">&#39;albedo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_image</span><span class="p">(</span>
        <span class="n">painted_plaster_texture_data</span><span class="o">.</span><span class="n">albedo_texture_path</span><span class="p">)</span>
    <span class="n">ground_plane</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">texture_maps</span><span class="p">[</span><span class="s1">&#39;normal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_image</span><span class="p">(</span>
        <span class="n">painted_plaster_texture_data</span><span class="o">.</span><span class="n">normal_texture_path</span><span class="p">)</span>
    <span class="n">ground_plane</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">texture_maps</span><span class="p">[</span><span class="s1">&#39;roughness&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_image</span><span class="p">(</span>
        <span class="n">painted_plaster_texture_data</span><span class="o">.</span><span class="n">roughness_texture_path</span><span class="p">)</span>

    <span class="c1"># Load textures and create materials for each of our demo items</span>
    <span class="n">wood_floor_texture_data</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">WoodFloorTexture</span><span class="p">()</span>
    <span class="n">a_cube</span><span class="o">.</span><span class="n">material</span> <span class="o">=</span> <span class="n">vis</span><span class="o">.</span><span class="n">Material</span><span class="p">(</span><span class="s1">&#39;defaultLit&#39;</span><span class="p">)</span>
    <span class="n">a_cube</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">texture_maps</span><span class="p">[</span><span class="s1">&#39;albedo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_image</span><span class="p">(</span>
        <span class="n">wood_floor_texture_data</span><span class="o">.</span><span class="n">albedo_texture_path</span><span class="p">)</span>
    <span class="n">a_cube</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">texture_maps</span><span class="p">[</span><span class="s1">&#39;normal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_image</span><span class="p">(</span>
        <span class="n">wood_floor_texture_data</span><span class="o">.</span><span class="n">normal_texture_path</span><span class="p">)</span>
    <span class="n">a_cube</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">texture_maps</span><span class="p">[</span><span class="s1">&#39;roughness&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_image</span><span class="p">(</span>
        <span class="n">wood_floor_texture_data</span><span class="o">.</span><span class="n">roughness_texture_path</span><span class="p">)</span>

    <span class="n">tiles_texture_data</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">TilesTexture</span><span class="p">()</span>
    <span class="n">a_sphere</span><span class="o">.</span><span class="n">material</span> <span class="o">=</span> <span class="n">vis</span><span class="o">.</span><span class="n">Material</span><span class="p">(</span><span class="s1">&#39;defaultLit&#39;</span><span class="p">)</span>
    <span class="n">a_sphere</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">texture_maps</span><span class="p">[</span><span class="s1">&#39;albedo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_image</span><span class="p">(</span>
        <span class="n">tiles_texture_data</span><span class="o">.</span><span class="n">albedo_texture_path</span><span class="p">)</span>
    <span class="n">a_sphere</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">texture_maps</span><span class="p">[</span><span class="s1">&#39;normal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_image</span><span class="p">(</span>
        <span class="n">tiles_texture_data</span><span class="o">.</span><span class="n">normal_texture_path</span><span class="p">)</span>
    <span class="n">a_sphere</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">texture_maps</span><span class="p">[</span><span class="s1">&#39;roughness&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_image</span><span class="p">(</span>
        <span class="n">tiles_texture_data</span><span class="o">.</span><span class="n">roughness_texture_path</span><span class="p">)</span>

    <span class="n">terrazzo_texture_data</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">TerrazzoTexture</span><span class="p">()</span>
    <span class="n">a_ico</span><span class="o">.</span><span class="n">material</span> <span class="o">=</span> <span class="n">vis</span><span class="o">.</span><span class="n">Material</span><span class="p">(</span><span class="s1">&#39;defaultLit&#39;</span><span class="p">)</span>
    <span class="n">a_ico</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">texture_maps</span><span class="p">[</span><span class="s1">&#39;albedo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_image</span><span class="p">(</span>
        <span class="n">terrazzo_texture_data</span><span class="o">.</span><span class="n">albedo_texture_path</span><span class="p">)</span>
    <span class="n">a_ico</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">texture_maps</span><span class="p">[</span><span class="s1">&#39;normal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_image</span><span class="p">(</span>
        <span class="n">terrazzo_texture_data</span><span class="o">.</span><span class="n">normal_texture_path</span><span class="p">)</span>
    <span class="n">a_ico</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">texture_maps</span><span class="p">[</span><span class="s1">&#39;roughness&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_image</span><span class="p">(</span>
        <span class="n">terrazzo_texture_data</span><span class="o">.</span><span class="n">roughness_texture_path</span><span class="p">)</span>

    <span class="n">metal_texture_data</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">MetalTexture</span><span class="p">()</span>
    <span class="n">a_cylinder</span><span class="o">.</span><span class="n">material</span> <span class="o">=</span> <span class="n">vis</span><span class="o">.</span><span class="n">Material</span><span class="p">(</span><span class="s1">&#39;defaultLit&#39;</span><span class="p">)</span>
    <span class="n">a_cylinder</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">texture_maps</span><span class="p">[</span><span class="s1">&#39;albedo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_image</span><span class="p">(</span>
        <span class="n">metal_texture_data</span><span class="o">.</span><span class="n">albedo_texture_path</span><span class="p">)</span>
    <span class="n">a_cylinder</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">texture_maps</span><span class="p">[</span><span class="s1">&#39;normal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_image</span><span class="p">(</span>
        <span class="n">metal_texture_data</span><span class="o">.</span><span class="n">normal_texture_path</span><span class="p">)</span>
    <span class="n">a_cylinder</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">texture_maps</span><span class="p">[</span><span class="s1">&#39;roughness&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_image</span><span class="p">(</span>
        <span class="n">metal_texture_data</span><span class="o">.</span><span class="n">roughness_texture_path</span><span class="p">)</span>
    <span class="n">a_cylinder</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">texture_maps</span><span class="p">[</span><span class="s1">&#39;metallic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_image</span><span class="p">(</span>
        <span class="n">metal_texture_data</span><span class="o">.</span><span class="n">metallic_texture_path</span><span class="p">)</span>

    <span class="n">geoms</span> <span class="o">=</span> <span class="p">[{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;plane&quot;</span><span class="p">,</span>
        <span class="s2">&quot;geometry&quot;</span><span class="p">:</span> <span class="n">ground_plane</span>
    <span class="p">},</span> <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;cube&quot;</span><span class="p">,</span>
        <span class="s2">&quot;geometry&quot;</span><span class="p">:</span> <span class="n">a_cube</span>
    <span class="p">},</span> <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;cylinder&quot;</span><span class="p">,</span>
        <span class="s2">&quot;geometry&quot;</span><span class="p">:</span> <span class="n">a_cylinder</span>
    <span class="p">},</span> <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;ico&quot;</span><span class="p">,</span>
        <span class="s2">&quot;geometry&quot;</span><span class="p">:</span> <span class="n">a_ico</span>
    <span class="p">},</span> <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;sphere&quot;</span><span class="p">,</span>
        <span class="s2">&quot;geometry&quot;</span><span class="p">:</span> <span class="n">a_sphere</span>
    <span class="p">}]</span>
    <span class="c1"># Load the helmet</span>
    <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">helmet_parts</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="n">mesh_name</span>
        <span class="n">tgeom</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">TriangleMesh</span><span class="o">.</span><span class="n">from_legacy</span><span class="p">(</span><span class="n">part</span><span class="o">.</span><span class="n">mesh</span><span class="p">)</span>
        <span class="n">tgeom</span><span class="o">.</span><span class="n">material</span> <span class="o">=</span> <span class="n">convert_material_record</span><span class="p">(</span>
            <span class="n">helmet</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="n">part</span><span class="o">.</span><span class="n">material_idx</span><span class="p">])</span>
        <span class="n">geoms</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;geometry&quot;</span><span class="p">:</span> <span class="n">tgeom</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">geoms</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">geoms</span> <span class="o">=</span> <span class="n">create_scene</span><span class="p">()</span>
    <span class="n">vis</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">geoms</span><span class="p">,</span>
             <span class="n">bg_color</span><span class="o">=</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
             <span class="n">show_ui</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
             <span class="n">width</span><span class="o">=</span><span class="mi">1920</span><span class="p">,</span>
             <span class="n">height</span><span class="o">=</span><span class="mi">1080</span><span class="p">)</span>
</pre></div></td></tr></table></div>
</div>
</div>
<div class="section" id="draw-py">
<h2>draw.py<a class="headerlink" href="#draw-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span></pre></div></td><td class="code"><div><pre><span></span><span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># -                        Open3D: www.open3d.org                            -</span>
<span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># Copyright (c) 2018-2023 www.open3d.org</span>
<span class="c1"># SPDX-License-Identifier: MIT</span>
<span class="c1"># ----------------------------------------------------------------------------</span>

<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">open3d</span> <span class="k">as</span> <span class="nn">o3d</span>
<span class="kn">import</span> <span class="nn">open3d.visualization</span> <span class="k">as</span> <span class="nn">vis</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="n">pyexample_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)))</span>
<span class="n">test_data_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">pyexample_path</span><span class="p">),</span> <span class="s1">&#39;test_data&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">normalize</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
    <span class="n">a</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">a</span> <span class="o">*</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">a</span> <span class="o">*</span> <span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>


<span class="k">def</span> <span class="nf">make_point_cloud</span><span class="p">(</span><span class="n">npts</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">colorize</span><span class="p">):</span>
    <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="n">radius</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">[</span><span class="n">npts</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span> <span class="o">+</span> <span class="n">center</span>
    <span class="n">cloud</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">PointCloud</span><span class="p">()</span>
    <span class="n">cloud</span><span class="o">.</span><span class="n">points</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">Vector3dVector</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">colorize</span><span class="p">:</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">[</span><span class="n">npts</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
        <span class="n">cloud</span><span class="o">.</span><span class="n">colors</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">Vector3dVector</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cloud</span>


<span class="k">def</span> <span class="nf">single_object</span><span class="p">():</span>
    <span class="c1"># No colors, no normals, should appear unlit black</span>
    <span class="n">cube</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">TriangleMesh</span><span class="o">.</span><span class="n">create_box</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
    <span class="n">vis</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">cube</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">multi_objects</span><span class="p">():</span>
    <span class="n">pc_rad</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">pc_nocolor</span> <span class="o">=</span> <span class="n">make_point_cloud</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">pc_rad</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">pc_color</span> <span class="o">=</span> <span class="n">make_point_cloud</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">pc_rad</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="mf">0.4</span>
    <span class="n">sphere_unlit</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">TriangleMesh</span><span class="o">.</span><span class="n">create_sphere</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="n">sphere_unlit</span><span class="o">.</span><span class="n">translate</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">sphere_colored_unlit</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">TriangleMesh</span><span class="o">.</span><span class="n">create_sphere</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="n">sphere_colored_unlit</span><span class="o">.</span><span class="n">paint_uniform_color</span><span class="p">((</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>
    <span class="n">sphere_colored_unlit</span><span class="o">.</span><span class="n">translate</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">sphere_lit</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">TriangleMesh</span><span class="o">.</span><span class="n">create_sphere</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="n">sphere_lit</span><span class="o">.</span><span class="n">compute_vertex_normals</span><span class="p">()</span>
    <span class="n">sphere_lit</span><span class="o">.</span><span class="n">translate</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">sphere_colored_lit</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">TriangleMesh</span><span class="o">.</span><span class="n">create_sphere</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="n">sphere_colored_lit</span><span class="o">.</span><span class="n">compute_vertex_normals</span><span class="p">()</span>
    <span class="n">sphere_colored_lit</span><span class="o">.</span><span class="n">paint_uniform_color</span><span class="p">((</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>
    <span class="n">sphere_colored_lit</span><span class="o">.</span><span class="n">translate</span><span class="p">((</span><span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">big_bbox</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">AxisAlignedBoundingBox</span><span class="p">((</span><span class="o">-</span><span class="n">pc_rad</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="n">pc_rad</span><span class="p">),</span>
                                                   <span class="p">(</span><span class="mf">6.0</span> <span class="o">+</span> <span class="n">r</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="n">r</span><span class="p">,</span> <span class="n">pc_rad</span><span class="p">))</span>
    <span class="n">big_bbox</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
    <span class="n">sphere_bbox</span> <span class="o">=</span> <span class="n">sphere_unlit</span><span class="o">.</span><span class="n">get_axis_aligned_bounding_box</span><span class="p">()</span>
    <span class="n">sphere_bbox</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">LineSet</span><span class="o">.</span><span class="n">create_from_axis_aligned_bounding_box</span><span class="p">(</span>
        <span class="n">sphere_lit</span><span class="o">.</span><span class="n">get_axis_aligned_bounding_box</span><span class="p">())</span>
    <span class="n">lines</span><span class="o">.</span><span class="n">paint_uniform_color</span><span class="p">((</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>
    <span class="n">lines_colored</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">LineSet</span><span class="o">.</span><span class="n">create_from_axis_aligned_bounding_box</span><span class="p">(</span>
        <span class="n">sphere_colored_lit</span><span class="o">.</span><span class="n">get_axis_aligned_bounding_box</span><span class="p">())</span>
    <span class="n">lines_colored</span><span class="o">.</span><span class="n">paint_uniform_color</span><span class="p">((</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))</span>

    <span class="n">vis</span><span class="o">.</span><span class="n">draw</span><span class="p">([</span>
        <span class="n">pc_nocolor</span><span class="p">,</span> <span class="n">pc_color</span><span class="p">,</span> <span class="n">sphere_unlit</span><span class="p">,</span> <span class="n">sphere_colored_unlit</span><span class="p">,</span> <span class="n">sphere_lit</span><span class="p">,</span>
        <span class="n">sphere_colored_lit</span><span class="p">,</span> <span class="n">big_bbox</span><span class="p">,</span> <span class="n">sphere_bbox</span><span class="p">,</span> <span class="n">lines</span><span class="p">,</span> <span class="n">lines_colored</span>
    <span class="p">])</span>


<span class="k">def</span> <span class="nf">actions</span><span class="p">():</span>
    <span class="n">SOURCE_NAME</span> <span class="o">=</span> <span class="s2">&quot;Source&quot;</span>
    <span class="n">RESULT_NAME</span> <span class="o">=</span> <span class="s2">&quot;Result (Poisson reconstruction)&quot;</span>
    <span class="n">TRUTH_NAME</span> <span class="o">=</span> <span class="s2">&quot;Ground truth&quot;</span>

    <span class="n">bunny</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">BunnyMesh</span><span class="p">()</span>
    <span class="n">bunny_mesh</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_triangle_mesh</span><span class="p">(</span><span class="n">bunny</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
    <span class="n">bunny_mesh</span><span class="o">.</span><span class="n">compute_vertex_normals</span><span class="p">()</span>

    <span class="n">bunny_mesh</span><span class="o">.</span><span class="n">paint_uniform_color</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">bunny_mesh</span><span class="o">.</span><span class="n">compute_vertex_normals</span><span class="p">()</span>
    <span class="n">cloud</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">PointCloud</span><span class="p">()</span>
    <span class="n">cloud</span><span class="o">.</span><span class="n">points</span> <span class="o">=</span> <span class="n">bunny_mesh</span><span class="o">.</span><span class="n">vertices</span>
    <span class="n">cloud</span><span class="o">.</span><span class="n">normals</span> <span class="o">=</span> <span class="n">bunny_mesh</span><span class="o">.</span><span class="n">vertex_normals</span>

    <span class="k">def</span> <span class="nf">make_mesh</span><span class="p">(</span><span class="n">o3dvis</span><span class="p">):</span>
        <span class="c1"># TODO: call o3dvis.get_geometry instead of using bunny_mesh</span>
        <span class="n">mesh</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">TriangleMesh</span><span class="o">.</span><span class="n">create_from_point_cloud_poisson</span><span class="p">(</span>
            <span class="n">cloud</span><span class="p">)</span>
        <span class="n">mesh</span><span class="o">.</span><span class="n">paint_uniform_color</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">mesh</span><span class="o">.</span><span class="n">compute_vertex_normals</span><span class="p">()</span>
        <span class="n">o3dvis</span><span class="o">.</span><span class="n">add_geometry</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">RESULT_NAME</span><span class="p">,</span> <span class="s2">&quot;geometry&quot;</span><span class="p">:</span> <span class="n">mesh</span><span class="p">})</span>
        <span class="n">o3dvis</span><span class="o">.</span><span class="n">show_geometry</span><span class="p">(</span><span class="n">SOURCE_NAME</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">toggle_result</span><span class="p">(</span><span class="n">o3dvis</span><span class="p">):</span>
        <span class="n">truth_vis</span> <span class="o">=</span> <span class="n">o3dvis</span><span class="o">.</span><span class="n">get_geometry</span><span class="p">(</span><span class="n">TRUTH_NAME</span><span class="p">)</span><span class="o">.</span><span class="n">is_visible</span>
        <span class="n">o3dvis</span><span class="o">.</span><span class="n">show_geometry</span><span class="p">(</span><span class="n">TRUTH_NAME</span><span class="p">,</span> <span class="ow">not</span> <span class="n">truth_vis</span><span class="p">)</span>
        <span class="n">o3dvis</span><span class="o">.</span><span class="n">show_geometry</span><span class="p">(</span><span class="n">RESULT_NAME</span><span class="p">,</span> <span class="n">truth_vis</span><span class="p">)</span>

    <span class="n">vis</span><span class="o">.</span><span class="n">draw</span><span class="p">([{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">SOURCE_NAME</span><span class="p">,</span>
        <span class="s2">&quot;geometry&quot;</span><span class="p">:</span> <span class="n">cloud</span>
    <span class="p">},</span> <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">TRUTH_NAME</span><span class="p">,</span>
        <span class="s2">&quot;geometry&quot;</span><span class="p">:</span> <span class="n">bunny_mesh</span><span class="p">,</span>
        <span class="s2">&quot;is_visible&quot;</span><span class="p">:</span> <span class="kc">False</span>
    <span class="p">}],</span>
             <span class="n">actions</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot;Create Mesh&quot;</span><span class="p">,</span> <span class="n">make_mesh</span><span class="p">),</span>
                      <span class="p">(</span><span class="s2">&quot;Toggle truth/result&quot;</span><span class="p">,</span> <span class="n">toggle_result</span><span class="p">)])</span>


<span class="k">def</span> <span class="nf">get_icp_transform</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">source_indices</span><span class="p">,</span> <span class="n">target_indices</span><span class="p">):</span>
    <span class="n">corr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">source_indices</span><span class="p">),</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">corr</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">source_indices</span>
    <span class="n">corr</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">target_indices</span>

    <span class="c1"># Estimate rough transformation using correspondences</span>
    <span class="n">p2p</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">pipelines</span><span class="o">.</span><span class="n">registration</span><span class="o">.</span><span class="n">TransformationEstimationPointToPoint</span><span class="p">()</span>
    <span class="n">trans_init</span> <span class="o">=</span> <span class="n">p2p</span><span class="o">.</span><span class="n">compute_transformation</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span>
                                            <span class="n">o3d</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">Vector2iVector</span><span class="p">(</span><span class="n">corr</span><span class="p">))</span>

    <span class="c1"># Point-to-point ICP for refinement</span>
    <span class="n">threshold</span> <span class="o">=</span> <span class="mf">0.03</span>  <span class="c1"># 3cm distance threshold</span>
    <span class="n">reg_p2p</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">pipelines</span><span class="o">.</span><span class="n">registration</span><span class="o">.</span><span class="n">registration_icp</span><span class="p">(</span>
        <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">trans_init</span><span class="p">,</span>
        <span class="n">o3d</span><span class="o">.</span><span class="n">pipelines</span><span class="o">.</span><span class="n">registration</span><span class="o">.</span><span class="n">TransformationEstimationPointToPoint</span><span class="p">())</span>

    <span class="k">return</span> <span class="n">reg_p2p</span><span class="o">.</span><span class="n">transformation</span>


<span class="k">def</span> <span class="nf">selections</span><span class="p">():</span>
    <span class="n">pcd_fragments_data</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DemoICPPointClouds</span><span class="p">()</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_point_cloud</span><span class="p">(</span><span class="n">pcd_fragments_data</span><span class="o">.</span><span class="n">paths</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">target</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_point_cloud</span><span class="p">(</span><span class="n">pcd_fragments_data</span><span class="o">.</span><span class="n">paths</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">source</span><span class="o">.</span><span class="n">paint_uniform_color</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.706</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">target</span><span class="o">.</span><span class="n">paint_uniform_color</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.651</span><span class="p">,</span> <span class="mf">0.929</span><span class="p">])</span>

    <span class="n">source_name</span> <span class="o">=</span> <span class="s2">&quot;Source (yellow)&quot;</span>
    <span class="n">target_name</span> <span class="o">=</span> <span class="s2">&quot;Target (blue)&quot;</span>

    <span class="k">def</span> <span class="nf">do_icp_one_set</span><span class="p">(</span><span class="n">o3dvis</span><span class="p">):</span>
        <span class="c1"># sets: [name: [{ &quot;index&quot;: int, &quot;order&quot;: int, &quot;point&quot;: (x, y, z)}, ...],</span>
        <span class="c1">#        ...]</span>
        <span class="n">sets</span> <span class="o">=</span> <span class="n">o3dvis</span><span class="o">.</span><span class="n">get_selection_sets</span><span class="p">()</span>
        <span class="n">source_picked</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">sets</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">source_name</span><span class="p">]),</span>
                               <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">order</span><span class="p">)</span>
        <span class="n">target_picked</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">sets</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">target_name</span><span class="p">]),</span>
                               <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">order</span><span class="p">)</span>
        <span class="n">source_indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">idx</span><span class="o">.</span><span class="n">index</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">source_picked</span><span class="p">]</span>
        <span class="n">target_indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">idx</span><span class="o">.</span><span class="n">index</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">target_picked</span><span class="p">]</span>

        <span class="n">t</span> <span class="o">=</span> <span class="n">get_icp_transform</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">source_indices</span><span class="p">,</span> <span class="n">target_indices</span><span class="p">)</span>
        <span class="n">source</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

        <span class="c1"># Update the source geometry</span>
        <span class="n">o3dvis</span><span class="o">.</span><span class="n">remove_geometry</span><span class="p">(</span><span class="n">source_name</span><span class="p">)</span>
        <span class="n">o3dvis</span><span class="o">.</span><span class="n">add_geometry</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">source_name</span><span class="p">,</span> <span class="s2">&quot;geometry&quot;</span><span class="p">:</span> <span class="n">source</span><span class="p">})</span>

    <span class="k">def</span> <span class="nf">do_icp_two_sets</span><span class="p">(</span><span class="n">o3dvis</span><span class="p">):</span>
        <span class="n">sets</span> <span class="o">=</span> <span class="n">o3dvis</span><span class="o">.</span><span class="n">get_selection_sets</span><span class="p">()</span>
        <span class="n">source_set</span> <span class="o">=</span> <span class="n">sets</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">source_name</span><span class="p">]</span>
        <span class="n">target_set</span> <span class="o">=</span> <span class="n">sets</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">target_name</span><span class="p">]</span>
        <span class="n">source_picked</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">source_set</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">order</span><span class="p">)</span>
        <span class="n">target_picked</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">target_set</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">order</span><span class="p">)</span>
        <span class="n">source_indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">idx</span><span class="o">.</span><span class="n">index</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">source_picked</span><span class="p">]</span>
        <span class="n">target_indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">idx</span><span class="o">.</span><span class="n">index</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">target_picked</span><span class="p">]</span>

        <span class="n">t</span> <span class="o">=</span> <span class="n">get_icp_transform</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">source_indices</span><span class="p">,</span> <span class="n">target_indices</span><span class="p">)</span>
        <span class="n">source</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

        <span class="c1"># Update the source geometry</span>
        <span class="n">o3dvis</span><span class="o">.</span><span class="n">remove_geometry</span><span class="p">(</span><span class="n">source_name</span><span class="p">)</span>
        <span class="n">o3dvis</span><span class="o">.</span><span class="n">add_geometry</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">source_name</span><span class="p">,</span> <span class="s2">&quot;geometry&quot;</span><span class="p">:</span> <span class="n">source</span><span class="p">})</span>

    <span class="n">vis</span><span class="o">.</span><span class="n">draw</span><span class="p">([{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">source_name</span><span class="p">,</span>
        <span class="s2">&quot;geometry&quot;</span><span class="p">:</span> <span class="n">source</span>
    <span class="p">},</span> <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">target_name</span><span class="p">,</span>
        <span class="s2">&quot;geometry&quot;</span><span class="p">:</span> <span class="n">target</span>
    <span class="p">}],</span>
             <span class="n">actions</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot;ICP Registration (one set)&quot;</span><span class="p">,</span> <span class="n">do_icp_one_set</span><span class="p">),</span>
                      <span class="p">(</span><span class="s2">&quot;ICP Registration (two sets)&quot;</span><span class="p">,</span> <span class="n">do_icp_two_sets</span><span class="p">)],</span>
             <span class="n">show_ui</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">time_animation</span><span class="p">():</span>
    <span class="n">orig</span> <span class="o">=</span> <span class="n">make_point_cloud</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mf">1.0</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">clouds</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;t=0&quot;</span><span class="p">,</span> <span class="s2">&quot;geometry&quot;</span><span class="p">:</span> <span class="n">orig</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}]</span>
    <span class="n">drift_dir</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
    <span class="n">expand</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">20</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="n">amount</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">cloud</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">PointCloud</span><span class="p">()</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">orig</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="n">pts</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">amount</span> <span class="o">*</span> <span class="n">expand</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="n">amount</span> <span class="o">*</span> <span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">drift_dir</span><span class="p">]</span>
        <span class="n">cloud</span><span class="o">.</span><span class="n">points</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">Vector3dVector</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span>
        <span class="n">cloud</span><span class="o">.</span><span class="n">colors</span> <span class="o">=</span> <span class="n">orig</span><span class="o">.</span><span class="n">colors</span>
        <span class="n">clouds</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;points at t=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
            <span class="s2">&quot;geometry&quot;</span><span class="p">:</span> <span class="n">cloud</span><span class="p">,</span>
            <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">i</span>
        <span class="p">})</span>

    <span class="n">vis</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">clouds</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">groups</span><span class="p">():</span>
    <span class="n">building_mat</span> <span class="o">=</span> <span class="n">vis</span><span class="o">.</span><span class="n">rendering</span><span class="o">.</span><span class="n">MaterialRecord</span><span class="p">()</span>
    <span class="n">building_mat</span><span class="o">.</span><span class="n">shader</span> <span class="o">=</span> <span class="s2">&quot;defaultLit&quot;</span>
    <span class="n">building_mat</span><span class="o">.</span><span class="n">base_color</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">.90</span><span class="p">,</span> <span class="mf">.75</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="n">building_mat</span><span class="o">.</span><span class="n">base_reflectance</span> <span class="o">=</span> <span class="mf">0.1</span>
    <span class="n">midrise_mat</span> <span class="o">=</span> <span class="n">vis</span><span class="o">.</span><span class="n">rendering</span><span class="o">.</span><span class="n">MaterialRecord</span><span class="p">()</span>
    <span class="n">midrise_mat</span><span class="o">.</span><span class="n">shader</span> <span class="o">=</span> <span class="s2">&quot;defaultLit&quot;</span>
    <span class="n">midrise_mat</span><span class="o">.</span><span class="n">base_color</span> <span class="o">=</span> <span class="p">(</span><span class="mf">.475</span><span class="p">,</span> <span class="mf">.450</span><span class="p">,</span> <span class="mf">.425</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="n">midrise_mat</span><span class="o">.</span><span class="n">base_reflectance</span> <span class="o">=</span> <span class="mf">0.1</span>
    <span class="n">skyscraper_mat</span> <span class="o">=</span> <span class="n">vis</span><span class="o">.</span><span class="n">rendering</span><span class="o">.</span><span class="n">MaterialRecord</span><span class="p">()</span>
    <span class="n">skyscraper_mat</span><span class="o">.</span><span class="n">shader</span> <span class="o">=</span> <span class="s2">&quot;defaultLit&quot;</span>
    <span class="n">skyscraper_mat</span><span class="o">.</span><span class="n">base_color</span> <span class="o">=</span> <span class="p">(</span><span class="mf">.05</span><span class="p">,</span> <span class="mf">.20</span><span class="p">,</span> <span class="mf">.55</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="n">skyscraper_mat</span><span class="o">.</span><span class="n">base_reflectance</span> <span class="o">=</span> <span class="mf">0.9</span>
    <span class="n">skyscraper_mat</span><span class="o">.</span><span class="n">base_roughness</span> <span class="o">=</span> <span class="mf">0.01</span>

    <span class="n">buildings</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">size</span> <span class="o">=</span> <span class="mf">10.0</span>
    <span class="n">half</span> <span class="o">=</span> <span class="n">size</span> <span class="o">/</span> <span class="mf">2.0</span>
    <span class="n">min_height</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">max_height</span> <span class="o">=</span> <span class="mf">20.0</span>
    <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
            <span class="n">max_h</span> <span class="o">=</span> <span class="n">max_height</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="nb">abs</span><span class="p">(</span><span class="n">half</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="n">half</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
                <span class="mf">1.0</span> <span class="o">-</span> <span class="nb">abs</span><span class="p">(</span><span class="n">half</span> <span class="o">-</span> <span class="n">z</span><span class="p">)</span> <span class="o">/</span> <span class="n">half</span><span class="p">)</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">min_height</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_h</span><span class="p">,</span> <span class="n">min_height</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">))</span>
            <span class="n">box</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">TriangleMesh</span><span class="o">.</span><span class="n">create_box</span><span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">)</span>
            <span class="n">box</span><span class="o">.</span><span class="n">compute_triangle_normals</span><span class="p">()</span>
            <span class="n">box</span><span class="o">.</span><span class="n">translate</span><span class="p">((</span><span class="n">x</span> <span class="o">+</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">z</span> <span class="o">+</span> <span class="mf">0.05</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">h</span> <span class="o">&gt;</span> <span class="mf">0.333</span> <span class="o">*</span> <span class="n">max_height</span><span class="p">:</span>
                <span class="n">mat</span> <span class="o">=</span> <span class="n">skyscraper_mat</span>
            <span class="k">elif</span> <span class="n">h</span> <span class="o">&gt;</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">max_height</span><span class="p">:</span>
                <span class="n">mat</span> <span class="o">=</span> <span class="n">midrise_mat</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mat</span> <span class="o">=</span> <span class="n">building_mat</span>
            <span class="n">buildings</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;building_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">z</span><span class="p">),</span>
                <span class="s2">&quot;geometry&quot;</span><span class="p">:</span> <span class="n">box</span><span class="p">,</span>
                <span class="s2">&quot;material&quot;</span><span class="p">:</span> <span class="n">mat</span><span class="p">,</span>
                <span class="s2">&quot;group&quot;</span><span class="p">:</span> <span class="s2">&quot;buildings&quot;</span>
            <span class="p">})</span>

    <span class="n">haze</span> <span class="o">=</span> <span class="n">make_point_cloud</span><span class="p">(</span><span class="mi">5000</span><span class="p">,</span> <span class="p">(</span><span class="n">half</span><span class="p">,</span> <span class="mf">0.333</span> <span class="o">*</span> <span class="n">max_height</span><span class="p">,</span> <span class="n">half</span><span class="p">),</span>
                            <span class="mf">1.414</span> <span class="o">*</span> <span class="n">half</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">haze</span><span class="o">.</span><span class="n">paint_uniform_color</span><span class="p">((</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">))</span>

    <span class="n">smog</span> <span class="o">=</span> <span class="n">make_point_cloud</span><span class="p">(</span><span class="mi">10000</span><span class="p">,</span> <span class="p">(</span><span class="n">half</span><span class="p">,</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="n">max_height</span><span class="p">,</span> <span class="n">half</span><span class="p">),</span> <span class="mf">1.2</span> <span class="o">*</span> <span class="n">half</span><span class="p">,</span>
                            <span class="kc">False</span><span class="p">)</span>
    <span class="n">smog</span><span class="o">.</span><span class="n">paint_uniform_color</span><span class="p">((</span><span class="mf">0.95</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">))</span>

    <span class="n">vis</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">buildings</span> <span class="o">+</span> <span class="p">[{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;haze&quot;</span><span class="p">,</span>
        <span class="s2">&quot;geometry&quot;</span><span class="p">:</span> <span class="n">haze</span><span class="p">,</span>
        <span class="s2">&quot;group&quot;</span><span class="p">:</span> <span class="s2">&quot;haze&quot;</span>
    <span class="p">},</span> <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;smog&quot;</span><span class="p">,</span>
        <span class="s2">&quot;geometry&quot;</span><span class="p">:</span> <span class="n">smog</span><span class="p">,</span>
        <span class="s2">&quot;group&quot;</span><span class="p">:</span> <span class="s2">&quot;smog&quot;</span>
    <span class="p">}])</span>


<span class="k">def</span> <span class="nf">remove</span><span class="p">():</span>

    <span class="k">def</span> <span class="nf">make_sphere</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">time</span><span class="p">):</span>
        <span class="n">sphere</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">TriangleMesh</span><span class="o">.</span><span class="n">create_sphere</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">sphere</span><span class="o">.</span><span class="n">compute_vertex_normals</span><span class="p">()</span>
        <span class="n">sphere</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">center</span><span class="p">)</span>

        <span class="n">mat</span> <span class="o">=</span> <span class="n">vis</span><span class="o">.</span><span class="n">rendering</span><span class="o">.</span><span class="n">Material</span><span class="p">()</span>
        <span class="n">mat</span><span class="o">.</span><span class="n">shader</span> <span class="o">=</span> <span class="s2">&quot;defaultLit&quot;</span>
        <span class="n">mat</span><span class="o">.</span><span class="n">base_color</span> <span class="o">=</span> <span class="n">color</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
            <span class="s2">&quot;geometry&quot;</span><span class="p">:</span> <span class="n">sphere</span><span class="p">,</span>
            <span class="s2">&quot;material&quot;</span><span class="p">:</span> <span class="n">mat</span><span class="p">,</span>
            <span class="s2">&quot;group&quot;</span><span class="p">:</span> <span class="n">group</span><span class="p">,</span>
            <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">time</span>
        <span class="p">}</span>

    <span class="n">red</span> <span class="o">=</span> <span class="n">make_sphere</span><span class="p">(</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="s2">&quot;spheres&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">green</span> <span class="o">=</span> <span class="n">make_sphere</span><span class="p">(</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="s2">&quot;spheres&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">blue</span> <span class="o">=</span> <span class="n">make_sphere</span><span class="p">(</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="s2">&quot;spheres&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">yellow</span> <span class="o">=</span> <span class="n">make_sphere</span><span class="p">(</span><span class="s2">&quot;yellow&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="s2">&quot;spheres&quot;</span><span class="p">,</span>
                         <span class="mi">1</span><span class="p">)</span>
    <span class="n">bbox</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;bbox&quot;</span><span class="p">,</span>
        <span class="s2">&quot;geometry&quot;</span><span class="p">:</span> <span class="n">red</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get_axis_aligned_bounding_box</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="nf">remove_green</span><span class="p">(</span><span class="n">visdraw</span><span class="p">):</span>
        <span class="n">visdraw</span><span class="o">.</span><span class="n">remove_geometry</span><span class="p">(</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">remove_yellow</span><span class="p">(</span><span class="n">visdraw</span><span class="p">):</span>
        <span class="n">visdraw</span><span class="o">.</span><span class="n">remove_geometry</span><span class="p">(</span><span class="s2">&quot;yellow&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">remove_bbox</span><span class="p">(</span><span class="n">visdraw</span><span class="p">):</span>
        <span class="n">visdraw</span><span class="o">.</span><span class="n">remove_geometry</span><span class="p">(</span><span class="s2">&quot;bbox&quot;</span><span class="p">)</span>

    <span class="n">vis</span><span class="o">.</span><span class="n">draw</span><span class="p">([</span><span class="n">red</span><span class="p">,</span> <span class="n">green</span><span class="p">,</span> <span class="n">blue</span><span class="p">,</span> <span class="n">yellow</span><span class="p">,</span> <span class="n">bbox</span><span class="p">],</span>
             <span class="n">actions</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot;Remove Green&quot;</span><span class="p">,</span> <span class="n">remove_green</span><span class="p">),</span>
                      <span class="p">(</span><span class="s2">&quot;Remove Yellow&quot;</span><span class="p">,</span> <span class="n">remove_yellow</span><span class="p">),</span>
                      <span class="p">(</span><span class="s2">&quot;Remove Bounds&quot;</span><span class="p">,</span> <span class="n">remove_bbox</span><span class="p">)])</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">single_object</span><span class="p">()</span>
    <span class="n">multi_objects</span><span class="p">()</span>
    <span class="n">actions</span><span class="p">()</span>
    <span class="n">selections</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div></td></tr></table></div>
</div>
</div>
<div class="section" id="draw-webrtc-py">
<h2>draw_webrtc.py<a class="headerlink" href="#draw-webrtc-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span></pre></div></td><td class="code"><div><pre><span></span><span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># -                        Open3D: www.open3d.org                            -</span>
<span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># Copyright (c) 2018-2023 www.open3d.org</span>
<span class="c1"># SPDX-License-Identifier: MIT</span>
<span class="c1"># ----------------------------------------------------------------------------</span>

<span class="kn">import</span> <span class="nn">open3d</span> <span class="k">as</span> <span class="nn">o3d</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">o3d</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">webrtc_server</span><span class="o">.</span><span class="n">enable_webrtc</span><span class="p">()</span>
    <span class="n">cube_red</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">TriangleMesh</span><span class="o">.</span><span class="n">create_box</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
    <span class="n">cube_red</span><span class="o">.</span><span class="n">compute_vertex_normals</span><span class="p">()</span>
    <span class="n">cube_red</span><span class="o">.</span><span class="n">paint_uniform_color</span><span class="p">((</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>
    <span class="n">o3d</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">cube_red</span><span class="p">)</span>
</pre></div></td></tr></table></div>
</div>
</div>
<div class="section" id="headless-rendering-py">
<h2>headless_rendering.py<a class="headerlink" href="#headless-rendering-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span></pre></div></td><td class="code"><div><pre><span></span><span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># -                        Open3D: www.open3d.org                            -</span>
<span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># Copyright (c) 2018-2023 www.open3d.org</span>
<span class="c1"># SPDX-License-Identifier: MIT</span>
<span class="c1"># ----------------------------------------------------------------------------</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">open3d</span> <span class="k">as</span> <span class="nn">o3d</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>


<span class="k">def</span> <span class="nf">custom_draw_geometry_with_camera_trajectory</span><span class="p">(</span><span class="n">pcd</span><span class="p">,</span> <span class="n">camera_trajectory_path</span><span class="p">,</span>
                                                <span class="n">render_option_path</span><span class="p">,</span>
                                                <span class="n">output_path</span><span class="p">):</span>
    <span class="n">custom_draw_geometry_with_camera_trajectory</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">custom_draw_geometry_with_camera_trajectory</span><span class="o">.</span><span class="n">trajectory</span> <span class="o">=</span>\
        <span class="n">o3d</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_pinhole_camera_trajectory</span><span class="p">(</span><span class="n">camera_trajectory_path</span><span class="p">)</span>
    <span class="n">custom_draw_geometry_with_camera_trajectory</span><span class="o">.</span><span class="n">vis</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">Visualizer</span><span class="p">(</span>
    <span class="p">)</span>
    <span class="n">image_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="s1">&#39;image&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">image_path</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">image_path</span><span class="p">)</span>
    <span class="n">depth_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="s1">&#39;depth&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">depth_path</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">depth_path</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saving color images in &quot;</span> <span class="o">+</span> <span class="n">image_path</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saving depth images in &quot;</span> <span class="o">+</span> <span class="n">depth_path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">move_forward</span><span class="p">(</span><span class="n">vis</span><span class="p">):</span>
        <span class="c1"># This function is called within the o3d.visualization.Visualizer::run() loop</span>
        <span class="c1"># The run loop calls the function, then re-render</span>
        <span class="c1"># So the sequence in this function is to:</span>
        <span class="c1"># 1. Capture frame</span>
        <span class="c1"># 2. index++, check ending criteria</span>
        <span class="c1"># 3. Set camera</span>
        <span class="c1"># 4. (Re-render)</span>
        <span class="n">ctr</span> <span class="o">=</span> <span class="n">vis</span><span class="o">.</span><span class="n">get_view_control</span><span class="p">()</span>
        <span class="n">glb</span> <span class="o">=</span> <span class="n">custom_draw_geometry_with_camera_trajectory</span>
        <span class="k">if</span> <span class="n">glb</span><span class="o">.</span><span class="n">index</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Capture image </span><span class="si">{:05d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">glb</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
            <span class="c1"># Capture and save image using Open3D.</span>
            <span class="n">vis</span><span class="o">.</span><span class="n">capture_depth_image</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">depth_path</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{:05d}</span><span class="s2">.png&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">glb</span><span class="o">.</span><span class="n">index</span><span class="p">)),</span> <span class="kc">False</span><span class="p">)</span>
            <span class="n">vis</span><span class="o">.</span><span class="n">capture_screen_image</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">image_path</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{:05d}</span><span class="s2">.png&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">glb</span><span class="o">.</span><span class="n">index</span><span class="p">)),</span> <span class="kc">False</span><span class="p">)</span>

            <span class="c1"># Example to save image using matplotlib.</span>
<span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            depth = vis.capture_depth_float_buffer()</span>
<span class="sd">            image = vis.capture_screen_float_buffer()</span>
<span class="sd">            plt.imsave(os.path.join(depth_path, &quot;{:05d}.png&quot;.format(glb.index)),</span>
<span class="sd">                       np.asarray(depth),</span>
<span class="sd">                       dpi=1)</span>
<span class="sd">            plt.imsave(os.path.join(image_path, &quot;{:05d}.png&quot;.format(glb.index)),</span>
<span class="sd">                       np.asarray(image),</span>
<span class="sd">                       dpi=1)</span>
<span class="sd">            &#39;&#39;&#39;</span>

        <span class="n">glb</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">glb</span><span class="o">.</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">glb</span><span class="o">.</span><span class="n">index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">glb</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">parameters</span><span class="p">):</span>
            <span class="n">ctr</span><span class="o">.</span><span class="n">convert_from_pinhole_camera_parameters</span><span class="p">(</span>
                <span class="n">glb</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">glb</span><span class="o">.</span><span class="n">index</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">custom_draw_geometry_with_camera_trajectory</span><span class="o">.</span><span class="n">vis</span><span class="o">.</span><span class="n">destroy_window</span><span class="p">()</span>

        <span class="c1"># Return false as we don&#39;t need to call UpdateGeometry()</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="n">vis</span> <span class="o">=</span> <span class="n">custom_draw_geometry_with_camera_trajectory</span><span class="o">.</span><span class="n">vis</span>
    <span class="n">vis</span><span class="o">.</span><span class="n">create_window</span><span class="p">()</span>
    <span class="n">vis</span><span class="o">.</span><span class="n">add_geometry</span><span class="p">(</span><span class="n">pcd</span><span class="p">)</span>
    <span class="n">vis</span><span class="o">.</span><span class="n">get_render_option</span><span class="p">()</span><span class="o">.</span><span class="n">load_from_json</span><span class="p">(</span><span class="n">render_option_path</span><span class="p">)</span>
    <span class="n">vis</span><span class="o">.</span><span class="n">register_animation_callback</span><span class="p">(</span><span class="n">move_forward</span><span class="p">)</span>
    <span class="n">vis</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">o3d</span><span class="o">.</span><span class="n">_build_config</span><span class="p">[</span><span class="s1">&#39;ENABLE_HEADLESS_RENDERING&#39;</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Headless rendering is not enabled. &quot;</span>
              <span class="s2">&quot;Please rebuild Open3D with ENABLE_HEADLESS_RENDERING=ON&quot;</span><span class="p">)</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">sample_data</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DemoCustomVisualization</span><span class="p">()</span>
    <span class="n">pcd</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_point_cloud</span><span class="p">(</span><span class="n">sample_data</span><span class="o">.</span><span class="n">point_cloud_path</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Customized visualization playing a camera trajectory. &quot;</span>
          <span class="s2">&quot;Press ctrl+z to terminate.&quot;</span><span class="p">)</span>
    <span class="n">custom_draw_geometry_with_camera_trajectory</span><span class="p">(</span>
        <span class="n">pcd</span><span class="p">,</span> <span class="n">sample_data</span><span class="o">.</span><span class="n">camera_trajectory_path</span><span class="p">,</span> <span class="n">sample_data</span><span class="o">.</span><span class="n">render_option_path</span><span class="p">,</span>
        <span class="s1">&#39;HeadlessRenderingOutput&#39;</span><span class="p">)</span>
</pre></div></td></tr></table></div>
</div>
</div>
<div class="section" id="interactive-visualization-py">
<h2>interactive_visualization.py<a class="headerlink" href="#interactive-visualization-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span></pre></div></td><td class="code"><div><pre><span></span><span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># -                        Open3D: www.open3d.org                            -</span>
<span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># Copyright (c) 2018-2023 www.open3d.org</span>
<span class="c1"># SPDX-License-Identifier: MIT</span>
<span class="c1"># ----------------------------------------------------------------------------</span>

<span class="c1"># examples/python/visualization/interactive_visualization.py</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">open3d</span> <span class="k">as</span> <span class="nn">o3d</span>


<span class="k">def</span> <span class="nf">demo_crop_geometry</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Demo for manual geometry cropping&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="s2">&quot;1) Press &#39;Y&#39; twice to align geometry with negative direction of y-axis&quot;</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;2) Press &#39;K&#39; to lock screen and to switch to selection mode&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;3) Drag for rectangle selection,&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   or use ctrl + left click for polygon selection&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;4) Press &#39;C&#39; to get a selected geometry&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;5) Press &#39;S&#39; to save the selected geometry&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;6) Press &#39;F&#39; to switch to freeview mode&quot;</span><span class="p">)</span>
    <span class="n">pcd_data</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DemoICPPointClouds</span><span class="p">()</span>
    <span class="n">pcd</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_point_cloud</span><span class="p">(</span><span class="n">pcd_data</span><span class="o">.</span><span class="n">paths</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">o3d</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">draw_geometries_with_editing</span><span class="p">([</span><span class="n">pcd</span><span class="p">])</span>


<span class="k">def</span> <span class="nf">draw_registration_result</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">transformation</span><span class="p">):</span>
    <span class="n">source_temp</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
    <span class="n">target_temp</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
    <span class="n">source_temp</span><span class="o">.</span><span class="n">paint_uniform_color</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.706</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">target_temp</span><span class="o">.</span><span class="n">paint_uniform_color</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.651</span><span class="p">,</span> <span class="mf">0.929</span><span class="p">])</span>
    <span class="n">source_temp</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">transformation</span><span class="p">)</span>
    <span class="n">o3d</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">draw_geometries</span><span class="p">([</span><span class="n">source_temp</span><span class="p">,</span> <span class="n">target_temp</span><span class="p">])</span>


<span class="k">def</span> <span class="nf">pick_points</span><span class="p">(</span><span class="n">pcd</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="s2">&quot;1) Please pick at least three correspondences using [shift + left click]&quot;</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   Press [shift + right click] to undo point picking&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;2) After picking points, press &#39;Q&#39; to close the window&quot;</span><span class="p">)</span>
    <span class="n">vis</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">VisualizerWithEditing</span><span class="p">()</span>
    <span class="n">vis</span><span class="o">.</span><span class="n">create_window</span><span class="p">()</span>
    <span class="n">vis</span><span class="o">.</span><span class="n">add_geometry</span><span class="p">(</span><span class="n">pcd</span><span class="p">)</span>
    <span class="n">vis</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>  <span class="c1"># user picks points</span>
    <span class="n">vis</span><span class="o">.</span><span class="n">destroy_window</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">vis</span><span class="o">.</span><span class="n">get_picked_points</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">demo_manual_registration</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Demo for manual ICP&quot;</span><span class="p">)</span>
    <span class="n">pcd_data</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DemoICPPointClouds</span><span class="p">()</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_point_cloud</span><span class="p">(</span><span class="n">pcd_data</span><span class="o">.</span><span class="n">paths</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">target</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_point_cloud</span><span class="p">(</span><span class="n">pcd_data</span><span class="o">.</span><span class="n">paths</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Visualization of two point clouds before manual alignment&quot;</span><span class="p">)</span>
    <span class="n">draw_registration_result</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>

    <span class="c1"># pick points from two point clouds and builds correspondences</span>
    <span class="n">picked_id_source</span> <span class="o">=</span> <span class="n">pick_points</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
    <span class="n">picked_id_target</span> <span class="o">=</span> <span class="n">pick_points</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
    <span class="k">assert</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">picked_id_source</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">picked_id_target</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">)</span>
    <span class="k">assert</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">picked_id_source</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">picked_id_target</span><span class="p">))</span>
    <span class="n">corr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">picked_id_source</span><span class="p">),</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">corr</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">picked_id_source</span>
    <span class="n">corr</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">picked_id_target</span>

    <span class="c1"># estimate rough transformation using correspondences</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Compute a rough transform using the correspondences given by user&quot;</span><span class="p">)</span>
    <span class="n">p2p</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">pipelines</span><span class="o">.</span><span class="n">registration</span><span class="o">.</span><span class="n">TransformationEstimationPointToPoint</span><span class="p">()</span>
    <span class="n">trans_init</span> <span class="o">=</span> <span class="n">p2p</span><span class="o">.</span><span class="n">compute_transformation</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span>
                                            <span class="n">o3d</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">Vector2iVector</span><span class="p">(</span><span class="n">corr</span><span class="p">))</span>

    <span class="c1"># point-to-point ICP for refinement</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Perform point-to-point ICP refinement&quot;</span><span class="p">)</span>
    <span class="n">threshold</span> <span class="o">=</span> <span class="mf">0.03</span>  <span class="c1"># 3cm distance threshold</span>
    <span class="n">reg_p2p</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">pipelines</span><span class="o">.</span><span class="n">registration</span><span class="o">.</span><span class="n">registration_icp</span><span class="p">(</span>
        <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">trans_init</span><span class="p">,</span>
        <span class="n">o3d</span><span class="o">.</span><span class="n">pipelines</span><span class="o">.</span><span class="n">registration</span><span class="o">.</span><span class="n">TransformationEstimationPointToPoint</span><span class="p">())</span>
    <span class="n">draw_registration_result</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">reg_p2p</span><span class="o">.</span><span class="n">transformation</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">demo_crop_geometry</span><span class="p">()</span>
    <span class="n">demo_manual_registration</span><span class="p">()</span>
</pre></div></td></tr></table></div>
</div>
</div>
<div class="section" id="line-width-py">
<h2>line_width.py<a class="headerlink" href="#line-width-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span></pre></div></td><td class="code"><div><pre><span></span><span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># -                        Open3D: www.open3d.org                            -</span>
<span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># Copyright (c) 2018-2023 www.open3d.org</span>
<span class="c1"># SPDX-License-Identifier: MIT</span>
<span class="c1"># ----------------------------------------------------------------------------</span>

<span class="kn">import</span> <span class="nn">open3d</span> <span class="k">as</span> <span class="nn">o3d</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="n">NUM_LINES</span> <span class="o">=</span> <span class="mi">10</span>


<span class="k">def</span> <span class="nf">random_point</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">[</span><span class="mi">5</span> <span class="o">*</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(),</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(),</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()]</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">pts</span> <span class="o">=</span> <span class="p">[</span><span class="n">random_point</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">NUM_LINES</span><span class="p">)]</span>
    <span class="n">line_indices</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">NUM_LINES</span><span class="p">)]</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">NUM_LINES</span><span class="p">)]</span>

    <span class="n">lines</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">LineSet</span><span class="p">()</span>
    <span class="n">lines</span><span class="o">.</span><span class="n">points</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">Vector3dVector</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span>
    <span class="n">lines</span><span class="o">.</span><span class="n">lines</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">Vector2iVector</span><span class="p">(</span><span class="n">line_indices</span><span class="p">)</span>
    <span class="c1"># The default color of the lines is white, which will be invisible on the</span>
    <span class="c1"># default white background. So we either need to set the color of the lines</span>
    <span class="c1"># or the base_color of the material.</span>
    <span class="n">lines</span><span class="o">.</span><span class="n">colors</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">Vector3dVector</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span>

    <span class="c1"># Some platforms do not require OpenGL implementations to support wide lines,</span>
    <span class="c1"># so the renderer requires a custom shader to implement this: &quot;unlitLine&quot;.</span>
    <span class="c1"># The line_width field is only used by this shader; all other shaders ignore</span>
    <span class="c1"># it.</span>
    <span class="n">mat</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">rendering</span><span class="o">.</span><span class="n">MaterialRecord</span><span class="p">()</span>
    <span class="n">mat</span><span class="o">.</span><span class="n">shader</span> <span class="o">=</span> <span class="s2">&quot;unlitLine&quot;</span>
    <span class="n">mat</span><span class="o">.</span><span class="n">line_width</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># note that this is scaled with respect to pixels,</span>
    <span class="c1"># so will give different results depending on the</span>
    <span class="c1"># scaling values of your system</span>
    <span class="n">o3d</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">draw</span><span class="p">({</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;lines&quot;</span><span class="p">,</span>
        <span class="s2">&quot;geometry&quot;</span><span class="p">:</span> <span class="n">lines</span><span class="p">,</span>
        <span class="s2">&quot;material&quot;</span><span class="p">:</span> <span class="n">mat</span>
    <span class="p">})</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div></td></tr></table></div>
</div>
</div>
<div class="section" id="load-save-viewpoint-py">
<h2>load_save_viewpoint.py<a class="headerlink" href="#load-save-viewpoint-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span></pre></div></td><td class="code"><div><pre><span></span><span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># -                        Open3D: www.open3d.org                            -</span>
<span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># Copyright (c) 2018-2023 www.open3d.org</span>
<span class="c1"># SPDX-License-Identifier: MIT</span>
<span class="c1"># ----------------------------------------------------------------------------</span>

<span class="kn">import</span> <span class="nn">open3d</span> <span class="k">as</span> <span class="nn">o3d</span>


<span class="k">def</span> <span class="nf">save_view_point</span><span class="p">(</span><span class="n">pcd</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
    <span class="n">vis</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">Visualizer</span><span class="p">()</span>
    <span class="n">vis</span><span class="o">.</span><span class="n">create_window</span><span class="p">()</span>
    <span class="n">vis</span><span class="o">.</span><span class="n">add_geometry</span><span class="p">(</span><span class="n">pcd</span><span class="p">)</span>
    <span class="n">vis</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>  <span class="c1"># user changes the view and press &quot;q&quot; to terminate</span>
    <span class="n">param</span> <span class="o">=</span> <span class="n">vis</span><span class="o">.</span><span class="n">get_view_control</span><span class="p">()</span><span class="o">.</span><span class="n">convert_to_pinhole_camera_parameters</span><span class="p">()</span>
    <span class="n">o3d</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">write_pinhole_camera_parameters</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">param</span><span class="p">)</span>
    <span class="n">vis</span><span class="o">.</span><span class="n">destroy_window</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">load_view_point</span><span class="p">(</span><span class="n">pcd</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
    <span class="n">vis</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">Visualizer</span><span class="p">()</span>
    <span class="n">vis</span><span class="o">.</span><span class="n">create_window</span><span class="p">()</span>
    <span class="n">ctr</span> <span class="o">=</span> <span class="n">vis</span><span class="o">.</span><span class="n">get_view_control</span><span class="p">()</span>
    <span class="n">param</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_pinhole_camera_parameters</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">vis</span><span class="o">.</span><span class="n">add_geometry</span><span class="p">(</span><span class="n">pcd</span><span class="p">)</span>
    <span class="n">ctr</span><span class="o">.</span><span class="n">convert_from_pinhole_camera_parameters</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
    <span class="n">vis</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">vis</span><span class="o">.</span><span class="n">destroy_window</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">pcd_data</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">PCDPointCloud</span><span class="p">()</span>
    <span class="n">pcd</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_point_cloud</span><span class="p">(</span><span class="n">pcd_data</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
    <span class="n">save_view_point</span><span class="p">(</span><span class="n">pcd</span><span class="p">,</span> <span class="s2">&quot;viewpoint.json&quot;</span><span class="p">)</span>
    <span class="n">load_view_point</span><span class="p">(</span><span class="n">pcd</span><span class="p">,</span> <span class="s2">&quot;viewpoint.json&quot;</span><span class="p">)</span>
</pre></div></td></tr></table></div>
</div>
</div>
<div class="section" id="mitsuba-material-estimation-py">
<h2>mitsuba_material_estimation.py<a class="headerlink" href="#mitsuba-material-estimation-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span></pre></div></td><td class="code"><div><pre><span></span><span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># -                        Open3D: www.open3d.org                            -</span>
<span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># Copyright (c) 2018-2023 www.open3d.org</span>
<span class="c1"># SPDX-License-Identifier: MIT</span>
<span class="c1"># ----------------------------------------------------------------------------</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">open3d</span> <span class="k">as</span> <span class="nn">o3d</span>
<span class="kn">import</span> <span class="nn">mitsuba</span> <span class="k">as</span> <span class="nn">mi</span>
<span class="kn">import</span> <span class="nn">drjit</span> <span class="k">as</span> <span class="nn">dr</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">math</span>


<span class="k">def</span> <span class="nf">make_mitsuba_scene</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">cam_xform</span><span class="p">,</span> <span class="n">fov</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">principle_pts</span><span class="p">,</span>
                       <span class="n">envmap</span><span class="p">):</span>
    <span class="c1"># Camera transform</span>
    <span class="n">t_from_np</span> <span class="o">=</span> <span class="n">mi</span><span class="o">.</span><span class="n">ScalarTransform4f</span><span class="p">(</span><span class="n">cam_xform</span><span class="p">)</span>
    <span class="c1"># Transform necessary to get from Open3D&#39;s environment map coordinate system</span>
    <span class="c1"># to Mitsuba&#39;s</span>
    <span class="n">env_t</span> <span class="o">=</span> <span class="n">mi</span><span class="o">.</span><span class="n">ScalarTransform4f</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                                        <span class="n">angle</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                                         <span class="n">angle</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
    <span class="n">scene_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;scene&quot;</span><span class="p">,</span>
        <span class="s2">&quot;integrator&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;path&#39;</span>
        <span class="p">},</span>
        <span class="s2">&quot;light&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;envmap&quot;</span><span class="p">,</span>
            <span class="s2">&quot;to_world&quot;</span><span class="p">:</span> <span class="n">env_t</span><span class="p">,</span>
            <span class="s2">&quot;bitmap&quot;</span><span class="p">:</span> <span class="n">mi</span><span class="o">.</span><span class="n">Bitmap</span><span class="p">(</span><span class="n">envmap</span><span class="p">),</span>
        <span class="p">},</span>
        <span class="s2">&quot;sensor&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;perspective&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fov&quot;</span><span class="p">:</span> <span class="n">fov</span><span class="p">,</span>
            <span class="s2">&quot;to_world&quot;</span><span class="p">:</span> <span class="n">t_from_np</span><span class="p">,</span>
            <span class="s2">&quot;principal_point_offset_x&quot;</span><span class="p">:</span> <span class="n">principle_pts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="s2">&quot;principal_point_offset_y&quot;</span><span class="p">:</span> <span class="n">principle_pts</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="s2">&quot;thefilm&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;hdrfilm&quot;</span><span class="p">,</span>
                <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="n">width</span><span class="p">,</span>
                <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="n">height</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;thesampler&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;multijitter&quot;</span><span class="p">,</span>
                <span class="s2">&quot;sample_count&quot;</span><span class="p">:</span> <span class="mi">64</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">},</span>
        <span class="s2">&quot;themesh&quot;</span><span class="p">:</span> <span class="n">mesh</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">scene</span> <span class="o">=</span> <span class="n">mi</span><span class="o">.</span><span class="n">load_dict</span><span class="p">(</span><span class="n">scene_dict</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">scene</span>


<span class="k">def</span> <span class="nf">run_estimation</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">cam_info</span><span class="p">,</span> <span class="n">ref_image</span><span class="p">,</span> <span class="n">env_width</span><span class="p">,</span> <span class="n">iterations</span><span class="p">,</span> <span class="n">tv_alpha</span><span class="p">):</span>
    <span class="c1"># Make Mitsuba mesh from Open3D mesh -- conversion will attach a Mitsuba</span>
    <span class="c1"># Principled BSDF to the mesh</span>
    <span class="n">mesh_opt</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">to_mitsuba</span><span class="p">(</span><span class="s1">&#39;themesh&#39;</span><span class="p">)</span>

    <span class="c1"># Prepare empty environment map</span>
    <span class="n">empty_envmap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="n">env_width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="n">env_width</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

    <span class="c1"># Create Mitsuba scene</span>
    <span class="n">scene</span> <span class="o">=</span> <span class="n">make_mitsuba_scene</span><span class="p">(</span><span class="n">mesh_opt</span><span class="p">,</span> <span class="n">cam_info</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cam_info</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">cam_info</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                               <span class="n">cam_info</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">cam_info</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">empty_envmap</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">total_variation</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">alpha</span><span class="p">):</span>
        <span class="n">diff1</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">image</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
        <span class="n">diff2</span> <span class="o">=</span> <span class="n">image</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">image</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
        <span class="k">return</span> <span class="n">alpha</span> <span class="o">*</span> <span class="p">(</span><span class="n">dr</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dr</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">diff1</span><span class="p">))</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">diff1</span><span class="p">)</span> <span class="o">+</span>
                        <span class="n">dr</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dr</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">diff2</span><span class="p">))</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">diff2</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">mse</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">ref_img</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">dr</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dr</span><span class="o">.</span><span class="n">sqr</span><span class="p">(</span><span class="n">image</span> <span class="o">-</span> <span class="n">ref_img</span><span class="p">))</span>

    <span class="n">params</span> <span class="o">=</span> <span class="n">mi</span><span class="o">.</span><span class="n">traverse</span><span class="p">(</span><span class="n">scene</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

    <span class="c1"># Create a Mitsuba Optimizer and configure it to optimize albedo and</span>
    <span class="c1"># environment maps</span>
    <span class="n">opt</span> <span class="o">=</span> <span class="n">mi</span><span class="o">.</span><span class="n">ad</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">lr</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">mask_updates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">opt</span><span class="p">[</span><span class="s1">&#39;themesh.bsdf.base_color.data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;themesh.bsdf.base_color.data&#39;</span><span class="p">]</span>
    <span class="n">opt</span><span class="p">[</span><span class="s1">&#39;light.data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;light.data&#39;</span><span class="p">]</span>
    <span class="n">params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">opt</span><span class="p">)</span>

    <span class="n">integrator</span> <span class="o">=</span> <span class="n">mi</span><span class="o">.</span><span class="n">load_dict</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;prb&#39;</span><span class="p">})</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">iterations</span><span class="p">):</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">mi</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">scene</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">spp</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">integrator</span><span class="o">=</span><span class="n">integrator</span><span class="p">)</span>

        <span class="c1"># Compute loss</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="n">mse</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">ref_image</span><span class="p">)</span>
        <span class="c1"># Apply TV regularization if requested</span>
        <span class="k">if</span> <span class="n">tv_alpha</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">loss</span> <span class="o">=</span> <span class="n">loss</span> <span class="o">+</span> <span class="n">total_variation</span><span class="p">(</span><span class="n">opt</span><span class="p">[</span><span class="s1">&#39;themesh.bsdf.base_color.data&#39;</span><span class="p">],</span>
                                          <span class="n">tv_alpha</span><span class="p">)</span>

        <span class="c1"># Backpropogate and step. Note: if we were optimizing over a larger set</span>
        <span class="c1"># of inputs not just a single image we might want to step only every x</span>
        <span class="c1"># number of inputs</span>
        <span class="n">dr</span><span class="o">.</span><span class="n">backward</span><span class="p">(</span><span class="n">loss</span><span class="p">)</span>
        <span class="n">opt</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>

        <span class="c1"># Make sure albedo values stay in allowed range</span>
        <span class="n">opt</span><span class="p">[</span><span class="s1">&#39;themesh.bsdf.base_color.data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dr</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span>
            <span class="n">opt</span><span class="p">[</span><span class="s1">&#39;themesh.bsdf.base_color.data&#39;</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="n">params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">opt</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Iteration </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1"> complete&#39;</span><span class="p">)</span>

    <span class="c1"># Done! Return the estimated maps</span>
    <span class="n">albedo_img</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;themesh.bsdf.base_color.data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
    <span class="n">envmap_img</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;light.data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">albedo_img</span><span class="p">,</span> <span class="n">envmap_img</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">load_input_mesh</span><span class="p">(</span><span class="n">model_path</span><span class="p">,</span> <span class="n">tex_dim</span><span class="p">):</span>
    <span class="n">mesh</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_triangle_mesh</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">model_path</span><span class="p">))</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">set_default_properties</span><span class="p">()</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">material_name</span> <span class="o">=</span> <span class="s1">&#39;defaultLit&#39;</span>  <span class="c1"># note: ignored by Mitsuba, just used to visualize in Open3D</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">texture_maps</span><span class="p">[</span><span class="s1">&#39;albedo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
        <span class="p">(</span><span class="n">tex_dim</span><span class="p">,</span> <span class="n">tex_dim</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">mesh</span>


<span class="k">def</span> <span class="nf">load_input_data</span><span class="p">(</span><span class="nb">object</span><span class="p">,</span> <span class="n">camera_pose</span><span class="p">,</span> <span class="n">input_image</span><span class="p">,</span> <span class="n">tex_dim</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Loading </span><span class="si">{</span><span class="nb">object</span><span class="si">}</span><span class="s1">...&#39;</span><span class="p">)</span>
    <span class="n">mesh</span> <span class="o">=</span> <span class="n">load_input_mesh</span><span class="p">(</span><span class="nb">object</span><span class="p">,</span> <span class="n">tex_dim</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Loading camera pose from </span><span class="si">{</span><span class="n">camera_pose</span><span class="si">}</span><span class="s1">...&#39;</span><span class="p">)</span>
    <span class="n">cam_npz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">camera_pose</span><span class="p">)</span>
    <span class="n">img_width</span> <span class="o">=</span> <span class="n">cam_npz</span><span class="p">[</span><span class="s1">&#39;width&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
    <span class="n">img_height</span> <span class="o">=</span> <span class="n">cam_npz</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
    <span class="n">cam_xform</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">cam_npz</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">])</span>
    <span class="n">cam_xform</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span>
        <span class="n">cam_xform</span><span class="p">,</span>
        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]],</span>
                 <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
    <span class="n">fov</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">img_width</span> <span class="o">/</span> <span class="n">cam_npz</span><span class="p">[</span><span class="s1">&#39;K&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">fov</span> <span class="o">=</span> <span class="p">(</span><span class="mf">180.0</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="n">fov</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
    <span class="n">camera</span> <span class="o">=</span> <span class="p">(</span><span class="n">cam_xform</span><span class="p">,</span> <span class="n">fov</span><span class="p">,</span> <span class="n">img_width</span><span class="p">,</span> <span class="n">img_height</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Loading reference image from </span><span class="si">{</span><span class="n">input_image</span><span class="si">}</span><span class="s1">...&#39;</span><span class="p">)</span>
    <span class="n">ref_img</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_image</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">input_image</span><span class="p">))</span>
    <span class="n">ref_img</span> <span class="o">=</span> <span class="n">ref_img</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">()[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">o3d</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Dtype</span><span class="o">.</span><span class="n">Float32</span><span class="p">)</span> <span class="o">/</span> <span class="mf">255.0</span>
    <span class="n">bmp</span> <span class="o">=</span> <span class="n">mi</span><span class="o">.</span><span class="n">Bitmap</span><span class="p">(</span><span class="n">ref_img</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">srgb_gamma</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ref_img</span> <span class="o">=</span> <span class="n">mi</span><span class="o">.</span><span class="n">TensorXf</span><span class="p">(</span><span class="n">bmp</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">camera</span><span class="p">,</span> <span class="n">ref_img</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span>
        <span class="s2">&quot;Script that estimates texture and environment map from an input image and geometry. You can find data to test this script here: https://github.com/isl-org/open3d_downloads/releases/download/mitsuba-demos/raven_mitsuba.zip.&quot;</span><span class="p">,</span>
        <span class="n">formatter_class</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentDefaultsHelpFormatter</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;object_path&#39;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="n">Path</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span>
        <span class="s2">&quot;Path to geometry for which to estimate albedo. It is assumed that in the same directory will be an object-name.npz which contains the camera pose information and an object-name.png which is the input image&quot;</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--env-width&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">1024</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--tex-width&#39;</span><span class="p">,</span>
                        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="mi">2048</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The dimensions of the texture&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--device&#39;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s1">&#39;cuda&#39;</span> <span class="k">if</span> <span class="n">o3d</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="s1">&#39;cpu&#39;</span><span class="p">,</span>
        <span class="n">choices</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;cpu&#39;</span><span class="p">,</span> <span class="s1">&#39;cuda&#39;</span><span class="p">),</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Run Mitsuba on &#39;cuda&#39; or &#39;cpu&#39;&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--iterations&#39;</span><span class="p">,</span>
                        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Number of iterations&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--total-variation&#39;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Factor to apply to total_variation loss. 0.0 disables TV&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">print_help</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Arguments: &quot;</span><span class="p">,</span> <span class="nb">vars</span><span class="p">(</span><span class="n">args</span><span class="p">))</span>

    <span class="c1"># Initialize Mitsuba</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">device</span> <span class="o">==</span> <span class="s1">&#39;cpu&#39;</span><span class="p">:</span>
        <span class="n">mi</span><span class="o">.</span><span class="n">set_variant</span><span class="p">(</span><span class="s1">&#39;llvm_ad_rgb&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">mi</span><span class="o">.</span><span class="n">set_variant</span><span class="p">(</span><span class="s1">&#39;cuda_ad_rgb&#39;</span><span class="p">)</span>

    <span class="c1"># Confirm that the 3 required inputs exist</span>
    <span class="n">object_path</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">object_path</span>
    <span class="n">object_name</span> <span class="o">=</span> <span class="n">object_path</span><span class="o">.</span><span class="n">stem</span>
    <span class="n">datadir</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">object_path</span><span class="o">.</span><span class="n">parent</span>
    <span class="n">camera_pose</span> <span class="o">=</span> <span class="n">datadir</span> <span class="o">/</span> <span class="p">(</span><span class="n">object_name</span> <span class="o">+</span> <span class="s1">&#39;.npz&#39;</span><span class="p">)</span>
    <span class="n">input_image</span> <span class="o">=</span> <span class="n">datadir</span> <span class="o">/</span> <span class="p">(</span><span class="n">object_name</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">object_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">object_path</span><span class="si">}</span><span class="s1"> does not exist!&#39;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">camera_pose</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">camera_pose</span><span class="si">}</span><span class="s1"> does not exist!&#39;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">input_image</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">input_image</span><span class="si">}</span><span class="s1"> does not exist!&#39;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

    <span class="c1"># Load input data</span>
    <span class="n">mesh</span><span class="p">,</span> <span class="n">cam_info</span><span class="p">,</span> <span class="n">input_image</span> <span class="o">=</span> <span class="n">load_input_data</span><span class="p">(</span><span class="n">object_path</span><span class="p">,</span> <span class="n">camera_pose</span><span class="p">,</span>
                                                  <span class="n">input_image</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">tex_width</span><span class="p">)</span>

    <span class="c1"># Estimate albedo map</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Running material estimation...&#39;</span><span class="p">)</span>
    <span class="n">albedo</span><span class="p">,</span> <span class="n">envmap</span> <span class="o">=</span> <span class="n">run_estimation</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">cam_info</span><span class="p">,</span> <span class="n">input_image</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">env_width</span><span class="p">,</span>
                                    <span class="n">args</span><span class="o">.</span><span class="n">iterations</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">total_variation</span><span class="p">)</span>

    <span class="c1"># Save maps</span>
    <span class="k">def</span> <span class="nf">save_image</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">):</span>
        <span class="c1"># scale to 0-255</span>
        <span class="n">texture</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">img</span> <span class="o">*</span> <span class="mf">255.0</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">o3d</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Dtype</span><span class="o">.</span><span class="n">UInt8</span><span class="p">)</span>
        <span class="n">texture</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="n">texture</span><span class="p">)</span>
        <span class="n">o3d</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">write_image</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">output_dir</span> <span class="o">/</span> <span class="n">name</span><span class="p">),</span> <span class="n">texture</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Saving final results...&#39;</span><span class="p">)</span>
    <span class="n">save_image</span><span class="p">(</span><span class="n">albedo</span><span class="p">,</span> <span class="s1">&#39;estimated_albedo.png&#39;</span><span class="p">,</span> <span class="n">datadir</span><span class="p">)</span>
    <span class="n">mi</span><span class="o">.</span><span class="n">Bitmap</span><span class="p">(</span><span class="n">envmap</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">datadir</span> <span class="o">/</span> <span class="s1">&#39;predicted_envmap.exr&#39;</span><span class="p">))</span>

    <span class="c1"># Visualize result with Open3D</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">texture_maps</span><span class="p">[</span><span class="s1">&#39;albedo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_image</span><span class="p">(</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">datadir</span> <span class="o">/</span> <span class="s1">&#39;estimated_albedo.png&#39;</span><span class="p">))</span>
    <span class="n">o3d</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">mesh</span><span class="p">)</span>
</pre></div></td></tr></table></div>
</div>
</div>
<div class="section" id="mouse-and-point-coord-py">
<h2>mouse_and_point_coord.py<a class="headerlink" href="#mouse-and-point-coord-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span></pre></div></td><td class="code"><div><pre><span></span><span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># -                        Open3D: www.open3d.org                            -</span>
<span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># Copyright (c) 2018-2023 www.open3d.org</span>
<span class="c1"># SPDX-License-Identifier: MIT</span>
<span class="c1"># ----------------------------------------------------------------------------</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">open3d</span> <span class="k">as</span> <span class="nn">o3d</span>
<span class="kn">import</span> <span class="nn">open3d.visualization.gui</span> <span class="k">as</span> <span class="nn">gui</span>
<span class="kn">import</span> <span class="nn">open3d.visualization.rendering</span> <span class="k">as</span> <span class="nn">rendering</span>


<span class="c1"># This example displays a point cloud and if you Ctrl-click on a point</span>
<span class="c1"># (Cmd-click on macOS) it will show the coordinates of the point.</span>
<span class="c1"># This example illustrates:</span>
<span class="c1"># - custom mouse handling on SceneWidget</span>
<span class="c1"># - getting a the depth value of a point (OpenGL depth)</span>
<span class="c1"># - converting from a window point + OpenGL depth to world coordinate</span>
<span class="k">class</span> <span class="nc">ExampleApp</span><span class="p">:</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cloud</span><span class="p">):</span>
        <span class="c1"># We will create a SceneWidget that fills the entire window, and then</span>
        <span class="c1"># a label in the lower left on top of the SceneWidget to display the</span>
        <span class="c1"># coordinate.</span>
        <span class="n">app</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Application</span><span class="o">.</span><span class="n">instance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">create_window</span><span class="p">(</span><span class="s2">&quot;Open3D - GetCoord Example&quot;</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="mi">768</span><span class="p">)</span>
        <span class="c1"># Since we want the label on top of the scene, we cannot use a layout,</span>
        <span class="c1"># so we need to manually layout the window&#39;s children.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">set_on_layout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_layout</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">widget3d</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">SceneWidget</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">widget3d</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">widget3d</span><span class="o">.</span><span class="n">scene</span> <span class="o">=</span> <span class="n">rendering</span><span class="o">.</span><span class="n">Open3DScene</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">renderer</span><span class="p">)</span>

        <span class="n">mat</span> <span class="o">=</span> <span class="n">rendering</span><span class="o">.</span><span class="n">MaterialRecord</span><span class="p">()</span>
        <span class="n">mat</span><span class="o">.</span><span class="n">shader</span> <span class="o">=</span> <span class="s2">&quot;defaultUnlit&quot;</span>
        <span class="c1"># Point size is in native pixels, but &quot;pixel&quot; means different things to</span>
        <span class="c1"># different platforms (macOS, in particular), so multiply by Window scale</span>
        <span class="c1"># factor.</span>
        <span class="n">mat</span><span class="o">.</span><span class="n">point_size</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">scaling</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">widget3d</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">add_geometry</span><span class="p">(</span><span class="s2">&quot;Point Cloud&quot;</span><span class="p">,</span> <span class="n">cloud</span><span class="p">,</span> <span class="n">mat</span><span class="p">)</span>

        <span class="n">bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">widget3d</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">bounding_box</span>
        <span class="n">center</span> <span class="o">=</span> <span class="n">bounds</span><span class="o">.</span><span class="n">get_center</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">widget3d</span><span class="o">.</span><span class="n">setup_camera</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="n">bounds</span><span class="p">,</span> <span class="n">center</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">widget3d</span><span class="o">.</span><span class="n">look_at</span><span class="p">(</span><span class="n">center</span><span class="p">,</span> <span class="n">center</span> <span class="o">-</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">widget3d</span><span class="o">.</span><span class="n">set_on_mouse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_mouse_widget3d</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_on_layout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layout_context</span><span class="p">):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">content_rect</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">widget3d</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">r</span>
        <span class="n">pref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">calc_preferred_size</span><span class="p">(</span><span class="n">layout_context</span><span class="p">,</span>
                                             <span class="n">gui</span><span class="o">.</span><span class="n">Widget</span><span class="o">.</span><span class="n">Constraints</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Rect</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
                                   <span class="n">r</span><span class="o">.</span><span class="n">get_bottom</span><span class="p">()</span> <span class="o">-</span> <span class="n">pref</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="n">pref</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
                                   <span class="n">pref</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_on_mouse_widget3d</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="c1"># We could override BUTTON_DOWN without a modifier, but that would</span>
        <span class="c1"># interfere with manipulating the scene.</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">gui</span><span class="o">.</span><span class="n">MouseEvent</span><span class="o">.</span><span class="n">Type</span><span class="o">.</span><span class="n">BUTTON_DOWN</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">is_modifier_down</span><span class="p">(</span>
                <span class="n">gui</span><span class="o">.</span><span class="n">KeyModifier</span><span class="o">.</span><span class="n">CTRL</span><span class="p">):</span>

            <span class="k">def</span> <span class="nf">depth_callback</span><span class="p">(</span><span class="n">depth_image</span><span class="p">):</span>
                <span class="c1"># Coordinates are expressed in absolute coordinates of the</span>
                <span class="c1"># window, but to dereference the image correctly we need them</span>
                <span class="c1"># relative to the origin of the widget. Note that even if the</span>
                <span class="c1"># scene widget is the only thing in the window, if a menubar</span>
                <span class="c1"># exists it also takes up space in the window (except on macOS).</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">widget3d</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">x</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">widget3d</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">y</span>
                <span class="c1"># Note that np.asarray() reverses the axes.</span>
                <span class="n">depth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">depth_image</span><span class="p">)[</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">depth</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">:</span>  <span class="c1"># clicked on nothing (i.e. the far plane)</span>
                    <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">world</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">widget3d</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">unproject</span><span class="p">(</span>
                        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">widget3d</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">widget3d</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
                    <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;(</span><span class="si">{:.3f}</span><span class="s2">, </span><span class="si">{:.3f}</span><span class="s2">, </span><span class="si">{:.3f}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">world</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">world</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">world</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

                <span class="c1"># This is not called on the main thread, so we need to</span>
                <span class="c1"># post to the main thread to safely access UI items.</span>
                <span class="k">def</span> <span class="nf">update_label</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">text</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="p">(</span><span class="n">text</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                    <span class="c1"># We are sizing the info label to be exactly the right size,</span>
                    <span class="c1"># so since the text likely changed width, we need to</span>
                    <span class="c1"># re-layout to set the new frame.</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">set_needs_layout</span><span class="p">()</span>

                <span class="n">gui</span><span class="o">.</span><span class="n">Application</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">post_to_main_thread</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="p">,</span> <span class="n">update_label</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">widget3d</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">render_to_depth_image</span><span class="p">(</span><span class="n">depth_callback</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">gui</span><span class="o">.</span><span class="n">Widget</span><span class="o">.</span><span class="n">EventCallbackResult</span><span class="o">.</span><span class="n">HANDLED</span>
        <span class="k">return</span> <span class="n">gui</span><span class="o">.</span><span class="n">Widget</span><span class="o">.</span><span class="n">EventCallbackResult</span><span class="o">.</span><span class="n">IGNORED</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Application</span><span class="o">.</span><span class="n">instance</span>
    <span class="n">app</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>

    <span class="c1"># This example will also work with a triangle mesh, or any 3D object.</span>
    <span class="c1"># If you use a triangle mesh you will probably want to set the material</span>
    <span class="c1"># shader to &quot;defaultLit&quot; instead of &quot;defaultUnlit&quot;.</span>
    <span class="n">pcd_data</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DemoICPPointClouds</span><span class="p">()</span>
    <span class="n">cloud</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_point_cloud</span><span class="p">(</span><span class="n">pcd_data</span><span class="o">.</span><span class="n">paths</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">ex</span> <span class="o">=</span> <span class="n">ExampleApp</span><span class="p">(</span><span class="n">cloud</span><span class="p">)</span>

    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div></td></tr></table></div>
</div>
</div>
<div class="section" id="multiple-windows-py">
<h2>multiple_windows.py<a class="headerlink" href="#multiple-windows-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span></pre></div></td><td class="code"><div><pre><span></span><span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># -                        Open3D: www.open3d.org                            -</span>
<span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># Copyright (c) 2018-2023 www.open3d.org</span>
<span class="c1"># SPDX-License-Identifier: MIT</span>
<span class="c1"># ----------------------------------------------------------------------------</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">open3d</span> <span class="k">as</span> <span class="nn">o3d</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="n">CLOUD_NAME</span> <span class="o">=</span> <span class="s2">&quot;points&quot;</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">MultiWinApp</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">MultiWinApp</span><span class="p">:</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_done</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_snapshots</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cloud</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_vis</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">snapshot_pos</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">app</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">Application</span><span class="o">.</span><span class="n">instance</span>
        <span class="n">app</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">main_vis</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">O3DVisualizer</span><span class="p">(</span>
            <span class="s2">&quot;Open3D - Multi-Window Demo&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_vis</span><span class="o">.</span><span class="n">add_action</span><span class="p">(</span><span class="s2">&quot;Take snapshot in new window&quot;</span><span class="p">,</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">on_snapshot</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_vis</span><span class="o">.</span><span class="n">set_on_close</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_main_window_closing</span><span class="p">)</span>

        <span class="n">app</span><span class="o">.</span><span class="n">add_window</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_vis</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">snapshot_pos</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_vis</span><span class="o">.</span><span class="n">os_frame</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_vis</span><span class="o">.</span><span class="n">os_frame</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>

        <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">update_thread</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

        <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">on_snapshot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vis</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_snapshots</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">snapshot_pos</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapshot_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">50</span><span class="p">,</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">snapshot_pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">50</span><span class="p">)</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Open3D - Multi-Window Demo (Snapshot #&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">n_snapshots</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span>
        <span class="n">new_vis</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">O3DVisualizer</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
        <span class="n">mat</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">rendering</span><span class="o">.</span><span class="n">MaterialRecord</span><span class="p">()</span>
        <span class="n">mat</span><span class="o">.</span><span class="n">shader</span> <span class="o">=</span> <span class="s2">&quot;defaultUnlit&quot;</span>
        <span class="n">new_vis</span><span class="o">.</span><span class="n">add_geometry</span><span class="p">(</span><span class="n">CLOUD_NAME</span> <span class="o">+</span> <span class="s2">&quot; #&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_snapshots</span><span class="p">),</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">cloud</span><span class="p">,</span> <span class="n">mat</span><span class="p">)</span>
        <span class="n">new_vis</span><span class="o">.</span><span class="n">reset_camera_to_default</span><span class="p">()</span>
        <span class="n">bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloud</span><span class="o">.</span><span class="n">get_axis_aligned_bounding_box</span><span class="p">()</span>
        <span class="n">extent</span> <span class="o">=</span> <span class="n">bounds</span><span class="o">.</span><span class="n">get_extent</span><span class="p">()</span>
        <span class="n">new_vis</span><span class="o">.</span><span class="n">setup_camera</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="n">bounds</span><span class="o">.</span><span class="n">get_center</span><span class="p">(),</span>
                             <span class="n">bounds</span><span class="o">.</span><span class="n">get_center</span><span class="p">()</span> <span class="o">+</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">o3d</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">Application</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">add_window</span><span class="p">(</span><span class="n">new_vis</span><span class="p">)</span>
        <span class="n">new_vis</span><span class="o">.</span><span class="n">os_frame</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">Rect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapshot_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                      <span class="bp">self</span><span class="o">.</span><span class="n">snapshot_pos</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                                      <span class="n">new_vis</span><span class="o">.</span><span class="n">os_frame</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
                                                      <span class="n">new_vis</span><span class="o">.</span><span class="n">os_frame</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">on_main_window_closing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_done</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">True</span>  <span class="c1"># False would cancel the close</span>

    <span class="k">def</span> <span class="nf">update_thread</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># This is NOT the UI thread, need to call post_to_main_thread() to update</span>
        <span class="c1"># the scene or any part of the UI.</span>
        <span class="n">pcd_data</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DemoICPPointClouds</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cloud</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_point_cloud</span><span class="p">(</span><span class="n">pcd_data</span><span class="o">.</span><span class="n">paths</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloud</span><span class="o">.</span><span class="n">get_axis_aligned_bounding_box</span><span class="p">()</span>
        <span class="n">extent</span> <span class="o">=</span> <span class="n">bounds</span><span class="o">.</span><span class="n">get_extent</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">add_first_cloud</span><span class="p">():</span>
            <span class="n">mat</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">rendering</span><span class="o">.</span><span class="n">MaterialRecord</span><span class="p">()</span>
            <span class="n">mat</span><span class="o">.</span><span class="n">shader</span> <span class="o">=</span> <span class="s2">&quot;defaultUnlit&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_vis</span><span class="o">.</span><span class="n">add_geometry</span><span class="p">(</span><span class="n">CLOUD_NAME</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloud</span><span class="p">,</span> <span class="n">mat</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_vis</span><span class="o">.</span><span class="n">reset_camera_to_default</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_vis</span><span class="o">.</span><span class="n">setup_camera</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="n">bounds</span><span class="o">.</span><span class="n">get_center</span><span class="p">(),</span>
                                       <span class="n">bounds</span><span class="o">.</span><span class="n">get_center</span><span class="p">()</span> <span class="o">+</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">],</span>
                                       <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

        <span class="n">o3d</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">Application</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">post_to_main_thread</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_vis</span><span class="p">,</span> <span class="n">add_first_cloud</span><span class="p">)</span>

        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_done</span><span class="p">:</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>

            <span class="c1"># Perturb the cloud with a random walk to simulate an actual read</span>
            <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cloud</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>
            <span class="n">magnitude</span> <span class="o">=</span> <span class="mf">0.005</span> <span class="o">*</span> <span class="n">extent</span>
            <span class="n">displacement</span> <span class="o">=</span> <span class="n">magnitude</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random_sample</span><span class="p">(</span><span class="n">pts</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">-</span>
                                        <span class="mf">0.5</span><span class="p">)</span>
            <span class="n">new_pts</span> <span class="o">=</span> <span class="n">pts</span> <span class="o">+</span> <span class="n">displacement</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cloud</span><span class="o">.</span><span class="n">points</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">Vector3dVector</span><span class="p">(</span><span class="n">new_pts</span><span class="p">)</span>

            <span class="k">def</span> <span class="nf">update_cloud</span><span class="p">():</span>
                <span class="c1"># Note: if the number of points is less than or equal to the</span>
                <span class="c1">#       number of points in the original object that was added,</span>
                <span class="c1">#       using self.scene.update_geometry() will be faster.</span>
                <span class="c1">#       Requires that the point cloud be a t.PointCloud.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">main_vis</span><span class="o">.</span><span class="n">remove_geometry</span><span class="p">(</span><span class="n">CLOUD_NAME</span><span class="p">)</span>
                <span class="n">mat</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">rendering</span><span class="o">.</span><span class="n">MaterialRecord</span><span class="p">()</span>
                <span class="n">mat</span><span class="o">.</span><span class="n">shader</span> <span class="o">=</span> <span class="s2">&quot;defaultUnlit&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">main_vis</span><span class="o">.</span><span class="n">add_geometry</span><span class="p">(</span><span class="n">CLOUD_NAME</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloud</span><span class="p">,</span> <span class="n">mat</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_done</span><span class="p">:</span>  <span class="c1"># might have changed while sleeping</span>
                <span class="k">break</span>
            <span class="n">o3d</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">Application</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">post_to_main_thread</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">main_vis</span><span class="p">,</span> <span class="n">update_cloud</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div></td></tr></table></div>
</div>
</div>
<div class="section" id="non-blocking-visualization-py">
<h2>non_blocking_visualization.py<a class="headerlink" href="#non-blocking-visualization-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span></pre></div></td><td class="code"><div><pre><span></span><span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># -                        Open3D: www.open3d.org                            -</span>
<span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># Copyright (c) 2018-2023 www.open3d.org</span>
<span class="c1"># SPDX-License-Identifier: MIT</span>
<span class="c1"># ----------------------------------------------------------------------------</span>

<span class="c1"># examples/python/visualization/non_blocking_visualization.py</span>

<span class="kn">import</span> <span class="nn">open3d</span> <span class="k">as</span> <span class="nn">o3d</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">o3d</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">set_verbosity_level</span><span class="p">(</span><span class="n">o3d</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">VerbosityLevel</span><span class="o">.</span><span class="n">Debug</span><span class="p">)</span>
    <span class="n">pcd_data</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DemoICPPointClouds</span><span class="p">()</span>
    <span class="n">source_raw</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_point_cloud</span><span class="p">(</span><span class="n">pcd_data</span><span class="o">.</span><span class="n">paths</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">target_raw</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_point_cloud</span><span class="p">(</span><span class="n">pcd_data</span><span class="o">.</span><span class="n">paths</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">source</span> <span class="o">=</span> <span class="n">source_raw</span><span class="o">.</span><span class="n">voxel_down_sample</span><span class="p">(</span><span class="n">voxel_size</span><span class="o">=</span><span class="mf">0.02</span><span class="p">)</span>
    <span class="n">target</span> <span class="o">=</span> <span class="n">target_raw</span><span class="o">.</span><span class="n">voxel_down_sample</span><span class="p">(</span><span class="n">voxel_size</span><span class="o">=</span><span class="mf">0.02</span><span class="p">)</span>
    <span class="n">trans</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.862</span><span class="p">,</span> <span class="mf">0.011</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.507</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.139</span><span class="p">,</span> <span class="mf">0.967</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.215</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">],</span>
             <span class="p">[</span><span class="mf">0.487</span><span class="p">,</span> <span class="mf">0.255</span><span class="p">,</span> <span class="mf">0.835</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.4</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]]</span>
    <span class="n">source</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">trans</span><span class="p">)</span>

    <span class="n">flip_transform</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>
    <span class="n">source</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">flip_transform</span><span class="p">)</span>
    <span class="n">target</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">flip_transform</span><span class="p">)</span>

    <span class="n">vis</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">Visualizer</span><span class="p">()</span>
    <span class="n">vis</span><span class="o">.</span><span class="n">create_window</span><span class="p">()</span>
    <span class="n">vis</span><span class="o">.</span><span class="n">add_geometry</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
    <span class="n">vis</span><span class="o">.</span><span class="n">add_geometry</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
    <span class="n">threshold</span> <span class="o">=</span> <span class="mf">0.05</span>
    <span class="n">icp_iteration</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">save_image</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">icp_iteration</span><span class="p">):</span>
        <span class="n">reg_p2l</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">pipelines</span><span class="o">.</span><span class="n">registration</span><span class="o">.</span><span class="n">registration_icp</span><span class="p">(</span>
            <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span>
            <span class="n">o3d</span><span class="o">.</span><span class="n">pipelines</span><span class="o">.</span><span class="n">registration</span><span class="o">.</span><span class="n">TransformationEstimationPointToPlane</span><span class="p">(),</span>
            <span class="n">o3d</span><span class="o">.</span><span class="n">pipelines</span><span class="o">.</span><span class="n">registration</span><span class="o">.</span><span class="n">ICPConvergenceCriteria</span><span class="p">(</span><span class="n">max_iteration</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">source</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">reg_p2l</span><span class="o">.</span><span class="n">transformation</span><span class="p">)</span>
        <span class="n">vis</span><span class="o">.</span><span class="n">update_geometry</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
        <span class="n">vis</span><span class="o">.</span><span class="n">poll_events</span><span class="p">()</span>
        <span class="n">vis</span><span class="o">.</span><span class="n">update_renderer</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">save_image</span><span class="p">:</span>
            <span class="n">vis</span><span class="o">.</span><span class="n">capture_screen_image</span><span class="p">(</span><span class="s2">&quot;temp_</span><span class="si">%04d</span><span class="s2">.jpg&quot;</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span>
    <span class="n">vis</span><span class="o">.</span><span class="n">destroy_window</span><span class="p">()</span>
    <span class="n">o3d</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">set_verbosity_level</span><span class="p">(</span><span class="n">o3d</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">VerbosityLevel</span><span class="o">.</span><span class="n">Info</span><span class="p">)</span>
</pre></div></td></tr></table></div>
</div>
</div>
<div class="section" id="non-english-py">
<h2>non_english.py<a class="headerlink" href="#non-english-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span></pre></div></td><td class="code"><div><pre><span></span><span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># -                        Open3D: www.open3d.org                            -</span>
<span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># Copyright (c) 2018-2023 www.open3d.org</span>
<span class="c1"># SPDX-License-Identifier: MIT</span>
<span class="c1"># ----------------------------------------------------------------------------</span>

<span class="kn">import</span> <span class="nn">open3d.visualization.gui</span> <span class="k">as</span> <span class="nn">gui</span>
<span class="kn">import</span> <span class="nn">os.path</span>
<span class="kn">import</span> <span class="nn">platform</span>

<span class="n">basedir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>

<span class="c1"># This is all-widgets.py with some modifications for non-English languages.</span>
<span class="c1"># Please see all-widgets.py for usage of the GUI widgets</span>

<span class="n">MODE_SERIF</span> <span class="o">=</span> <span class="s2">&quot;serif&quot;</span>
<span class="n">MODE_COMMON_HANYU</span> <span class="o">=</span> <span class="s2">&quot;common&quot;</span>
<span class="n">MODE_SERIF_AND_COMMON_HANYU</span> <span class="o">=</span> <span class="s2">&quot;serif+common&quot;</span>
<span class="n">MODE_COMMON_HANYU_EN</span> <span class="o">=</span> <span class="s2">&quot;hanyu_en+common&quot;</span>
<span class="n">MODE_ALL_HANYU</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span>
<span class="n">MODE_CUSTOM_CHARS</span> <span class="o">=</span> <span class="s2">&quot;custom&quot;</span>

<span class="c1">#mode = MODE_SERIF</span>
<span class="c1">#mode = MODE_COMMON_HANYU</span>
<span class="n">mode</span> <span class="o">=</span> <span class="n">MODE_SERIF_AND_COMMON_HANYU</span>
<span class="c1">#mode = MODE_ALL_HANYU</span>
<span class="c1">#mode = MODE_CUSTOM_CHARS</span>

<span class="c1"># Fonts can be names or paths</span>
<span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Darwin&quot;</span><span class="p">:</span>
    <span class="n">serif</span> <span class="o">=</span> <span class="s2">&quot;Times New Roman&quot;</span>
    <span class="n">hanzi</span> <span class="o">=</span> <span class="s2">&quot;STHeiti Light&quot;</span>
    <span class="n">chess</span> <span class="o">=</span> <span class="s2">&quot;/System/Library/Fonts/Apple Symbols.ttf&quot;</span>
<span class="k">elif</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Windows&quot;</span><span class="p">:</span>
    <span class="c1"># it is necessary to specify paths on Windows since it stores its fonts</span>
    <span class="c1"># with a cryptic name, so font name searches do not work on Windows</span>
    <span class="n">serif</span> <span class="o">=</span> <span class="s2">&quot;c:/windows/fonts/times.ttf&quot;</span>  <span class="c1"># Times New Roman</span>
    <span class="n">hanzi</span> <span class="o">=</span> <span class="s2">&quot;c:/windows/fonts/msyh.ttc&quot;</span>  <span class="c1"># YaHei UI</span>
    <span class="n">chess</span> <span class="o">=</span> <span class="s2">&quot;c:/windows/fonts/seguisym.ttf&quot;</span>  <span class="c1"># Segoe UI Symbol</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># Assumes Ubuntu 18.04</span>
    <span class="n">serif</span> <span class="o">=</span> <span class="s2">&quot;DejaVuSerif&quot;</span>
    <span class="n">hanzi</span> <span class="o">=</span> <span class="s2">&quot;NotoSansCJK&quot;</span>
    <span class="n">chess</span> <span class="o">=</span> <span class="s2">&quot;/usr/share/fonts/truetype/freefont/FreeSerif.ttf&quot;</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">gui</span><span class="o">.</span><span class="n">Application</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>

    <span class="c1"># Font changes must be done after initialization but before creating</span>
    <span class="c1"># a window.</span>

    <span class="c1"># MODE_SERIF changes the English font; Chinese will not be displayed</span>
    <span class="n">font</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="n">MODE_SERIF</span><span class="p">:</span>
        <span class="n">font</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">FontDescription</span><span class="p">(</span><span class="n">serif</span><span class="p">)</span>
    <span class="c1"># MODE_COMMON_HANYU uses the default English font and adds common Chinese</span>
    <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="n">MODE_COMMON_HANYU</span><span class="p">:</span>
        <span class="n">font</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">FontDescription</span><span class="p">()</span>
        <span class="n">font</span><span class="o">.</span><span class="n">add_typeface_for_language</span><span class="p">(</span><span class="n">hanzi</span><span class="p">,</span> <span class="s2">&quot;zh&quot;</span><span class="p">)</span>
    <span class="c1"># MODE_SERIF_AND_COMMON_HANYU uses a serif English font and adds common</span>
    <span class="c1"># Chinese characters</span>
    <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="n">MODE_SERIF_AND_COMMON_HANYU</span><span class="p">:</span>
        <span class="n">font</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">FontDescription</span><span class="p">(</span><span class="n">serif</span><span class="p">)</span>
        <span class="n">font</span><span class="o">.</span><span class="n">add_typeface_for_language</span><span class="p">(</span><span class="n">hanzi</span><span class="p">,</span> <span class="s2">&quot;zh&quot;</span><span class="p">)</span>
    <span class="c1"># MODE_COMMON_HANYU_EN the Chinese font for both English and the common</span>
    <span class="c1"># characters</span>
    <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="n">MODE_COMMON_HANYU_EN</span><span class="p">:</span>
        <span class="n">font</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">FontDescription</span><span class="p">(</span><span class="n">hanzi</span><span class="p">)</span>
        <span class="n">font</span><span class="o">.</span><span class="n">add_typeface_for_language</span><span class="p">(</span><span class="n">hanzi</span><span class="p">,</span> <span class="s2">&quot;zh&quot;</span><span class="p">)</span>
    <span class="c1"># MODE_ALL_HANYU uses the default English font but includes all the Chinese</span>
    <span class="c1"># characters (which uses a substantial amount of memory)</span>
    <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="n">MODE_ALL_HANYU</span><span class="p">:</span>
        <span class="n">font</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">FontDescription</span><span class="p">()</span>
        <span class="n">font</span><span class="o">.</span><span class="n">add_typeface_for_language</span><span class="p">(</span><span class="n">hanzi</span><span class="p">,</span> <span class="s2">&quot;zh_all&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="n">MODE_CUSTOM_CHARS</span><span class="p">:</span>
        <span class="nb">range</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x2654</span><span class="p">,</span> <span class="mh">0x2655</span><span class="p">,</span> <span class="mh">0x2656</span><span class="p">,</span> <span class="mh">0x2657</span><span class="p">,</span> <span class="mh">0x2658</span><span class="p">,</span> <span class="mh">0x2659</span><span class="p">]</span>
        <span class="n">font</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">FontDescription</span><span class="p">()</span>
        <span class="n">font</span><span class="o">.</span><span class="n">add_typeface_for_code_points</span><span class="p">(</span><span class="n">chess</span><span class="p">,</span> <span class="nb">range</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">font</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">gui</span><span class="o">.</span><span class="n">Application</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">set_font</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">Application</span><span class="o">.</span><span class="n">DEFAULT_FONT_ID</span><span class="p">,</span> <span class="n">font</span><span class="p">)</span>

    <span class="n">w</span> <span class="o">=</span> <span class="n">ExampleWindow</span><span class="p">()</span>
    <span class="n">gui</span><span class="o">.</span><span class="n">Application</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">ExampleWindow</span><span class="p">:</span>
    <span class="n">MENU_CHECKABLE</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">MENU_DISABLED</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">MENU_QUIT</span> <span class="o">=</span> <span class="mi">3</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Application</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">create_window</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">768</span><span class="p">)</span>
        <span class="c1"># self.window = gui.Application.instance.create_window(&quot;Test&quot;, 400, 768,</span>
        <span class="c1">#                                                        x=50, y=100)</span>
        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">window</span>  <span class="c1"># for more concise code</span>

        <span class="c1"># Rather than specifying sizes in pixels, which may vary in size based</span>
        <span class="c1"># on the monitor, especially on macOS which has 220 dpi monitors, use</span>
        <span class="c1"># the em-size. This way sizings will be proportional to the font size,</span>
        <span class="c1"># which will create a more visually consistent size across platforms.</span>
        <span class="n">em</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">theme</span><span class="o">.</span><span class="n">font_size</span>

        <span class="c1"># Widgets are laid out in layouts: gui.Horiz, gui.Vert,</span>
        <span class="c1"># gui.CollapsableVert, and gui.VGrid. By nesting the layouts we can</span>
        <span class="c1"># achieve complex designs. Usually we use a vertical layout as the</span>
        <span class="c1"># topmost widget, since widgets tend to be organized from top to bottom.</span>
        <span class="c1"># Within that, we usually have a series of horizontal layouts for each</span>
        <span class="c1"># row.</span>
        <span class="n">layout</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Vert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">gui</span><span class="o">.</span><span class="n">Margins</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">em</span><span class="p">,</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">em</span><span class="p">,</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">em</span><span class="p">,</span>
                                         <span class="mf">0.5</span> <span class="o">*</span> <span class="n">em</span><span class="p">))</span>

        <span class="c1"># Create the menu. The menu is global (because the macOS menu is global),</span>
        <span class="c1"># so only create it once.</span>
        <span class="k">if</span> <span class="n">gui</span><span class="o">.</span><span class="n">Application</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">menubar</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">menubar</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Menu</span><span class="p">()</span>
            <span class="n">test_menu</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Menu</span><span class="p">()</span>
            <span class="n">test_menu</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="s2">&quot;An option&quot;</span><span class="p">,</span> <span class="n">ExampleWindow</span><span class="o">.</span><span class="n">MENU_CHECKABLE</span><span class="p">)</span>
            <span class="n">test_menu</span><span class="o">.</span><span class="n">set_checked</span><span class="p">(</span><span class="n">ExampleWindow</span><span class="o">.</span><span class="n">MENU_CHECKABLE</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">test_menu</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="s2">&quot;Unavailable feature&quot;</span><span class="p">,</span>
                               <span class="n">ExampleWindow</span><span class="o">.</span><span class="n">MENU_DISABLED</span><span class="p">)</span>
            <span class="n">test_menu</span><span class="o">.</span><span class="n">set_enabled</span><span class="p">(</span><span class="n">ExampleWindow</span><span class="o">.</span><span class="n">MENU_DISABLED</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="n">test_menu</span><span class="o">.</span><span class="n">add_separator</span><span class="p">()</span>
            <span class="n">test_menu</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="s2">&quot;Quit&quot;</span><span class="p">,</span> <span class="n">ExampleWindow</span><span class="o">.</span><span class="n">MENU_QUIT</span><span class="p">)</span>
            <span class="c1"># On macOS the first menu item is the application menu item and will</span>
            <span class="c1"># always be the name of the application (probably &quot;Python&quot;),</span>
            <span class="c1"># regardless of what you pass in here. The application menu is</span>
            <span class="c1"># typically where About..., Preferences..., and Quit go.</span>
            <span class="n">menubar</span><span class="o">.</span><span class="n">add_menu</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span><span class="p">,</span> <span class="n">test_menu</span><span class="p">)</span>
            <span class="n">gui</span><span class="o">.</span><span class="n">Application</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">menubar</span> <span class="o">=</span> <span class="n">menubar</span>

        <span class="c1"># Each window needs to know what to do with the menu items, so we need</span>
        <span class="c1"># to tell the window how to handle menu items.</span>
        <span class="n">w</span><span class="o">.</span><span class="n">set_on_menu_item_activated</span><span class="p">(</span><span class="n">ExampleWindow</span><span class="o">.</span><span class="n">MENU_CHECKABLE</span><span class="p">,</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">_on_menu_checkable</span><span class="p">)</span>
        <span class="n">w</span><span class="o">.</span><span class="n">set_on_menu_item_activated</span><span class="p">(</span><span class="n">ExampleWindow</span><span class="o">.</span><span class="n">MENU_QUIT</span><span class="p">,</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">_on_menu_quit</span><span class="p">)</span>

        <span class="c1"># Create a file-chooser widget. One part will be a text edit widget for</span>
        <span class="c1"># the filename and clicking on the button will let the user choose using</span>
        <span class="c1"># the file dialog.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fileedit</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">TextEdit</span><span class="p">()</span>
        <span class="n">filedlgbutton</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="s2">&quot;...&quot;</span><span class="p">)</span>
        <span class="n">filedlgbutton</span><span class="o">.</span><span class="n">horizontal_padding_em</span> <span class="o">=</span> <span class="mf">0.5</span>
        <span class="n">filedlgbutton</span><span class="o">.</span><span class="n">vertical_padding_em</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">filedlgbutton</span><span class="o">.</span><span class="n">set_on_clicked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_filedlg_button</span><span class="p">)</span>

        <span class="c1"># (Create the horizontal widget for the row. This will make sure the</span>
        <span class="c1"># text editor takes up as much space as it can.)</span>
        <span class="n">fileedit_layout</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Horiz</span><span class="p">()</span>
        <span class="n">fileedit_layout</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="s2">&quot;Model file&quot;</span><span class="p">))</span>
        <span class="n">fileedit_layout</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fileedit</span><span class="p">)</span>
        <span class="n">fileedit_layout</span><span class="o">.</span><span class="n">add_fixed</span><span class="p">(</span><span class="mf">0.25</span> <span class="o">*</span> <span class="n">em</span><span class="p">)</span>
        <span class="n">fileedit_layout</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">filedlgbutton</span><span class="p">)</span>
        <span class="c1"># add to the top-level (vertical) layout</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">fileedit_layout</span><span class="p">)</span>

        <span class="c1"># Create a collapsible vertical widget, which takes up enough vertical</span>
        <span class="c1"># space for all its children when open, but only enough for text when</span>
        <span class="c1"># closed. This is useful for property pages, so the user can hide sets</span>
        <span class="c1"># of properties they rarely use. All layouts take a spacing parameter,</span>
        <span class="c1"># which is the spacinging between items in the widget, and a margins</span>
        <span class="c1"># parameter, which specifies the spacing of the left, top, right,</span>
        <span class="c1"># bottom margins. (This acts like the &#39;padding&#39; property in CSS.)</span>
        <span class="n">collapse</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">CollapsableVert</span><span class="p">(</span><span class="s2">&quot;Widgets&quot;</span><span class="p">,</span> <span class="mf">0.33</span> <span class="o">*</span> <span class="n">em</span><span class="p">,</span>
                                       <span class="n">gui</span><span class="o">.</span><span class="n">Margins</span><span class="p">(</span><span class="n">em</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="n">MODE_CUSTOM_CHARS</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_label</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="s2">&quot;♔♕♖♗♘♙&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="n">MODE_ALL_HANYU</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_label</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="s2">&quot;天地玄黃，宇宙洪荒。日月盈昃，辰宿列張。&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_label</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="s2">&quot;锄禾日当午，汗滴禾下土。谁知盘中餐，粒粒皆辛苦。&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_label</span><span class="o">.</span><span class="n">text_color</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="n">collapse</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_label</span><span class="p">)</span>

        <span class="c1"># Create a checkbox. Checking or unchecking would usually be used to set</span>
        <span class="c1"># a binary property, but in this case it will show a simple message box,</span>
        <span class="c1"># which illustrates how to create simple dialogs.</span>
        <span class="n">cb</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Checkbox</span><span class="p">(</span><span class="s2">&quot;Enable some really cool effect&quot;</span><span class="p">)</span>
        <span class="n">cb</span><span class="o">.</span><span class="n">set_on_checked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_cb</span><span class="p">)</span>  <span class="c1"># set the callback function</span>
        <span class="n">collapse</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">cb</span><span class="p">)</span>

        <span class="c1"># Create a color editor. We will change the color of the orange label</span>
        <span class="c1"># above when the color changes.</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">ColorEdit</span><span class="p">()</span>
        <span class="n">color</span><span class="o">.</span><span class="n">color_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_label</span><span class="o">.</span><span class="n">text_color</span>
        <span class="n">color</span><span class="o">.</span><span class="n">set_on_value_changed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_color</span><span class="p">)</span>
        <span class="n">collapse</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>

        <span class="c1"># This is a combobox, nothing fancy here, just set a simple function to</span>
        <span class="c1"># handle the user selecting an item.</span>
        <span class="n">combo</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Combobox</span><span class="p">()</span>
        <span class="n">combo</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="s2">&quot;Show point labels&quot;</span><span class="p">)</span>
        <span class="n">combo</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="s2">&quot;Show point velocity&quot;</span><span class="p">)</span>
        <span class="n">combo</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="s2">&quot;Show bounding boxes&quot;</span><span class="p">)</span>
        <span class="n">combo</span><span class="o">.</span><span class="n">set_on_selection_changed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_combo</span><span class="p">)</span>
        <span class="n">collapse</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">combo</span><span class="p">)</span>

        <span class="c1"># Add a simple image</span>
        <span class="n">logo</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">ImageWidget</span><span class="p">(</span><span class="n">basedir</span> <span class="o">+</span> <span class="s2">&quot;/icon-32.png&quot;</span><span class="p">)</span>
        <span class="n">collapse</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">logo</span><span class="p">)</span>

        <span class="c1"># Add a list of items</span>
        <span class="n">lv</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">ListView</span><span class="p">()</span>
        <span class="n">lv</span><span class="o">.</span><span class="n">set_items</span><span class="p">([</span><span class="s2">&quot;Ground&quot;</span><span class="p">,</span> <span class="s2">&quot;Trees&quot;</span><span class="p">,</span> <span class="s2">&quot;Buildings&quot;</span> <span class="s2">&quot;Cars&quot;</span><span class="p">,</span> <span class="s2">&quot;People&quot;</span><span class="p">])</span>
        <span class="n">lv</span><span class="o">.</span><span class="n">selected_index</span> <span class="o">=</span> <span class="n">lv</span><span class="o">.</span><span class="n">selected_index</span> <span class="o">+</span> <span class="mi">2</span>  <span class="c1"># initially is -1, so now 1</span>
        <span class="n">lv</span><span class="o">.</span><span class="n">set_on_selection_changed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_list</span><span class="p">)</span>
        <span class="n">collapse</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">lv</span><span class="p">)</span>

        <span class="c1"># Add a tree view</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">TreeView</span><span class="p">()</span>
        <span class="n">tree</span><span class="o">.</span><span class="n">add_text_item</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">get_root_item</span><span class="p">(),</span> <span class="s2">&quot;Camera&quot;</span><span class="p">)</span>
        <span class="n">geo_id</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">add_text_item</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">get_root_item</span><span class="p">(),</span> <span class="s2">&quot;Geometries&quot;</span><span class="p">)</span>
        <span class="n">mesh_id</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">add_text_item</span><span class="p">(</span><span class="n">geo_id</span><span class="p">,</span> <span class="s2">&quot;Mesh&quot;</span><span class="p">)</span>
        <span class="n">tree</span><span class="o">.</span><span class="n">add_text_item</span><span class="p">(</span><span class="n">mesh_id</span><span class="p">,</span> <span class="s2">&quot;Triangles&quot;</span><span class="p">)</span>
        <span class="n">tree</span><span class="o">.</span><span class="n">add_text_item</span><span class="p">(</span><span class="n">mesh_id</span><span class="p">,</span> <span class="s2">&quot;Albedo texture&quot;</span><span class="p">)</span>
        <span class="n">tree</span><span class="o">.</span><span class="n">add_text_item</span><span class="p">(</span><span class="n">mesh_id</span><span class="p">,</span> <span class="s2">&quot;Normal map&quot;</span><span class="p">)</span>
        <span class="n">points_id</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">add_text_item</span><span class="p">(</span><span class="n">geo_id</span><span class="p">,</span> <span class="s2">&quot;Points&quot;</span><span class="p">)</span>
        <span class="n">tree</span><span class="o">.</span><span class="n">can_select_items_with_children</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">tree</span><span class="o">.</span><span class="n">set_on_selection_changed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_tree</span><span class="p">)</span>
        <span class="c1"># does not call on_selection_changed: user did not change selection</span>
        <span class="n">tree</span><span class="o">.</span><span class="n">selected_item</span> <span class="o">=</span> <span class="n">points_id</span>
        <span class="n">collapse</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>

        <span class="c1"># Add two number editors, one for integers and one for floating point</span>
        <span class="c1"># Number editor can clamp numbers to a range, although this is more</span>
        <span class="c1"># useful for integers than for floating point.</span>
        <span class="n">intedit</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">NumberEdit</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">NumberEdit</span><span class="o">.</span><span class="n">INT</span><span class="p">)</span>
        <span class="n">intedit</span><span class="o">.</span><span class="n">int_value</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">intedit</span><span class="o">.</span><span class="n">set_limits</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">19</span><span class="p">)</span>  <span class="c1"># value coerced to 1</span>
        <span class="n">intedit</span><span class="o">.</span><span class="n">int_value</span> <span class="o">=</span> <span class="n">intedit</span><span class="o">.</span><span class="n">int_value</span> <span class="o">+</span> <span class="mi">2</span>  <span class="c1"># value should be 3</span>
        <span class="n">doubleedit</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">NumberEdit</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">NumberEdit</span><span class="o">.</span><span class="n">DOUBLE</span><span class="p">)</span>
        <span class="n">numlayout</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Horiz</span><span class="p">()</span>
        <span class="n">numlayout</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">))</span>
        <span class="n">numlayout</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">intedit</span><span class="p">)</span>
        <span class="n">numlayout</span><span class="o">.</span><span class="n">add_fixed</span><span class="p">(</span><span class="n">em</span><span class="p">)</span>  <span class="c1"># manual spacing (could set it in Horiz() ctor)</span>
        <span class="n">numlayout</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="s2">&quot;double&quot;</span><span class="p">))</span>
        <span class="n">numlayout</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">doubleedit</span><span class="p">)</span>
        <span class="n">collapse</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">numlayout</span><span class="p">)</span>

        <span class="c1"># Create a progress bar. It ranges from 0.0 to 1.0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_progress</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">ProgressBar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_progress</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mf">0.25</span>  <span class="c1"># 25% complete</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_progress</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_progress</span><span class="o">.</span><span class="n">value</span> <span class="o">+</span> <span class="mf">0.08</span>  <span class="c1"># 0.25 + 0.08 = 33%</span>
        <span class="n">prog_layout</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Horiz</span><span class="p">(</span><span class="n">em</span><span class="p">)</span>
        <span class="n">prog_layout</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="s2">&quot;Progress...&quot;</span><span class="p">))</span>
        <span class="n">prog_layout</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_progress</span><span class="p">)</span>
        <span class="n">collapse</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">prog_layout</span><span class="p">)</span>

        <span class="c1"># Create a slider. It acts very similar to NumberEdit except that the</span>
        <span class="c1"># user moves a slider and cannot type the number.</span>
        <span class="n">slider</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Slider</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">Slider</span><span class="o">.</span><span class="n">INT</span><span class="p">)</span>
        <span class="n">slider</span><span class="o">.</span><span class="n">set_limits</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">13</span><span class="p">)</span>
        <span class="n">slider</span><span class="o">.</span><span class="n">set_on_value_changed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_slider</span><span class="p">)</span>
        <span class="n">collapse</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">slider</span><span class="p">)</span>

        <span class="c1"># Create a text editor. The placeholder text (if not empty) will be</span>
        <span class="c1"># displayed when there is no text, as concise help, or visible tooltip.</span>
        <span class="n">tedit</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">TextEdit</span><span class="p">()</span>
        <span class="n">tedit</span><span class="o">.</span><span class="n">placeholder_text</span> <span class="o">=</span> <span class="s2">&quot;Edit me some text here&quot;</span>

        <span class="c1"># on_text_changed fires whenever the user changes the text (but not if</span>
        <span class="c1"># the text_value property is assigned to).</span>
        <span class="n">tedit</span><span class="o">.</span><span class="n">set_on_text_changed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_text_changed</span><span class="p">)</span>

        <span class="c1"># on_value_changed fires whenever the user signals that they are finished</span>
        <span class="c1"># editing the text, either by pressing return or by clicking outside of</span>
        <span class="c1"># the text editor, thus losing text focus.</span>
        <span class="n">tedit</span><span class="o">.</span><span class="n">set_on_value_changed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_value_changed</span><span class="p">)</span>
        <span class="n">collapse</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">tedit</span><span class="p">)</span>

        <span class="c1"># Create a widget for showing/editing a 3D vector</span>
        <span class="n">vedit</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">VectorEdit</span><span class="p">()</span>
        <span class="n">vedit</span><span class="o">.</span><span class="n">vector_value</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
        <span class="n">vedit</span><span class="o">.</span><span class="n">set_on_value_changed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_vedit</span><span class="p">)</span>
        <span class="n">collapse</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">vedit</span><span class="p">)</span>

        <span class="c1"># Create a VGrid layout. This layout specifies the number of columns</span>
        <span class="c1"># (two, in this case), and will place the first child in the first</span>
        <span class="c1"># column, the second in the second, the third in the first, the fourth</span>
        <span class="c1"># in the second, etc.</span>
        <span class="c1"># So:</span>
        <span class="c1">#      2 cols             3 cols                  4 cols</span>
        <span class="c1">#   |  1  |  2  |   |  1  |  2  |  3  |   |  1  |  2  |  3  |  4  |</span>
        <span class="c1">#   |  3  |  4  |   |  4  |  5  |  6  |   |  5  |  6  |  7  |  8  |</span>
        <span class="c1">#   |  5  |  6  |   |  7  |  8  |  9  |   |  9  | 10  | 11  | 12  |</span>
        <span class="c1">#   |    ...    |   |       ...       |   |         ...           |</span>
        <span class="n">vgrid</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">VGrid</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">vgrid</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="s2">&quot;Trees&quot;</span><span class="p">))</span>
        <span class="n">vgrid</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="s2">&quot;12 items&quot;</span><span class="p">))</span>
        <span class="n">vgrid</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="s2">&quot;People&quot;</span><span class="p">))</span>
        <span class="n">vgrid</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="s2">&quot;2 (93</span><span class="si">% c</span><span class="s2">ertainty)&quot;</span><span class="p">))</span>
        <span class="n">vgrid</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="s2">&quot;Cars&quot;</span><span class="p">))</span>
        <span class="n">vgrid</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="s2">&quot;5 (87</span><span class="si">% c</span><span class="s2">ertainty)&quot;</span><span class="p">))</span>
        <span class="n">collapse</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">vgrid</span><span class="p">)</span>

        <span class="c1"># Create a tab control. This is really a set of N layouts on top of each</span>
        <span class="c1"># other, but with only one selected.</span>
        <span class="n">tabs</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">TabControl</span><span class="p">()</span>
        <span class="n">tab1</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Vert</span><span class="p">()</span>
        <span class="n">tab1</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">Checkbox</span><span class="p">(</span><span class="s2">&quot;Enable option 1&quot;</span><span class="p">))</span>
        <span class="n">tab1</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">Checkbox</span><span class="p">(</span><span class="s2">&quot;Enable option 2&quot;</span><span class="p">))</span>
        <span class="n">tab1</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">Checkbox</span><span class="p">(</span><span class="s2">&quot;Enable option 3&quot;</span><span class="p">))</span>
        <span class="n">tabs</span><span class="o">.</span><span class="n">add_tab</span><span class="p">(</span><span class="s2">&quot;Options&quot;</span><span class="p">,</span> <span class="n">tab1</span><span class="p">)</span>
        <span class="n">tab2</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Vert</span><span class="p">()</span>
        <span class="n">tab2</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="s2">&quot;No plugins detected&quot;</span><span class="p">))</span>
        <span class="n">tab2</span><span class="o">.</span><span class="n">add_stretch</span><span class="p">()</span>
        <span class="n">tabs</span><span class="o">.</span><span class="n">add_tab</span><span class="p">(</span><span class="s2">&quot;Plugins&quot;</span><span class="p">,</span> <span class="n">tab2</span><span class="p">)</span>
        <span class="n">collapse</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">tabs</span><span class="p">)</span>

        <span class="c1"># Quit button. (Typically this is a menu item)</span>
        <span class="n">button_layout</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Horiz</span><span class="p">()</span>
        <span class="n">ok_button</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="s2">&quot;Ok&quot;</span><span class="p">)</span>
        <span class="n">ok_button</span><span class="o">.</span><span class="n">set_on_clicked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_ok</span><span class="p">)</span>
        <span class="n">button_layout</span><span class="o">.</span><span class="n">add_stretch</span><span class="p">()</span>
        <span class="n">button_layout</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">ok_button</span><span class="p">)</span>

        <span class="n">layout</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">collapse</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">button_layout</span><span class="p">)</span>

        <span class="c1"># We&#39;re done, set the window&#39;s layout</span>
        <span class="n">w</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">layout</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_on_filedlg_button</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">filedlg</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">FileDialog</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">FileDialog</span><span class="o">.</span><span class="n">OPEN</span><span class="p">,</span> <span class="s2">&quot;Select file&quot;</span><span class="p">,</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">theme</span><span class="p">)</span>
        <span class="n">filedlg</span><span class="o">.</span><span class="n">add_filter</span><span class="p">(</span><span class="s2">&quot;.obj .ply .stl&quot;</span><span class="p">,</span> <span class="s2">&quot;Triangle mesh (.obj, .ply, .stl)&quot;</span><span class="p">)</span>
        <span class="n">filedlg</span><span class="o">.</span><span class="n">add_filter</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;All files&quot;</span><span class="p">)</span>
        <span class="n">filedlg</span><span class="o">.</span><span class="n">set_on_cancel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_filedlg_cancel</span><span class="p">)</span>
        <span class="n">filedlg</span><span class="o">.</span><span class="n">set_on_done</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_filedlg_done</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">show_dialog</span><span class="p">(</span><span class="n">filedlg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_on_filedlg_cancel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">close_dialog</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_on_filedlg_done</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fileedit</span><span class="o">.</span><span class="n">text_value</span> <span class="o">=</span> <span class="n">path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">close_dialog</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_on_cb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_checked</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">is_checked</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Sorry, effects are unimplemented&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Good choice&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show_message_dialog</span><span class="p">(</span><span class="s2">&quot;There might be a problem...&quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

    <span class="c1"># This function is essentially the same as window.show_message_box(),</span>
    <span class="c1"># so for something this simple just use that, but it illustrates making a</span>
    <span class="c1"># dialog.</span>
    <span class="k">def</span> <span class="nf">show_message_dialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="c1"># A Dialog is just a widget, so you make its child a layout just like</span>
        <span class="c1"># a Window.</span>
        <span class="n">dlg</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Dialog</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

        <span class="c1"># Add the message text</span>
        <span class="n">em</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">theme</span><span class="o">.</span><span class="n">font_size</span>
        <span class="n">dlg_layout</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Vert</span><span class="p">(</span><span class="n">em</span><span class="p">,</span> <span class="n">gui</span><span class="o">.</span><span class="n">Margins</span><span class="p">(</span><span class="n">em</span><span class="p">,</span> <span class="n">em</span><span class="p">,</span> <span class="n">em</span><span class="p">,</span> <span class="n">em</span><span class="p">))</span>
        <span class="n">dlg_layout</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="n">message</span><span class="p">))</span>

        <span class="c1"># Add the Ok button. We need to define a callback function to handle</span>
        <span class="c1"># the click.</span>
        <span class="n">ok_button</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="s2">&quot;Ok&quot;</span><span class="p">)</span>
        <span class="n">ok_button</span><span class="o">.</span><span class="n">set_on_clicked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_dialog_ok</span><span class="p">)</span>

        <span class="c1"># We want the Ok button to be an the right side, so we need to add</span>
        <span class="c1"># a stretch item to the layout, otherwise the button will be the size</span>
        <span class="c1"># of the entire row. A stretch item takes up as much space as it can,</span>
        <span class="c1"># which forces the button to be its minimum size.</span>
        <span class="n">button_layout</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Horiz</span><span class="p">()</span>
        <span class="n">button_layout</span><span class="o">.</span><span class="n">add_stretch</span><span class="p">()</span>
        <span class="n">button_layout</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">ok_button</span><span class="p">)</span>

        <span class="c1"># Add the button layout,</span>
        <span class="n">dlg_layout</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">button_layout</span><span class="p">)</span>
        <span class="c1"># ... then add the layout as the child of the Dialog</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">dlg_layout</span><span class="p">)</span>
        <span class="c1"># ... and now we can show the dialog</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">show_dialog</span><span class="p">(</span><span class="n">dlg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_on_dialog_ok</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">close_dialog</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_on_color</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_color</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_label</span><span class="o">.</span><span class="n">text_color</span> <span class="o">=</span> <span class="n">new_color</span>

    <span class="k">def</span> <span class="nf">_on_combo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_val</span><span class="p">,</span> <span class="n">new_idx</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">new_idx</span><span class="p">,</span> <span class="n">new_val</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_on_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_val</span><span class="p">,</span> <span class="n">is_dbl_click</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">new_val</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_on_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_item_id</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">new_item_id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_on_slider</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_progress</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">new_val</span> <span class="o">/</span> <span class="mf">20.0</span>

    <span class="k">def</span> <span class="nf">_on_text_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_text</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;edit:&quot;</span><span class="p">,</span> <span class="n">new_text</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_on_value_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_text</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;value:&quot;</span><span class="p">,</span> <span class="n">new_text</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_on_vedit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_val</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">new_val</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_on_ok</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">gui</span><span class="o">.</span><span class="n">Application</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_on_menu_checkable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">gui</span><span class="o">.</span><span class="n">Application</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">menubar</span><span class="o">.</span><span class="n">set_checked</span><span class="p">(</span>
            <span class="n">ExampleWindow</span><span class="o">.</span><span class="n">MENU_CHECKABLE</span><span class="p">,</span>
            <span class="ow">not</span> <span class="n">gui</span><span class="o">.</span><span class="n">Application</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">menubar</span><span class="o">.</span><span class="n">is_checked</span><span class="p">(</span>
                <span class="n">ExampleWindow</span><span class="o">.</span><span class="n">MENU_CHECKABLE</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_on_menu_quit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">gui</span><span class="o">.</span><span class="n">Application</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>


<span class="c1"># This class is essentially the same as window.show_message_box(),</span>
<span class="c1"># so for something this simple just use that, but it illustrates making a</span>
<span class="c1"># dialog.</span>
<span class="k">class</span> <span class="nc">MessageBox</span><span class="p">:</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_window</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># A Dialog is just a widget, so you make its child a layout just like</span>
        <span class="c1"># a Window.</span>
        <span class="n">dlg</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Dialog</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

        <span class="c1"># Add the message text</span>
        <span class="n">em</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">theme</span><span class="o">.</span><span class="n">font_size</span>
        <span class="n">dlg_layout</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Vert</span><span class="p">(</span><span class="n">em</span><span class="p">,</span> <span class="n">gui</span><span class="o">.</span><span class="n">Margins</span><span class="p">(</span><span class="n">em</span><span class="p">,</span> <span class="n">em</span><span class="p">,</span> <span class="n">em</span><span class="p">,</span> <span class="n">em</span><span class="p">))</span>
        <span class="n">dlg_layout</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="n">message</span><span class="p">))</span>

        <span class="c1"># Add the Ok button. We need to define a callback function to handle</span>
        <span class="c1"># the click.</span>
        <span class="n">ok_button</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="s2">&quot;Ok&quot;</span><span class="p">)</span>
        <span class="n">ok_button</span><span class="o">.</span><span class="n">set_on_clicked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_ok</span><span class="p">)</span>

        <span class="c1"># We want the Ok button to be an the right side, so we need to add</span>
        <span class="c1"># a stretch item to the layout, otherwise the button will be the size</span>
        <span class="c1"># of the entire row. A stretch item takes up as much space as it can,</span>
        <span class="c1"># which forces the button to be its minimum size.</span>
        <span class="n">button_layout</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Horiz</span><span class="p">()</span>
        <span class="n">button_layout</span><span class="o">.</span><span class="n">add_stretch</span><span class="p">()</span>
        <span class="n">button_layout</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">ok_button</span><span class="p">)</span>

        <span class="c1"># Add the button layout,</span>
        <span class="n">dlg_layout</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">button_layout</span><span class="p">)</span>
        <span class="c1"># ... then add the layout as the child of the Dialog</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">dlg_layout</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_window</span> <span class="o">=</span> <span class="n">window</span>

    <span class="k">def</span> <span class="nf">_on_ok</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_window</span><span class="o">.</span><span class="n">close_dialog</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div></td></tr></table></div>
</div>
</div>
<div class="section" id="online-processing-py">
<h2>online_processing.py<a class="headerlink" href="#online-processing-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span></pre></div></td><td class="code"><div><pre><span></span><span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># -                        Open3D: www.open3d.org                            -</span>
<span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># Copyright (c) 2018-2023 www.open3d.org</span>
<span class="c1"># SPDX-License-Identifier: MIT</span>
<span class="c1"># ----------------------------------------------------------------------------</span>
<span class="sd">&quot;&quot;&quot;Online 3D depth video processing pipeline.</span>

<span class="sd">- Connects to a RGBD camera or RGBD video file (currently</span>
<span class="sd">  RealSense camera and bag file format are supported).</span>
<span class="sd">- Captures / reads color and depth frames. Allow recording from camera.</span>
<span class="sd">- Convert frames to point cloud, optionally with normals.</span>
<span class="sd">- Visualize point cloud video and results.</span>
<span class="sd">- Save point clouds and RGBD images for selected frames.</span>

<span class="sd">For this example, Open3D must be built with -DBUILD_LIBREALSENSE=ON</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">logging</span> <span class="k">as</span> <span class="nn">log</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">concurrent.futures</span> <span class="kn">import</span> <span class="n">ThreadPoolExecutor</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">open3d</span> <span class="k">as</span> <span class="nn">o3d</span>
<span class="kn">import</span> <span class="nn">open3d.visualization.gui</span> <span class="k">as</span> <span class="nn">gui</span>
<span class="kn">import</span> <span class="nn">open3d.visualization.rendering</span> <span class="k">as</span> <span class="nn">rendering</span>


<span class="c1"># Camera and processing</span>
<span class="k">class</span> <span class="nc">PipelineModel</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Controls IO (camera, video file, recording, saving frames). Methods run</span>
<span class="sd">    in worker threads.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">update_view</span><span class="p">,</span>
                 <span class="n">camera_config_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">rgbd_video</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">device</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize.</span>

<span class="sd">        Args:</span>
<span class="sd">            update_view (callback): Callback to update display elements for a</span>
<span class="sd">                frame.</span>
<span class="sd">            camera_config_file (str): Camera configuration json file.</span>
<span class="sd">            rgbd_video (str): RS bag file containing the RGBD video. If this is</span>
<span class="sd">                provided, connected cameras are ignored.</span>
<span class="sd">            device (str): Compute device (e.g.: &#39;cpu:0&#39; or &#39;cuda:0&#39;).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_view</span> <span class="o">=</span> <span class="n">update_view</span>
        <span class="k">if</span> <span class="n">device</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">device</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="s1">&#39;cuda:0&#39;</span> <span class="k">if</span> <span class="n">o3d</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="s1">&#39;cpu:0&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">o3d_device</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Device</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">video</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">camera</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flag_capture</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cv_capture</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Condition</span><span class="p">()</span>  <span class="c1"># condition variable</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recording</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Are we currently recording</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flag_record</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Request to start/stop recording</span>
        <span class="k">if</span> <span class="n">rgbd_video</span><span class="p">:</span>  <span class="c1"># Video file</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">video</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">RGBDVideoReader</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">rgbd_video</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rgbd_metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">video</span><span class="o">.</span><span class="n">metadata</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Video </span><span class="si">{</span><span class="n">rgbd_video</span><span class="si">}</span><span class="s2"> opened.&quot;</span>

        <span class="k">else</span><span class="p">:</span>  <span class="c1"># RGBD camera</span>
            <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">_%H-%M-%S&#39;</span><span class="p">)</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">now</span><span class="si">}</span><span class="s2">.bag&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">camera</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">RealSenseSensor</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">camera_config_file</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">camera_config_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">ccf</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">init_sensor</span><span class="p">(</span><span class="n">o3d</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">RealSenseSensorConfig</span><span class="p">(</span>
                        <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">ccf</span><span class="p">)),</span>
                                            <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">init_sensor</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">start_capture</span><span class="p">(</span><span class="n">start_record</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rgbd_metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Camera </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">rgbd_metadata</span><span class="o">.</span><span class="n">serial_number</span><span class="si">}</span><span class="s2"> opened.&quot;</span>

        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rgbd_metadata</span><span class="p">)</span>

        <span class="c1"># RGBD -&gt; PCD</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extrinsics</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Tensor</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span>
                                              <span class="n">dtype</span><span class="o">=</span><span class="n">o3d</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Dtype</span><span class="o">.</span><span class="n">Float32</span><span class="p">,</span>
                                              <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">o3d_device</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">intrinsic_matrix</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rgbd_metadata</span><span class="o">.</span><span class="n">intrinsics</span><span class="o">.</span><span class="n">intrinsic_matrix</span><span class="p">,</span>
            <span class="n">dtype</span><span class="o">=</span><span class="n">o3d</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Dtype</span><span class="o">.</span><span class="n">Float32</span><span class="p">,</span>
            <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">o3d_device</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depth_max</span> <span class="o">=</span> <span class="mf">3.0</span>  <span class="c1"># m</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pcd_stride</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># downsample point cloud, may increase frame rate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flag_normals</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flag_save_rgbd</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flag_save_pcd</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pcd_frame</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rgbd_frame</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">executor</span> <span class="o">=</span> <span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                                           <span class="n">thread_name_prefix</span><span class="o">=</span><span class="s1">&#39;Capture-Save&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flag_exit</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">max_points</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Max points in one frame for the camera or RGBD video resolution.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rgbd_metadata</span><span class="o">.</span><span class="n">width</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">rgbd_metadata</span><span class="o">.</span><span class="n">height</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">vfov</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Camera or RGBD video vertical field of view.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">intrinsic_matrix</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">()</span> <span class="o">/</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">intrinsic_matrix</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">()))</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run pipeline.&quot;&quot;&quot;</span>
        <span class="n">n_pts</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">frame_id</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">video</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rgbd_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">video</span><span class="o">.</span><span class="n">next_frame</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rgbd_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">capture_frame</span><span class="p">(</span>
                <span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">align_depth_to_color</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">pcd_errors</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">flag_exit</span> <span class="ow">and</span>
               <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">video</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span>  <span class="c1"># Camera</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">video</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">video</span><span class="o">.</span><span class="n">is_eof</span><span class="p">()))):</span>  <span class="c1"># Video</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">video</span><span class="p">:</span>
                <span class="n">future_rgbd_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">video</span><span class="o">.</span><span class="n">next_frame</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">future_rgbd_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">capture_frame</span><span class="p">,</span>
                    <span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">align_depth_to_color</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flag_save_pcd</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">save_pcd</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">flag_save_pcd</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rgbd_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rgbd_frame</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">o3d_device</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pcd_frame</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">PointCloud</span><span class="o">.</span><span class="n">create_from_rgbd_image</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">rgbd_frame</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">intrinsic_matrix</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">extrinsics</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">rgbd_metadata</span><span class="o">.</span><span class="n">depth_scale</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth_max</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">pcd_stride</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flag_normals</span><span class="p">)</span>
                <span class="n">depth_in_color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rgbd_frame</span><span class="o">.</span><span class="n">depth</span><span class="o">.</span><span class="n">colorize_depth</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">rgbd_metadata</span><span class="o">.</span><span class="n">depth_scale</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth_max</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">RuntimeError</span><span class="p">:</span>
                <span class="n">pcd_errors</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pcd_frame</span><span class="o">.</span><span class="n">is_empty</span><span class="p">():</span>
                <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No valid depth data in frame </span><span class="si">{</span><span class="n">frame_id</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="n">n_pts</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pcd_frame</span><span class="o">.</span><span class="n">point</span><span class="o">.</span><span class="n">positions</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">frame_id</span> <span class="o">%</span> <span class="mi">60</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">frame_id</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">t0</span><span class="p">,</span> <span class="n">t1</span> <span class="o">=</span> <span class="n">t1</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">frame_id = </span><span class="si">{</span><span class="n">frame_id</span><span class="si">}</span><span class="s2">, </span><span class="se">\t</span><span class="s2"> </span><span class="si">{</span><span class="p">(</span><span class="n">t1</span><span class="o">-</span><span class="n">t0</span><span class="p">)</span><span class="o">*</span><span class="mf">1000.</span><span class="o">/</span><span class="mi">60</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="s2">&quot;</span>
                          <span class="sa">f</span><span class="s2">&quot;ms/frame </span><span class="se">\t</span><span class="s2"> </span><span class="si">{</span><span class="p">(</span><span class="n">t1</span><span class="o">-</span><span class="n">t0</span><span class="p">)</span><span class="o">*</span><span class="mf">1e9</span><span class="o">/</span><span class="n">n_pts</span><span class="si">}</span><span class="s2"> ms/Mp</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">n_pts</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">frame_elements</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">rgbd_frame</span><span class="o">.</span><span class="n">color</span><span class="o">.</span><span class="n">cpu</span><span class="p">(),</span>
                <span class="s1">&#39;depth&#39;</span><span class="p">:</span> <span class="n">depth_in_color</span><span class="o">.</span><span class="n">cpu</span><span class="p">(),</span>
                <span class="s1">&#39;pcd&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pcd_frame</span><span class="o">.</span><span class="n">cpu</span><span class="p">(),</span>
                <span class="s1">&#39;status_message&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">status_message</span>
            <span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_view</span><span class="p">(</span><span class="n">frame_elements</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flag_save_rgbd</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">save_rgbd</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">flag_save_rgbd</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rgbd_frame</span> <span class="o">=</span> <span class="n">future_rgbd_frame</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_capture</span><span class="p">:</span>  <span class="c1"># Wait for capture to be enabled</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cv_capture</span><span class="o">.</span><span class="n">wait_for</span><span class="p">(</span>
                    <span class="n">predicate</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">flag_capture</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">flag_exit</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">toggle_record</span><span class="p">()</span>
            <span class="n">frame_id</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">stop_capture</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">video</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">executor</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;create_from_depth_image() errors = </span><span class="si">{</span><span class="n">pcd_errors</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">toggle_record</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flag_record</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">recording</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">resume_record</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">recording</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">flag_record</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">recording</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">pause_record</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">recording</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">save_pcd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save current point cloud.&quot;&quot;&quot;</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">_%H-%M-%S&#39;</span><span class="p">)</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">rgbd_metadata</span><span class="o">.</span><span class="n">serial_number</span><span class="si">}</span><span class="s2">_pcd_</span><span class="si">{</span><span class="n">now</span><span class="si">}</span><span class="s2">.ply&quot;</span>
        <span class="c1"># Convert colors to uint8 for compatibility</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pcd_frame</span><span class="o">.</span><span class="n">point</span><span class="o">.</span><span class="n">colors</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pcd_frame</span><span class="o">.</span><span class="n">point</span><span class="o">.</span><span class="n">colors</span> <span class="o">*</span> <span class="mi">255</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span>
            <span class="n">o3d</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Dtype</span><span class="o">.</span><span class="n">UInt8</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">o3d</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">write_point_cloud</span><span class="p">,</span>
                             <span class="n">filename</span><span class="p">,</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">pcd_frame</span><span class="p">,</span>
                             <span class="n">write_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                             <span class="n">compressed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                             <span class="n">print_progress</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Saving point cloud to </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">.&quot;</span>

    <span class="k">def</span> <span class="nf">save_rgbd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save current RGBD image pair.&quot;&quot;&quot;</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">_%H-%M-%S&#39;</span><span class="p">)</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">rgbd_metadata</span><span class="o">.</span><span class="n">serial_number</span><span class="si">}</span><span class="s2">_color_</span><span class="si">{</span><span class="n">now</span><span class="si">}</span><span class="s2">.jpg&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">o3d</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">write_image</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">rgbd_frame</span><span class="o">.</span><span class="n">color</span><span class="p">)</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">rgbd_metadata</span><span class="o">.</span><span class="n">serial_number</span><span class="si">}</span><span class="s2">_depth_</span><span class="si">{</span><span class="n">now</span><span class="si">}</span><span class="s2">.png&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">o3d</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">write_image</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">rgbd_frame</span><span class="o">.</span><span class="n">depth</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status_message</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Saving RGBD images to </span><span class="si">{</span><span class="n">filename</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span><span class="si">}</span><span class="s2">.</span><span class="se">{{</span><span class="s2">jpg,png</span><span class="se">}}</span><span class="s2">.&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">PipelineView</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Controls display and user interface. All methods must run in the main thread.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vfov</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">max_pcd_vertices</span><span class="o">=</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">20</span><span class="p">,</span> <span class="o">**</span><span class="n">callbacks</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize.</span>

<span class="sd">        Args:</span>
<span class="sd">            vfov (float): Vertical field of view for the 3D scene.</span>
<span class="sd">            max_pcd_vertices (int): Maximum point clud verties for which memory</span>
<span class="sd">                is allocated.</span>
<span class="sd">            callbacks (dict of kwargs): Callbacks provided by the controller</span>
<span class="sd">                for various operations.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">vfov</span> <span class="o">=</span> <span class="n">vfov</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_pcd_vertices</span> <span class="o">=</span> <span class="n">max_pcd_vertices</span>

        <span class="n">gui</span><span class="o">.</span><span class="n">Application</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Application</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">create_window</span><span class="p">(</span>
            <span class="s2">&quot;Open3D || Online RGBD Video Processing&quot;</span><span class="p">,</span> <span class="mi">1280</span><span class="p">,</span> <span class="mi">960</span><span class="p">)</span>
        <span class="c1"># Called on window layout (eg: resize)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">set_on_layout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_layout</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">set_on_close</span><span class="p">(</span><span class="n">callbacks</span><span class="p">[</span><span class="s1">&#39;on_window_close&#39;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pcd_material</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">rendering</span><span class="o">.</span><span class="n">MaterialRecord</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pcd_material</span><span class="o">.</span><span class="n">shader</span> <span class="o">=</span> <span class="s2">&quot;defaultLit&quot;</span>
        <span class="c1"># Set n_pixels displayed for each 3D point, accounting for HiDPI scaling</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pcd_material</span><span class="o">.</span><span class="n">point_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">scaling</span><span class="p">)</span>

        <span class="c1"># 3D scene</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pcdview</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">SceneWidget</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pcdview</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pcdview</span><span class="o">.</span><span class="n">enable_scene_caching</span><span class="p">(</span>
            <span class="kc">True</span><span class="p">)</span>  <span class="c1"># makes UI _much_ more responsive</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pcdview</span><span class="o">.</span><span class="n">scene</span> <span class="o">=</span> <span class="n">rendering</span><span class="o">.</span><span class="n">Open3DScene</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">renderer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pcdview</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">set_background</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>  <span class="c1"># White background</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pcdview</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">set_lighting</span><span class="p">(</span>
            <span class="n">rendering</span><span class="o">.</span><span class="n">Open3DScene</span><span class="o">.</span><span class="n">LightingProfile</span><span class="o">.</span><span class="n">SOFT_SHADOWS</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="c1"># Point cloud bounds, depends on the sensor range</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pcd_bounds</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">AxisAlignedBoundingBox</span><span class="p">([</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                                              <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">camera_view</span><span class="p">()</span>  <span class="c1"># Initially look from the camera</span>
        <span class="n">em</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">theme</span><span class="o">.</span><span class="n">font_size</span>

        <span class="c1"># Options panel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">panel</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Vert</span><span class="p">(</span><span class="n">em</span><span class="p">,</span> <span class="n">gui</span><span class="o">.</span><span class="n">Margins</span><span class="p">(</span><span class="n">em</span><span class="p">,</span> <span class="n">em</span><span class="p">,</span> <span class="n">em</span><span class="p">,</span> <span class="n">em</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="o">.</span><span class="n">preferred_width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">360</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">scaling</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="p">)</span>
        <span class="n">toggles</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Horiz</span><span class="p">(</span><span class="n">em</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">toggles</span><span class="p">)</span>

        <span class="n">toggle_capture</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">ToggleSwitch</span><span class="p">(</span><span class="s2">&quot;Capture / Play&quot;</span><span class="p">)</span>
        <span class="n">toggle_capture</span><span class="o">.</span><span class="n">is_on</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">toggle_capture</span><span class="o">.</span><span class="n">set_on_clicked</span><span class="p">(</span>
            <span class="n">callbacks</span><span class="p">[</span><span class="s1">&#39;on_toggle_capture&#39;</span><span class="p">])</span>  <span class="c1"># callback</span>
        <span class="n">toggles</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">toggle_capture</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">flag_normals</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toggle_normals</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">ToggleSwitch</span><span class="p">(</span><span class="s2">&quot;Colors / Normals&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toggle_normals</span><span class="o">.</span><span class="n">is_on</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toggle_normals</span><span class="o">.</span><span class="n">set_on_clicked</span><span class="p">(</span>
            <span class="n">callbacks</span><span class="p">[</span><span class="s1">&#39;on_toggle_normals&#39;</span><span class="p">])</span>  <span class="c1"># callback</span>
        <span class="n">toggles</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toggle_normals</span><span class="p">)</span>

        <span class="n">view_buttons</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Horiz</span><span class="p">(</span><span class="n">em</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">view_buttons</span><span class="p">)</span>
        <span class="n">view_buttons</span><span class="o">.</span><span class="n">add_stretch</span><span class="p">()</span>  <span class="c1"># for centering</span>
        <span class="n">camera_view</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="s2">&quot;Camera view&quot;</span><span class="p">)</span>
        <span class="n">camera_view</span><span class="o">.</span><span class="n">set_on_clicked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">camera_view</span><span class="p">)</span>  <span class="c1"># callback</span>
        <span class="n">view_buttons</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">camera_view</span><span class="p">)</span>
        <span class="n">birds_eye_view</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="s2">&quot;Bird&#39;s eye view&quot;</span><span class="p">)</span>
        <span class="n">birds_eye_view</span><span class="o">.</span><span class="n">set_on_clicked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">birds_eye_view</span><span class="p">)</span>  <span class="c1"># callback</span>
        <span class="n">view_buttons</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">birds_eye_view</span><span class="p">)</span>
        <span class="n">view_buttons</span><span class="o">.</span><span class="n">add_stretch</span><span class="p">()</span>  <span class="c1"># for centering</span>

        <span class="n">save_toggle</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Horiz</span><span class="p">(</span><span class="n">em</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">save_toggle</span><span class="p">)</span>
        <span class="n">save_toggle</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="s2">&quot;Record / Save&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toggle_record</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">callbacks</span><span class="p">[</span><span class="s1">&#39;on_toggle_record&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">save_toggle</span><span class="o">.</span><span class="n">add_fixed</span><span class="p">(</span><span class="mf">1.5</span> <span class="o">*</span> <span class="n">em</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">toggle_record</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">ToggleSwitch</span><span class="p">(</span><span class="s2">&quot;Video&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">toggle_record</span><span class="o">.</span><span class="n">is_on</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">toggle_record</span><span class="o">.</span><span class="n">set_on_clicked</span><span class="p">(</span><span class="n">callbacks</span><span class="p">[</span><span class="s1">&#39;on_toggle_record&#39;</span><span class="p">])</span>
            <span class="n">save_toggle</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toggle_record</span><span class="p">)</span>

        <span class="n">save_buttons</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Horiz</span><span class="p">(</span><span class="n">em</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">save_buttons</span><span class="p">)</span>
        <span class="n">save_buttons</span><span class="o">.</span><span class="n">add_stretch</span><span class="p">()</span>  <span class="c1"># for centering</span>
        <span class="n">save_pcd</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="s2">&quot;Save Point cloud&quot;</span><span class="p">)</span>
        <span class="n">save_pcd</span><span class="o">.</span><span class="n">set_on_clicked</span><span class="p">(</span><span class="n">callbacks</span><span class="p">[</span><span class="s1">&#39;on_save_pcd&#39;</span><span class="p">])</span>
        <span class="n">save_buttons</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">save_pcd</span><span class="p">)</span>
        <span class="n">save_rgbd</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="s2">&quot;Save RGBD frame&quot;</span><span class="p">)</span>
        <span class="n">save_rgbd</span><span class="o">.</span><span class="n">set_on_clicked</span><span class="p">(</span><span class="n">callbacks</span><span class="p">[</span><span class="s1">&#39;on_save_rgbd&#39;</span><span class="p">])</span>
        <span class="n">save_buttons</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">save_rgbd</span><span class="p">)</span>
        <span class="n">save_buttons</span><span class="o">.</span><span class="n">add_stretch</span><span class="p">()</span>  <span class="c1"># for centering</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">video_size</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mi">240</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">scaling</span><span class="p">),</span>
                           <span class="nb">int</span><span class="p">(</span><span class="mi">320</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">scaling</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_color</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">CollapsableVert</span><span class="p">(</span><span class="s2">&quot;Color image&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_color</span><span class="o">.</span><span class="n">set_is_open</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">show_color</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">color_video</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">ImageWidget</span><span class="p">(</span>
            <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">video_size</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_color</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">color_video</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_depth</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">CollapsableVert</span><span class="p">(</span><span class="s2">&quot;Depth image&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_depth</span><span class="o">.</span><span class="n">set_is_open</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">show_depth</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depth_video</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">ImageWidget</span><span class="p">(</span>
            <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">video_size</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_depth</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">depth_video</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">status_message</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status_message</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">flag_exit</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flag_gui_init</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame_elements</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update visualization with point cloud and images. Must run in main</span>
<span class="sd">        thread since this makes GUI calls.</span>

<span class="sd">        Args:</span>
<span class="sd">            frame_elements: dict {element_type: geometry element}.</span>
<span class="sd">                Dictionary of element types to geometry elements to be updated</span>
<span class="sd">                in the GUI:</span>
<span class="sd">                    &#39;pcd&#39;: point cloud,</span>
<span class="sd">                    &#39;color&#39;: rgb image (3 channel, uint8),</span>
<span class="sd">                    &#39;depth&#39;: depth image (uint8),</span>
<span class="sd">                    &#39;status_message&#39;: message</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">flag_gui_init</span><span class="p">:</span>
            <span class="c1"># Set dummy point cloud to allocate graphics memory</span>
            <span class="n">dummy_pcd</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">PointCloud</span><span class="p">({</span>
                <span class="s1">&#39;positions&#39;</span><span class="p">:</span>
                    <span class="n">o3d</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Tensor</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">max_pcd_vertices</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                                          <span class="n">o3d</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Dtype</span><span class="o">.</span><span class="n">Float32</span><span class="p">),</span>
                <span class="s1">&#39;colors&#39;</span><span class="p">:</span>
                    <span class="n">o3d</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Tensor</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">max_pcd_vertices</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                                          <span class="n">o3d</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Dtype</span><span class="o">.</span><span class="n">Float32</span><span class="p">),</span>
                <span class="s1">&#39;normals&#39;</span><span class="p">:</span>
                    <span class="n">o3d</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Tensor</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">max_pcd_vertices</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                                          <span class="n">o3d</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Dtype</span><span class="o">.</span><span class="n">Float32</span><span class="p">)</span>
            <span class="p">})</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pcdview</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">has_geometry</span><span class="p">(</span><span class="s1">&#39;pcd&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pcdview</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">remove_geometry</span><span class="p">(</span><span class="s1">&#39;pcd&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">pcd_material</span><span class="o">.</span><span class="n">shader</span> <span class="o">=</span> <span class="s2">&quot;normals&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flag_normals</span> <span class="k">else</span> <span class="s2">&quot;defaultLit&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pcdview</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">add_geometry</span><span class="p">(</span><span class="s1">&#39;pcd&#39;</span><span class="p">,</span> <span class="n">dummy_pcd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pcd_material</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">flag_gui_init</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># TODO(ssheorey) Switch to update_geometry() after #3452 is fixed</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;nt&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pcdview</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">remove_geometry</span><span class="p">(</span><span class="s1">&#39;pcd&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pcdview</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">add_geometry</span><span class="p">(</span><span class="s1">&#39;pcd&#39;</span><span class="p">,</span> <span class="n">frame_elements</span><span class="p">[</span><span class="s1">&#39;pcd&#39;</span><span class="p">],</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">pcd_material</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">update_flags</span> <span class="o">=</span> <span class="p">(</span><span class="n">rendering</span><span class="o">.</span><span class="n">Scene</span><span class="o">.</span><span class="n">UPDATE_POINTS_FLAG</span> <span class="o">|</span>
                            <span class="n">rendering</span><span class="o">.</span><span class="n">Scene</span><span class="o">.</span><span class="n">UPDATE_COLORS_FLAG</span> <span class="o">|</span>
                            <span class="p">(</span><span class="n">rendering</span><span class="o">.</span><span class="n">Scene</span><span class="o">.</span><span class="n">UPDATE_NORMALS_FLAG</span>
                             <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flag_normals</span> <span class="k">else</span> <span class="mi">0</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pcdview</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">update_geometry</span><span class="p">(</span><span class="s1">&#39;pcd&#39;</span><span class="p">,</span>
                                                     <span class="n">frame_elements</span><span class="p">[</span><span class="s1">&#39;pcd&#39;</span><span class="p">],</span>
                                                     <span class="n">update_flags</span><span class="p">)</span>

        <span class="c1"># Update color and depth images</span>
        <span class="c1"># TODO(ssheorey) Remove CPU transfer after we have CUDA -&gt; OpenGL bridge</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_color</span><span class="o">.</span><span class="n">get_is_open</span><span class="p">()</span> <span class="ow">and</span> <span class="s1">&#39;color&#39;</span> <span class="ow">in</span> <span class="n">frame_elements</span><span class="p">:</span>
            <span class="n">sampling_ratio</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">video_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">frame_elements</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">color_video</span><span class="o">.</span><span class="n">update_image</span><span class="p">(</span>
                <span class="n">frame_elements</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">sampling_ratio</span><span class="p">)</span><span class="o">.</span><span class="n">cpu</span><span class="p">())</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_depth</span><span class="o">.</span><span class="n">get_is_open</span><span class="p">()</span> <span class="ow">and</span> <span class="s1">&#39;depth&#39;</span> <span class="ow">in</span> <span class="n">frame_elements</span><span class="p">:</span>
            <span class="n">sampling_ratio</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">video_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">frame_elements</span><span class="p">[</span><span class="s1">&#39;depth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">depth_video</span><span class="o">.</span><span class="n">update_image</span><span class="p">(</span>
                <span class="n">frame_elements</span><span class="p">[</span><span class="s1">&#39;depth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">sampling_ratio</span><span class="p">)</span><span class="o">.</span><span class="n">cpu</span><span class="p">())</span>

        <span class="k">if</span> <span class="s1">&#39;status_message&#39;</span> <span class="ow">in</span> <span class="n">frame_elements</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status_message</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">frame_elements</span><span class="p">[</span><span class="s2">&quot;status_message&quot;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pcdview</span><span class="o">.</span><span class="n">force_redraw</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">camera_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Callback to reset point cloud view to the camera&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pcdview</span><span class="o">.</span><span class="n">setup_camera</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vfov</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pcd_bounds</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="c1"># Look at [0, 0, 1] from camera placed at [0, 0, 0] with Y axis</span>
        <span class="c1"># pointing at [0, -1, 0]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pcdview</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">look_at</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">birds_eye_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Callback to reset point cloud view to birds eye (overhead) view&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pcdview</span><span class="o">.</span><span class="n">setup_camera</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vfov</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pcd_bounds</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pcdview</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">look_at</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">on_layout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layout_context</span><span class="p">):</span>
        <span class="c1"># The on_layout callback should set the frame (position + size) of every</span>
        <span class="c1"># child correctly. After the callback is done the window will layout</span>
        <span class="c1"># the grandchildren.</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Callback on window initialize / resize&quot;&quot;&quot;</span>
        <span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">content_rect</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pcdview</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">frame</span>
        <span class="n">panel_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="o">.</span><span class="n">calc_preferred_size</span><span class="p">(</span><span class="n">layout_context</span><span class="p">,</span>
                                                    <span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="o">.</span><span class="n">Constraints</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Rect</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">get_right</span><span class="p">()</span> <span class="o">-</span> <span class="n">panel_size</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
                                    <span class="n">frame</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">panel_size</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
                                    <span class="n">panel_size</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">PipelineController</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Entry point for the app. Controls the PipelineModel object for IO and</span>
<span class="sd">    processing  and the PipelineView object for display and UI. All methods</span>
<span class="sd">    operate on the main thread.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">camera_config_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rgbd_video</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize.</span>

<span class="sd">        Args:</span>
<span class="sd">            camera_config_file (str): Camera configuration json file.</span>
<span class="sd">            rgbd_video (str): RS bag file containing the RGBD video. If this is</span>
<span class="sd">                provided, connected cameras are ignored.</span>
<span class="sd">            device (str): Compute device (e.g.: &#39;cpu:0&#39; or &#39;cuda:0&#39;).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_model</span> <span class="o">=</span> <span class="n">PipelineModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_view</span><span class="p">,</span>
                                            <span class="n">camera_config_file</span><span class="p">,</span> <span class="n">rgbd_video</span><span class="p">,</span>
                                            <span class="n">device</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_view</span> <span class="o">=</span> <span class="n">PipelineView</span><span class="p">(</span>
            <span class="mf">1.25</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_model</span><span class="o">.</span><span class="n">vfov</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_model</span><span class="o">.</span><span class="n">max_points</span><span class="p">,</span>
            <span class="n">on_window_close</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">on_window_close</span><span class="p">,</span>
            <span class="n">on_toggle_capture</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">on_toggle_capture</span><span class="p">,</span>
            <span class="n">on_save_pcd</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">on_save_pcd</span><span class="p">,</span>
            <span class="n">on_save_rgbd</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">on_save_rgbd</span><span class="p">,</span>
            <span class="n">on_toggle_record</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">on_toggle_record</span>
            <span class="k">if</span> <span class="n">rgbd_video</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">on_toggle_normals</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">on_toggle_normals</span><span class="p">)</span>

        <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;PipelineModel&#39;</span><span class="p">,</span>
                         <span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pipeline_model</span><span class="o">.</span><span class="n">run</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="n">gui</span><span class="o">.</span><span class="n">Application</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">update_view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame_elements</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Updates view with new data. May be called from any thread.</span>

<span class="sd">        Args:</span>
<span class="sd">            frame_elements (dict): Display elements (point cloud and images)</span>
<span class="sd">                from the new frame to be shown.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">gui</span><span class="o">.</span><span class="n">Application</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">post_to_main_thread</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_view</span><span class="o">.</span><span class="n">window</span><span class="p">,</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_view</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">frame_elements</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">on_toggle_capture</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_enabled</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Callback to toggle capture.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_model</span><span class="o">.</span><span class="n">flag_capture</span> <span class="o">=</span> <span class="n">is_enabled</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_enabled</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">on_toggle_record</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_view</span><span class="o">.</span><span class="n">toggle_record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_view</span><span class="o">.</span><span class="n">toggle_record</span><span class="o">.</span><span class="n">is_on</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_model</span><span class="o">.</span><span class="n">cv_capture</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_model</span><span class="o">.</span><span class="n">cv_capture</span><span class="o">.</span><span class="n">notify</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">on_toggle_record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_enabled</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Callback to toggle recording RGBD video.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_model</span><span class="o">.</span><span class="n">flag_record</span> <span class="o">=</span> <span class="n">is_enabled</span>

    <span class="k">def</span> <span class="nf">on_toggle_normals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_enabled</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Callback to toggle display of normals&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_model</span><span class="o">.</span><span class="n">flag_normals</span> <span class="o">=</span> <span class="n">is_enabled</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_view</span><span class="o">.</span><span class="n">flag_normals</span> <span class="o">=</span> <span class="n">is_enabled</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_view</span><span class="o">.</span><span class="n">flag_gui_init</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">on_window_close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Callback when the user closes the application window.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_model</span><span class="o">.</span><span class="n">flag_exit</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_model</span><span class="o">.</span><span class="n">cv_capture</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_model</span><span class="o">.</span><span class="n">cv_capture</span><span class="o">.</span><span class="n">notify_all</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">True</span>  <span class="c1"># OK to close window</span>

    <span class="k">def</span> <span class="nf">on_save_pcd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Callback to save current point cloud.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_model</span><span class="o">.</span><span class="n">flag_save_pcd</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">on_save_rgbd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Callback to save current RGBD image pair.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_model</span><span class="o">.</span><span class="n">flag_save_rgbd</span> <span class="o">=</span> <span class="kc">True</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>

    <span class="n">log</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">log</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span><span class="vm">__doc__</span><span class="p">,</span>
        <span class="n">formatter_class</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">RawDescriptionHelpFormatter</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--camera-config&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;RGBD camera configuration JSON file&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--rgbd-video&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;RGBD video file (RealSense bag)&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--device&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Device to run computations. e.g. cpu:0 or cuda:0 &#39;</span>
                        <span class="s1">&#39;Default is CUDA GPU if available, else CPU.&#39;</span><span class="p">)</span>

    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">camera_config</span> <span class="ow">and</span> <span class="n">args</span><span class="o">.</span><span class="n">rgbd_video</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span>
            <span class="s2">&quot;Please provide only one of --camera-config and --rgbd-video arguments&quot;</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">PipelineController</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">camera_config</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">rgbd_video</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</pre></div></td></tr></table></div>
</div>
</div>
<div class="section" id="remove-geometry-py">
<h2>remove_geometry.py<a class="headerlink" href="#remove-geometry-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span></pre></div></td><td class="code"><div><pre><span></span><span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># -                        Open3D: www.open3d.org                            -</span>
<span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># Copyright (c) 2018-2023 www.open3d.org</span>
<span class="c1"># SPDX-License-Identifier: MIT</span>
<span class="c1"># ----------------------------------------------------------------------------</span>

<span class="kn">import</span> <span class="nn">open3d</span> <span class="k">as</span> <span class="nn">o3d</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">copy</span>


<span class="k">def</span> <span class="nf">visualize_non_blocking</span><span class="p">(</span><span class="n">vis</span><span class="p">,</span> <span class="n">pcds</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">pcd</span> <span class="ow">in</span> <span class="n">pcds</span><span class="p">:</span>
        <span class="n">vis</span><span class="o">.</span><span class="n">update_geometry</span><span class="p">(</span><span class="n">pcd</span><span class="p">)</span>
    <span class="n">vis</span><span class="o">.</span><span class="n">poll_events</span><span class="p">()</span>
    <span class="n">vis</span><span class="o">.</span><span class="n">update_renderer</span><span class="p">()</span>


<span class="n">pcd_data</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">PCDPointCloud</span><span class="p">()</span>
<span class="n">pcd_orig</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_point_cloud</span><span class="p">(</span><span class="n">pcd_data</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
<span class="n">flip_transform</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>
<span class="n">pcd_orig</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">flip_transform</span><span class="p">)</span>
<span class="n">n_pcd</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">pcds</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_pcd</span><span class="p">):</span>
    <span class="n">pcds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">pcd_orig</span><span class="p">))</span>
    <span class="n">trans</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">trans</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span> <span class="o">*</span> <span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">pcds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">trans</span><span class="p">)</span>

<span class="n">vis</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">Visualizer</span><span class="p">()</span>
<span class="n">vis</span><span class="o">.</span><span class="n">create_window</span><span class="p">()</span>
<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">added</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_pcd</span>

<span class="n">curr_sec</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span>
<span class="n">prev_sec</span> <span class="o">=</span> <span class="n">curr_sec</span> <span class="o">-</span> <span class="mi">1</span>

<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">curr_sec</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">curr_sec</span> <span class="o">-</span> <span class="n">prev_sec</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">prev_sec</span> <span class="o">=</span> <span class="n">curr_sec</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_pcd</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">curr_sec</span> <span class="o">%</span> <span class="p">(</span><span class="n">n_pcd</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="n">i</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">added</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="n">vis</span><span class="o">.</span><span class="n">add_geometry</span><span class="p">(</span><span class="n">pcds</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">added</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Adding </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">curr_sec</span> <span class="o">%</span> <span class="p">(</span><span class="n">n_pcd</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">n_pcd</span><span class="p">)</span> <span class="ow">and</span> <span class="n">added</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="n">vis</span><span class="o">.</span><span class="n">remove_geometry</span><span class="p">(</span><span class="n">pcds</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">added</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Removing </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span>

    <span class="n">visualize_non_blocking</span><span class="p">(</span><span class="n">vis</span><span class="p">,</span> <span class="n">pcds</span><span class="p">)</span>
</pre></div></td></tr></table></div>
</div>
</div>
<div class="section" id="render-to-image-py">
<h2>render_to_image.py<a class="headerlink" href="#render-to-image-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span></pre></div></td><td class="code"><div><pre><span></span><span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># -                        Open3D: www.open3d.org                            -</span>
<span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># Copyright (c) 2018-2023 www.open3d.org</span>
<span class="c1"># SPDX-License-Identifier: MIT</span>
<span class="c1"># ----------------------------------------------------------------------------</span>

<span class="kn">import</span> <span class="nn">open3d</span> <span class="k">as</span> <span class="nn">o3d</span>
<span class="kn">import</span> <span class="nn">open3d.visualization.rendering</span> <span class="k">as</span> <span class="nn">rendering</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">render</span> <span class="o">=</span> <span class="n">rendering</span><span class="o">.</span><span class="n">OffscreenRenderer</span><span class="p">(</span><span class="mi">640</span><span class="p">,</span> <span class="mi">480</span><span class="p">)</span>

    <span class="n">yellow</span> <span class="o">=</span> <span class="n">rendering</span><span class="o">.</span><span class="n">MaterialRecord</span><span class="p">()</span>
    <span class="n">yellow</span><span class="o">.</span><span class="n">base_color</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
    <span class="n">yellow</span><span class="o">.</span><span class="n">shader</span> <span class="o">=</span> <span class="s2">&quot;defaultLit&quot;</span>

    <span class="n">green</span> <span class="o">=</span> <span class="n">rendering</span><span class="o">.</span><span class="n">MaterialRecord</span><span class="p">()</span>
    <span class="n">green</span><span class="o">.</span><span class="n">base_color</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
    <span class="n">green</span><span class="o">.</span><span class="n">shader</span> <span class="o">=</span> <span class="s2">&quot;defaultLit&quot;</span>

    <span class="n">grey</span> <span class="o">=</span> <span class="n">rendering</span><span class="o">.</span><span class="n">MaterialRecord</span><span class="p">()</span>
    <span class="n">grey</span><span class="o">.</span><span class="n">base_color</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
    <span class="n">grey</span><span class="o">.</span><span class="n">shader</span> <span class="o">=</span> <span class="s2">&quot;defaultLit&quot;</span>

    <span class="n">white</span> <span class="o">=</span> <span class="n">rendering</span><span class="o">.</span><span class="n">MaterialRecord</span><span class="p">()</span>
    <span class="n">white</span><span class="o">.</span><span class="n">base_color</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
    <span class="n">white</span><span class="o">.</span><span class="n">shader</span> <span class="o">=</span> <span class="s2">&quot;defaultLit&quot;</span>

    <span class="n">cyl</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">TriangleMesh</span><span class="o">.</span><span class="n">create_cylinder</span><span class="p">(</span><span class="mf">.05</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">cyl</span><span class="o">.</span><span class="n">compute_vertex_normals</span><span class="p">()</span>
    <span class="n">cyl</span><span class="o">.</span><span class="n">translate</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">])</span>
    <span class="n">sphere</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">TriangleMesh</span><span class="o">.</span><span class="n">create_sphere</span><span class="p">(</span><span class="mf">.2</span><span class="p">)</span>
    <span class="n">sphere</span><span class="o">.</span><span class="n">compute_vertex_normals</span><span class="p">()</span>
    <span class="n">sphere</span><span class="o">.</span><span class="n">translate</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>

    <span class="n">box</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">TriangleMesh</span><span class="o">.</span><span class="n">create_box</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">box</span><span class="o">.</span><span class="n">compute_vertex_normals</span><span class="p">()</span>
    <span class="n">box</span><span class="o">.</span><span class="n">translate</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">solid</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">TriangleMesh</span><span class="o">.</span><span class="n">create_icosahedron</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">solid</span><span class="o">.</span><span class="n">compute_triangle_normals</span><span class="p">()</span>
    <span class="n">solid</span><span class="o">.</span><span class="n">compute_vertex_normals</span><span class="p">()</span>
    <span class="n">solid</span><span class="o">.</span><span class="n">translate</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.75</span><span class="p">])</span>

    <span class="n">render</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">add_geometry</span><span class="p">(</span><span class="s2">&quot;cyl&quot;</span><span class="p">,</span> <span class="n">cyl</span><span class="p">,</span> <span class="n">green</span><span class="p">)</span>
    <span class="n">render</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">add_geometry</span><span class="p">(</span><span class="s2">&quot;sphere&quot;</span><span class="p">,</span> <span class="n">sphere</span><span class="p">,</span> <span class="n">yellow</span><span class="p">)</span>
    <span class="n">render</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">add_geometry</span><span class="p">(</span><span class="s2">&quot;box&quot;</span><span class="p">,</span> <span class="n">box</span><span class="p">,</span> <span class="n">grey</span><span class="p">)</span>
    <span class="n">render</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">add_geometry</span><span class="p">(</span><span class="s2">&quot;solid&quot;</span><span class="p">,</span> <span class="n">solid</span><span class="p">,</span> <span class="n">white</span><span class="p">)</span>
    <span class="n">render</span><span class="o">.</span><span class="n">setup_camera</span><span class="p">(</span><span class="mf">60.0</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">render</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">set_sun_light</span><span class="p">([</span><span class="mf">0.707</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">.707</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
                                     <span class="mi">75000</span><span class="p">)</span>
    <span class="n">render</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">enable_sun_light</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">render</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">show_axes</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">img</span> <span class="o">=</span> <span class="n">render</span><span class="o">.</span><span class="n">render_to_image</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saving image at test.png&quot;</span><span class="p">)</span>
    <span class="n">o3d</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">write_image</span><span class="p">(</span><span class="s2">&quot;test.png&quot;</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>

    <span class="n">render</span><span class="o">.</span><span class="n">setup_camera</span><span class="p">(</span><span class="mf">60.0</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">render</span><span class="o">.</span><span class="n">render_to_image</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saving image at test2.png&quot;</span><span class="p">)</span>
    <span class="n">o3d</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">write_image</span><span class="p">(</span><span class="s2">&quot;test2.png&quot;</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div></td></tr></table></div>
</div>
</div>
<div class="section" id="tensorboard-pytorch-py">
<h2>tensorboard_pytorch.py<a class="headerlink" href="#tensorboard-pytorch-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span></pre></div></td><td class="code"><div><pre><span></span><span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># -                        Open3D: www.open3d.org                            -</span>
<span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># Copyright (c) 2018-2023 www.open3d.org</span>
<span class="c1"># SPDX-License-Identifier: MIT</span>
<span class="c1"># ----------------------------------------------------------------------------</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">open3d</span> <span class="k">as</span> <span class="nn">o3d</span>
<span class="c1"># pylint: disable-next=unused-import</span>
<span class="kn">from</span> <span class="nn">open3d.visualization.tensorboard_plugin.util</span> <span class="kn">import</span> <span class="n">to_dict_batch</span>
<span class="kn">from</span> <span class="nn">torch.utils.tensorboard</span> <span class="kn">import</span> <span class="n">SummaryWriter</span>

<span class="n">BASE_LOGDIR</span> <span class="o">=</span> <span class="s2">&quot;demo_logs/pytorch/&quot;</span>
<span class="n">MODEL_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span>
        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)))),</span> <span class="s2">&quot;test_data&quot;</span><span class="p">,</span> <span class="s2">&quot;monkey&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">small_scale</span><span class="p">(</span><span class="n">run_name</span><span class="o">=</span><span class="s2">&quot;small_scale&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Basic demo with cube and cylinder with normals and colors.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_LOGDIR</span><span class="p">,</span> <span class="n">run_name</span><span class="p">)</span>
    <span class="n">writer</span> <span class="o">=</span> <span class="n">SummaryWriter</span><span class="p">(</span><span class="n">logdir</span><span class="p">)</span>

    <span class="n">cube</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">TriangleMesh</span><span class="o">.</span><span class="n">create_box</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">create_uv_map</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">cube</span><span class="o">.</span><span class="n">compute_vertex_normals</span><span class="p">()</span>
    <span class="n">cylinder</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">TriangleMesh</span><span class="o">.</span><span class="n">create_cylinder</span><span class="p">(</span><span class="n">radius</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                                                         <span class="n">height</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
                                                         <span class="n">resolution</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                                                         <span class="n">split</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                                                         <span class="n">create_uv_map</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">cylinder</span><span class="o">.</span><span class="n">compute_vertex_normals</span><span class="p">()</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="p">[(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">cube</span><span class="o">.</span><span class="n">paint_uniform_color</span><span class="p">(</span><span class="n">colors</span><span class="p">[</span><span class="n">step</span><span class="p">])</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">add_3d</span><span class="p">(</span><span class="s1">&#39;cube&#39;</span><span class="p">,</span> <span class="n">to_dict_batch</span><span class="p">([</span><span class="n">cube</span><span class="p">]),</span> <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">)</span>
        <span class="n">cylinder</span><span class="o">.</span><span class="n">paint_uniform_color</span><span class="p">(</span><span class="n">colors</span><span class="p">[</span><span class="n">step</span><span class="p">])</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">add_3d</span><span class="p">(</span><span class="s1">&#39;cylinder&#39;</span><span class="p">,</span> <span class="n">to_dict_batch</span><span class="p">([</span><span class="n">cylinder</span><span class="p">]),</span> <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">property_reference</span><span class="p">(</span><span class="n">run_name</span><span class="o">=</span><span class="s2">&quot;property_reference&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Produces identical visualization to small_scale, but does not store</span>
<span class="sd">    repeated properties of ``vertex_positions`` and ``vertex_normals``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_LOGDIR</span><span class="p">,</span> <span class="n">run_name</span><span class="p">)</span>
    <span class="n">writer</span> <span class="o">=</span> <span class="n">SummaryWriter</span><span class="p">(</span><span class="n">logdir</span><span class="p">)</span>

    <span class="n">cube</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">TriangleMesh</span><span class="o">.</span><span class="n">create_box</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">create_uv_map</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">cube</span><span class="o">.</span><span class="n">compute_vertex_normals</span><span class="p">()</span>
    <span class="n">cylinder</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">TriangleMesh</span><span class="o">.</span><span class="n">create_cylinder</span><span class="p">(</span><span class="n">radius</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                                                         <span class="n">height</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
                                                         <span class="n">resolution</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                                                         <span class="n">split</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                                                         <span class="n">create_uv_map</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">cylinder</span><span class="o">.</span><span class="n">compute_vertex_normals</span><span class="p">()</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="p">[(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">cube</span><span class="o">.</span><span class="n">paint_uniform_color</span><span class="p">(</span><span class="n">colors</span><span class="p">[</span><span class="n">step</span><span class="p">])</span>
        <span class="n">cube_summary</span> <span class="o">=</span> <span class="n">to_dict_batch</span><span class="p">([</span><span class="n">cube</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">step</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">cube_summary</span><span class="p">[</span><span class="s1">&#39;vertex_positions&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">cube_summary</span><span class="p">[</span><span class="s1">&#39;vertex_normals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">add_3d</span><span class="p">(</span><span class="s1">&#39;cube&#39;</span><span class="p">,</span> <span class="n">cube_summary</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">)</span>
        <span class="n">cylinder</span><span class="o">.</span><span class="n">paint_uniform_color</span><span class="p">(</span><span class="n">colors</span><span class="p">[</span><span class="n">step</span><span class="p">])</span>
        <span class="n">cylinder_summary</span> <span class="o">=</span> <span class="n">to_dict_batch</span><span class="p">([</span><span class="n">cylinder</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">step</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">cylinder_summary</span><span class="p">[</span><span class="s1">&#39;vertex_positions&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">cylinder_summary</span><span class="p">[</span><span class="s1">&#39;vertex_normals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">add_3d</span><span class="p">(</span><span class="s1">&#39;cylinder&#39;</span><span class="p">,</span> <span class="n">cylinder_summary</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">large_scale</span><span class="p">(</span><span class="n">n_steps</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
                <span class="n">batch_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">base_resolution</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
                <span class="n">run_name</span><span class="o">=</span><span class="s2">&quot;large_scale&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a large scale summary. Geometry resolution increases linearly</span>
<span class="sd">    with step. Each element in a batch is painted a different color.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_LOGDIR</span><span class="p">,</span> <span class="n">run_name</span><span class="p">)</span>
    <span class="n">writer</span> <span class="o">=</span> <span class="n">SummaryWriter</span><span class="p">(</span><span class="n">logdir</span><span class="p">)</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">batch_size</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">k</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">batch_size</span>
        <span class="n">colors</span><span class="o">.</span><span class="n">append</span><span class="p">(((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">t</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">t</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">t</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_steps</span><span class="p">):</span>
        <span class="n">resolution</span> <span class="o">=</span> <span class="n">base_resolution</span> <span class="o">*</span> <span class="p">(</span><span class="n">step</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">cylinder_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">mobius_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">cylinder</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">TriangleMesh</span><span class="o">.</span><span class="n">create_cylinder</span><span class="p">(</span>
            <span class="n">radius</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">cylinder</span><span class="o">.</span><span class="n">compute_vertex_normals</span><span class="p">()</span>
        <span class="n">mobius</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">TriangleMesh</span><span class="o">.</span><span class="n">create_mobius</span><span class="p">(</span>
            <span class="n">length_split</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mf">3.5</span> <span class="o">*</span> <span class="n">resolution</span><span class="p">),</span>
            <span class="n">width_split</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mf">0.75</span> <span class="o">*</span> <span class="n">resolution</span><span class="p">),</span>
            <span class="n">twists</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">raidus</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">flatness</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">mobius</span><span class="o">.</span><span class="n">compute_vertex_normals</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">batch_size</span><span class="p">):</span>
            <span class="n">cylinder_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">cylinder</span><span class="p">))</span>
            <span class="n">cylinder_list</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">paint_uniform_color</span><span class="p">(</span><span class="n">colors</span><span class="p">[</span><span class="n">b</span><span class="p">])</span>
            <span class="n">mobius_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">mobius</span><span class="p">))</span>
            <span class="n">mobius_list</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">paint_uniform_color</span><span class="p">(</span><span class="n">colors</span><span class="p">[</span><span class="n">b</span><span class="p">])</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">add_3d</span><span class="p">(</span><span class="s1">&#39;cylinder&#39;</span><span class="p">,</span>
                      <span class="n">to_dict_batch</span><span class="p">(</span><span class="n">cylinder_list</span><span class="p">),</span>
                      <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span>
                      <span class="n">max_outputs</span><span class="o">=</span><span class="n">batch_size</span><span class="p">)</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">add_3d</span><span class="p">(</span><span class="s1">&#39;mobius&#39;</span><span class="p">,</span>
                      <span class="n">to_dict_batch</span><span class="p">(</span><span class="n">mobius_list</span><span class="p">),</span>
                      <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span>
                      <span class="n">max_outputs</span><span class="o">=</span><span class="n">batch_size</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">with_material</span><span class="p">(</span><span class="n">model_dir</span><span class="o">=</span><span class="n">MODEL_DIR</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Read an obj model from a directory and write as a TensorBoard summary.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">model_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">model_dir</span><span class="p">)</span>
    <span class="n">logdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_LOGDIR</span><span class="p">,</span> <span class="n">model_name</span><span class="p">)</span>
    <span class="n">model_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_dir</span><span class="p">,</span> <span class="n">model_name</span> <span class="o">+</span> <span class="s2">&quot;.obj&quot;</span><span class="p">)</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">TriangleMesh</span><span class="o">.</span><span class="n">from_legacy</span><span class="p">(</span>
        <span class="n">o3d</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_triangle_mesh</span><span class="p">(</span><span class="n">model_path</span><span class="p">))</span>
    <span class="n">summary_3d</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;vertex_positions&quot;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">vertex</span><span class="o">.</span><span class="n">positions</span><span class="p">,</span>
        <span class="s2">&quot;vertex_normals&quot;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">vertex</span><span class="o">.</span><span class="n">normals</span><span class="p">,</span>
        <span class="s2">&quot;triangle_texture_uvs&quot;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">triangle</span><span class="p">[</span><span class="s2">&quot;texture_uvs&quot;</span><span class="p">],</span>
        <span class="s2">&quot;triangle_indices&quot;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">triangle</span><span class="o">.</span><span class="n">indices</span><span class="p">,</span>
        <span class="s2">&quot;material_name&quot;</span><span class="p">:</span> <span class="s2">&quot;defaultLit&quot;</span>
    <span class="p">}</span>
    <span class="n">names_to_o3dprop</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;ao&quot;</span><span class="p">:</span> <span class="s2">&quot;ambient_occlusion&quot;</span><span class="p">}</span>

    <span class="k">for</span> <span class="n">texture</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;albedo&quot;</span><span class="p">,</span> <span class="s2">&quot;normal&quot;</span><span class="p">,</span> <span class="s2">&quot;ao&quot;</span><span class="p">,</span> <span class="s2">&quot;metallic&quot;</span><span class="p">,</span> <span class="s2">&quot;roughness&quot;</span><span class="p">):</span>
        <span class="n">texture_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_dir</span><span class="p">,</span> <span class="n">texture</span> <span class="o">+</span> <span class="s2">&quot;.png&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">texture_file</span><span class="p">):</span>
            <span class="n">texture</span> <span class="o">=</span> <span class="n">names_to_o3dprop</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">texture</span><span class="p">,</span> <span class="n">texture</span><span class="p">)</span>
            <span class="n">summary_3d</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
                <span class="p">(</span><span class="s2">&quot;material_texture_map_&quot;</span> <span class="o">+</span> <span class="n">texture</span><span class="p">):</span>
                    <span class="n">o3d</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_image</span><span class="p">(</span><span class="n">texture_file</span><span class="p">)</span>
            <span class="p">})</span>
            <span class="k">if</span> <span class="n">texture</span> <span class="o">==</span> <span class="s2">&quot;metallic&quot;</span><span class="p">:</span>
                <span class="n">summary_3d</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">material_scalar_metallic</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>

    <span class="n">writer</span> <span class="o">=</span> <span class="n">SummaryWriter</span><span class="p">(</span><span class="n">logdir</span><span class="p">)</span>
    <span class="n">writer</span><span class="o">.</span><span class="n">add_3d</span><span class="p">(</span><span class="n">model_name</span><span class="p">,</span> <span class="n">summary_3d</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">demo_scene</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Write the demo_scene.py example showing rich PBR materials as a summary</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">demo_scene</span>
    <span class="n">geoms</span> <span class="o">=</span> <span class="n">demo_scene</span><span class="o">.</span><span class="n">create_scene</span><span class="p">()</span>
    <span class="n">writer</span> <span class="o">=</span> <span class="n">SummaryWriter</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_LOGDIR</span><span class="p">,</span> <span class="s1">&#39;demo_scene&#39;</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">geom_data</span> <span class="ow">in</span> <span class="n">geoms</span><span class="p">:</span>
        <span class="n">geom</span> <span class="o">=</span> <span class="n">geom_data</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span>
        <span class="n">summary_3d</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">tensor</span> <span class="ow">in</span> <span class="n">geom</span><span class="o">.</span><span class="n">vertex</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">summary_3d</span><span class="p">[</span><span class="s2">&quot;vertex_&quot;</span> <span class="o">+</span> <span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">tensor</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">tensor</span> <span class="ow">in</span> <span class="n">geom</span><span class="o">.</span><span class="n">triangle</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">summary_3d</span><span class="p">[</span><span class="s2">&quot;triangle_&quot;</span> <span class="o">+</span> <span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">tensor</span>
        <span class="k">if</span> <span class="n">geom</span><span class="o">.</span><span class="n">has_valid_material</span><span class="p">():</span>
            <span class="n">summary_3d</span><span class="p">[</span><span class="s2">&quot;material_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">geom</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">material_name</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">geom</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">scalar_properties</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">summary_3d</span><span class="p">[</span><span class="s2">&quot;material_scalar_&quot;</span> <span class="o">+</span> <span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">geom</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">vector_properties</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">summary_3d</span><span class="p">[</span><span class="s2">&quot;material_vector_&quot;</span> <span class="o">+</span> <span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">geom</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">texture_maps</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">summary_3d</span><span class="p">[</span><span class="s2">&quot;material_texture_map_&quot;</span> <span class="o">+</span> <span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">add_3d</span><span class="p">(</span><span class="n">geom_data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span> <span class="n">summary_3d</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>

    <span class="n">examples</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;small_scale&#39;</span><span class="p">,</span> <span class="s1">&#39;large_scale&#39;</span><span class="p">,</span> <span class="s1">&#39;property_reference&#39;</span><span class="p">,</span>
                <span class="s1">&#39;with_material&#39;</span><span class="p">,</span> <span class="s1">&#39;demo_scene&#39;</span><span class="p">)</span>
    <span class="n">selected</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">eg</span> <span class="k">for</span> <span class="n">eg</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="k">if</span> <span class="n">eg</span> <span class="ow">in</span> <span class="n">examples</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">selected</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Usage: python </span><span class="si">{</span><span class="vm">__file__</span><span class="si">}</span><span class="s1"> EXAMPLE...&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;  where EXAMPLE are from </span><span class="si">{</span><span class="n">examples</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">selected</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;property_reference&#39;</span><span class="p">,</span> <span class="s1">&#39;with_material&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">eg</span> <span class="ow">in</span> <span class="n">selected</span><span class="p">:</span>
        <span class="nb">locals</span><span class="p">()[</span><span class="n">eg</span><span class="p">]()</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Run &#39;tensorboard --logdir </span><span class="si">{</span><span class="n">BASE_LOGDIR</span><span class="si">}</span><span class="s2">&#39; to visualize the 3D &quot;</span>
          <span class="s2">&quot;summary.&quot;</span><span class="p">)</span>
</pre></div></td></tr></table></div>
</div>
</div>
<div class="section" id="tensorboard-tensorflow-py">
<h2>tensorboard_tensorflow.py<a class="headerlink" href="#tensorboard-tensorflow-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span></pre></div></td><td class="code"><div><pre><span></span><span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># -                        Open3D: www.open3d.org                            -</span>
<span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># Copyright (c) 2018-2023 www.open3d.org</span>
<span class="c1"># SPDX-License-Identifier: MIT</span>
<span class="c1"># ----------------------------------------------------------------------------</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">open3d</span> <span class="k">as</span> <span class="nn">o3d</span>
<span class="kn">from</span> <span class="nn">open3d.visualization.tensorboard_plugin</span> <span class="kn">import</span> <span class="n">summary</span>
<span class="kn">from</span> <span class="nn">open3d.visualization.tensorboard_plugin.util</span> <span class="kn">import</span> <span class="n">to_dict_batch</span>
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>

<span class="n">BASE_LOGDIR</span> <span class="o">=</span> <span class="s2">&quot;demo_logs/tf/&quot;</span>
<span class="n">MODEL_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span>
        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)))),</span> <span class="s2">&quot;test_data&quot;</span><span class="p">,</span> <span class="s2">&quot;monkey&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">small_scale</span><span class="p">(</span><span class="n">run_name</span><span class="o">=</span><span class="s2">&quot;small_scale&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Basic demo with cube and cylinder with normals and colors.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_LOGDIR</span><span class="p">,</span> <span class="n">run_name</span><span class="p">)</span>
    <span class="n">writer</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">summary</span><span class="o">.</span><span class="n">create_file_writer</span><span class="p">(</span><span class="n">logdir</span><span class="p">)</span>

    <span class="n">cube</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">TriangleMesh</span><span class="o">.</span><span class="n">create_box</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">create_uv_map</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">cube</span><span class="o">.</span><span class="n">compute_vertex_normals</span><span class="p">()</span>
    <span class="n">cylinder</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">TriangleMesh</span><span class="o">.</span><span class="n">create_cylinder</span><span class="p">(</span><span class="n">radius</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                                                         <span class="n">height</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
                                                         <span class="n">resolution</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                                                         <span class="n">split</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                                                         <span class="n">create_uv_map</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">cylinder</span><span class="o">.</span><span class="n">compute_vertex_normals</span><span class="p">()</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="p">[(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)]</span>
    <span class="k">with</span> <span class="n">writer</span><span class="o">.</span><span class="n">as_default</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="n">cube</span><span class="o">.</span><span class="n">paint_uniform_color</span><span class="p">(</span><span class="n">colors</span><span class="p">[</span><span class="n">step</span><span class="p">])</span>
            <span class="n">summary</span><span class="o">.</span><span class="n">add_3d</span><span class="p">(</span><span class="s1">&#39;cube&#39;</span><span class="p">,</span>
                           <span class="n">to_dict_batch</span><span class="p">([</span><span class="n">cube</span><span class="p">]),</span>
                           <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span>
                           <span class="n">logdir</span><span class="o">=</span><span class="n">logdir</span><span class="p">)</span>
            <span class="n">cylinder</span><span class="o">.</span><span class="n">paint_uniform_color</span><span class="p">(</span><span class="n">colors</span><span class="p">[</span><span class="n">step</span><span class="p">])</span>
            <span class="n">summary</span><span class="o">.</span><span class="n">add_3d</span><span class="p">(</span><span class="s1">&#39;cylinder&#39;</span><span class="p">,</span>
                           <span class="n">to_dict_batch</span><span class="p">([</span><span class="n">cylinder</span><span class="p">]),</span>
                           <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span>
                           <span class="n">logdir</span><span class="o">=</span><span class="n">logdir</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">property_reference</span><span class="p">(</span><span class="n">run_name</span><span class="o">=</span><span class="s2">&quot;property_reference&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Produces identical visualization to small_scale, but does not store</span>
<span class="sd">    repeated properties of ``vertex_positions`` and ``vertex_normals``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_LOGDIR</span><span class="p">,</span> <span class="n">run_name</span><span class="p">)</span>
    <span class="n">writer</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">summary</span><span class="o">.</span><span class="n">create_file_writer</span><span class="p">(</span><span class="n">logdir</span><span class="p">)</span>

    <span class="n">cube</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">TriangleMesh</span><span class="o">.</span><span class="n">create_box</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">create_uv_map</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">cube</span><span class="o">.</span><span class="n">compute_vertex_normals</span><span class="p">()</span>
    <span class="n">cylinder</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">TriangleMesh</span><span class="o">.</span><span class="n">create_cylinder</span><span class="p">(</span><span class="n">radius</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                                                         <span class="n">height</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
                                                         <span class="n">resolution</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                                                         <span class="n">split</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                                                         <span class="n">create_uv_map</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">cylinder</span><span class="o">.</span><span class="n">compute_vertex_normals</span><span class="p">()</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="p">[(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)]</span>
    <span class="k">with</span> <span class="n">writer</span><span class="o">.</span><span class="n">as_default</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="n">cube</span><span class="o">.</span><span class="n">paint_uniform_color</span><span class="p">(</span><span class="n">colors</span><span class="p">[</span><span class="n">step</span><span class="p">])</span>
            <span class="n">cube_summary</span> <span class="o">=</span> <span class="n">to_dict_batch</span><span class="p">([</span><span class="n">cube</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">step</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">cube_summary</span><span class="p">[</span><span class="s1">&#39;vertex_positions&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">cube_summary</span><span class="p">[</span><span class="s1">&#39;vertex_normals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">summary</span><span class="o">.</span><span class="n">add_3d</span><span class="p">(</span><span class="s1">&#39;cube&#39;</span><span class="p">,</span> <span class="n">cube_summary</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span> <span class="n">logdir</span><span class="o">=</span><span class="n">logdir</span><span class="p">)</span>
            <span class="n">cylinder</span><span class="o">.</span><span class="n">paint_uniform_color</span><span class="p">(</span><span class="n">colors</span><span class="p">[</span><span class="n">step</span><span class="p">])</span>
            <span class="n">cylinder_summary</span> <span class="o">=</span> <span class="n">to_dict_batch</span><span class="p">([</span><span class="n">cylinder</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">step</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">cylinder_summary</span><span class="p">[</span><span class="s1">&#39;vertex_positions&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">cylinder_summary</span><span class="p">[</span><span class="s1">&#39;vertex_normals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">summary</span><span class="o">.</span><span class="n">add_3d</span><span class="p">(</span><span class="s1">&#39;cylinder&#39;</span><span class="p">,</span>
                           <span class="n">cylinder_summary</span><span class="p">,</span>
                           <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span>
                           <span class="n">logdir</span><span class="o">=</span><span class="n">logdir</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">large_scale</span><span class="p">(</span><span class="n">n_steps</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
                <span class="n">batch_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">base_resolution</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
                <span class="n">run_name</span><span class="o">=</span><span class="s2">&quot;large_scale&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a large scale summary. Geometry resolution increases linearly</span>
<span class="sd">    with step. Each element in a batch is painted a different color.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_LOGDIR</span><span class="p">,</span> <span class="n">run_name</span><span class="p">)</span>
    <span class="n">writer</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">summary</span><span class="o">.</span><span class="n">create_file_writer</span><span class="p">(</span><span class="n">logdir</span><span class="p">)</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">batch_size</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">k</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">batch_size</span>
        <span class="n">colors</span><span class="o">.</span><span class="n">append</span><span class="p">(((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">t</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">t</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">t</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
    <span class="k">with</span> <span class="n">writer</span><span class="o">.</span><span class="n">as_default</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_steps</span><span class="p">):</span>
            <span class="n">resolution</span> <span class="o">=</span> <span class="n">base_resolution</span> <span class="o">*</span> <span class="p">(</span><span class="n">step</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">cylinder_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">mobius_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">cylinder</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">TriangleMesh</span><span class="o">.</span><span class="n">create_cylinder</span><span class="p">(</span>
                <span class="n">radius</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
            <span class="n">cylinder</span><span class="o">.</span><span class="n">compute_vertex_normals</span><span class="p">()</span>
            <span class="n">mobius</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">TriangleMesh</span><span class="o">.</span><span class="n">create_mobius</span><span class="p">(</span>
                <span class="n">length_split</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mf">3.5</span> <span class="o">*</span> <span class="n">resolution</span><span class="p">),</span>
                <span class="n">width_split</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mf">0.75</span> <span class="o">*</span> <span class="n">resolution</span><span class="p">),</span>
                <span class="n">twists</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">raidus</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">flatness</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">mobius</span><span class="o">.</span><span class="n">compute_vertex_normals</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">batch_size</span><span class="p">):</span>
                <span class="n">cylinder_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">cylinder</span><span class="p">))</span>
                <span class="n">cylinder_list</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">paint_uniform_color</span><span class="p">(</span><span class="n">colors</span><span class="p">[</span><span class="n">b</span><span class="p">])</span>
                <span class="n">mobius_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">mobius</span><span class="p">))</span>
                <span class="n">mobius_list</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">paint_uniform_color</span><span class="p">(</span><span class="n">colors</span><span class="p">[</span><span class="n">b</span><span class="p">])</span>
            <span class="n">summary</span><span class="o">.</span><span class="n">add_3d</span><span class="p">(</span><span class="s1">&#39;cylinder&#39;</span><span class="p">,</span>
                           <span class="n">to_dict_batch</span><span class="p">(</span><span class="n">cylinder_list</span><span class="p">),</span>
                           <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span>
                           <span class="n">logdir</span><span class="o">=</span><span class="n">logdir</span><span class="p">,</span>
                           <span class="n">max_outputs</span><span class="o">=</span><span class="n">batch_size</span><span class="p">)</span>
            <span class="n">summary</span><span class="o">.</span><span class="n">add_3d</span><span class="p">(</span><span class="s1">&#39;mobius&#39;</span><span class="p">,</span>
                           <span class="n">to_dict_batch</span><span class="p">(</span><span class="n">mobius_list</span><span class="p">),</span>
                           <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span>
                           <span class="n">logdir</span><span class="o">=</span><span class="n">logdir</span><span class="p">,</span>
                           <span class="n">max_outputs</span><span class="o">=</span><span class="n">batch_size</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">with_material</span><span class="p">(</span><span class="n">model_dir</span><span class="o">=</span><span class="n">MODEL_DIR</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Read an obj model from a directory and write as a TensorBoard summary.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">model_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">model_dir</span><span class="p">)</span>
    <span class="n">logdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_LOGDIR</span><span class="p">,</span> <span class="n">model_name</span><span class="p">)</span>
    <span class="n">model_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_dir</span><span class="p">,</span> <span class="n">model_name</span> <span class="o">+</span> <span class="s2">&quot;.obj&quot;</span><span class="p">)</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">TriangleMesh</span><span class="o">.</span><span class="n">from_legacy</span><span class="p">(</span>
        <span class="n">o3d</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_triangle_mesh</span><span class="p">(</span><span class="n">model_path</span><span class="p">))</span>
    <span class="n">summary_3d</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;vertex_positions&quot;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">vertex</span><span class="o">.</span><span class="n">positions</span><span class="p">,</span>
        <span class="s2">&quot;vertex_normals&quot;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">vertex</span><span class="o">.</span><span class="n">normals</span><span class="p">,</span>
        <span class="s2">&quot;triangle_texture_uvs&quot;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">triangle</span><span class="p">[</span><span class="s2">&quot;texture_uvs&quot;</span><span class="p">],</span>
        <span class="s2">&quot;triangle_indices&quot;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">triangle</span><span class="o">.</span><span class="n">indices</span><span class="p">,</span>
        <span class="s2">&quot;material_name&quot;</span><span class="p">:</span> <span class="s2">&quot;defaultLit&quot;</span>
    <span class="p">}</span>
    <span class="n">names_to_o3dprop</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;ao&quot;</span><span class="p">:</span> <span class="s2">&quot;ambient_occlusion&quot;</span><span class="p">}</span>

    <span class="k">for</span> <span class="n">texture</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;albedo&quot;</span><span class="p">,</span> <span class="s2">&quot;normal&quot;</span><span class="p">,</span> <span class="s2">&quot;ao&quot;</span><span class="p">,</span> <span class="s2">&quot;metallic&quot;</span><span class="p">,</span> <span class="s2">&quot;roughness&quot;</span><span class="p">):</span>
        <span class="n">texture_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_dir</span><span class="p">,</span> <span class="n">texture</span> <span class="o">+</span> <span class="s2">&quot;.png&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">texture_file</span><span class="p">):</span>
            <span class="n">texture</span> <span class="o">=</span> <span class="n">names_to_o3dprop</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">texture</span><span class="p">,</span> <span class="n">texture</span><span class="p">)</span>
            <span class="n">summary_3d</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
                <span class="p">(</span><span class="s2">&quot;material_texture_map_&quot;</span> <span class="o">+</span> <span class="n">texture</span><span class="p">):</span>
                    <span class="n">o3d</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_image</span><span class="p">(</span><span class="n">texture_file</span><span class="p">)</span>
            <span class="p">})</span>
            <span class="k">if</span> <span class="n">texture</span> <span class="o">==</span> <span class="s2">&quot;metallic&quot;</span><span class="p">:</span>
                <span class="n">summary_3d</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">material_scalar_metallic</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>

    <span class="n">writer</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">summary</span><span class="o">.</span><span class="n">create_file_writer</span><span class="p">(</span><span class="n">logdir</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">writer</span><span class="o">.</span><span class="n">as_default</span><span class="p">():</span>
        <span class="n">summary</span><span class="o">.</span><span class="n">add_3d</span><span class="p">(</span><span class="n">model_name</span><span class="p">,</span> <span class="n">summary_3d</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">logdir</span><span class="o">=</span><span class="n">logdir</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">demo_scene</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Write the demo_scene.py example showing rich PBR materials as a summary.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">demo_scene</span>
    <span class="n">geoms</span> <span class="o">=</span> <span class="n">demo_scene</span><span class="o">.</span><span class="n">create_scene</span><span class="p">()</span>
    <span class="n">logdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_LOGDIR</span><span class="p">,</span> <span class="s1">&#39;demo_scene&#39;</span><span class="p">)</span>
    <span class="n">writer</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">summary</span><span class="o">.</span><span class="n">create_file_writer</span><span class="p">(</span><span class="n">logdir</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">geom_data</span> <span class="ow">in</span> <span class="n">geoms</span><span class="p">:</span>
        <span class="n">geom</span> <span class="o">=</span> <span class="n">geom_data</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span>
        <span class="n">summary_3d</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">tensor</span> <span class="ow">in</span> <span class="n">geom</span><span class="o">.</span><span class="n">vertex</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">summary_3d</span><span class="p">[</span><span class="s2">&quot;vertex_&quot;</span> <span class="o">+</span> <span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">tensor</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">tensor</span> <span class="ow">in</span> <span class="n">geom</span><span class="o">.</span><span class="n">triangle</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">summary_3d</span><span class="p">[</span><span class="s2">&quot;triangle_&quot;</span> <span class="o">+</span> <span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">tensor</span>
        <span class="k">if</span> <span class="n">geom</span><span class="o">.</span><span class="n">has_valid_material</span><span class="p">():</span>
            <span class="n">summary_3d</span><span class="p">[</span><span class="s2">&quot;material_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">geom</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">material_name</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">geom</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">scalar_properties</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">summary_3d</span><span class="p">[</span><span class="s2">&quot;material_scalar_&quot;</span> <span class="o">+</span> <span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">geom</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">vector_properties</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">summary_3d</span><span class="p">[</span><span class="s2">&quot;material_vector_&quot;</span> <span class="o">+</span> <span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">geom</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">texture_maps</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">summary_3d</span><span class="p">[</span><span class="s2">&quot;material_texture_map_&quot;</span> <span class="o">+</span> <span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">with</span> <span class="n">writer</span><span class="o">.</span><span class="n">as_default</span><span class="p">():</span>
            <span class="n">summary</span><span class="o">.</span><span class="n">add_3d</span><span class="p">(</span><span class="n">geom_data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span> <span class="n">summary_3d</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">logdir</span><span class="o">=</span><span class="n">logdir</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>

    <span class="n">examples</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;small_scale&#39;</span><span class="p">,</span> <span class="s1">&#39;large_scale&#39;</span><span class="p">,</span> <span class="s1">&#39;property_reference&#39;</span><span class="p">,</span>
                <span class="s1">&#39;with_material&#39;</span><span class="p">,</span> <span class="s1">&#39;demo_scene&#39;</span><span class="p">)</span>
    <span class="n">selected</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">eg</span> <span class="k">for</span> <span class="n">eg</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="k">if</span> <span class="n">eg</span> <span class="ow">in</span> <span class="n">examples</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">selected</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Usage: python </span><span class="si">{</span><span class="vm">__file__</span><span class="si">}</span><span class="s1"> EXAMPLE...&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;  where EXAMPLE are from </span><span class="si">{</span><span class="n">examples</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">selected</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;property_reference&#39;</span><span class="p">,</span> <span class="s1">&#39;with_material&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">eg</span> <span class="ow">in</span> <span class="n">selected</span><span class="p">:</span>
        <span class="nb">locals</span><span class="p">()[</span><span class="n">eg</span><span class="p">]()</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Run &#39;tensorboard --logdir </span><span class="si">{</span><span class="n">BASE_LOGDIR</span><span class="si">}</span><span class="s2">&#39; to visualize the 3D &quot;</span>
          <span class="s2">&quot;summary.&quot;</span><span class="p">)</span>
</pre></div></td></tr></table></div>
</div>
</div>
<div class="section" id="text3d-py">
<h2>text3d.py<a class="headerlink" href="#text3d-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span></pre></div></td><td class="code"><div><pre><span></span><span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># -                        Open3D: www.open3d.org                            -</span>
<span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># Copyright (c) 2018-2023 www.open3d.org</span>
<span class="c1"># SPDX-License-Identifier: MIT</span>
<span class="c1"># ----------------------------------------------------------------------------</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">open3d</span> <span class="k">as</span> <span class="nn">o3d</span>
<span class="kn">import</span> <span class="nn">open3d.visualization.gui</span> <span class="k">as</span> <span class="nn">gui</span>
<span class="kn">import</span> <span class="nn">open3d.visualization.rendering</span> <span class="k">as</span> <span class="nn">rendering</span>


<span class="k">def</span> <span class="nf">make_point_cloud</span><span class="p">(</span><span class="n">npts</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">radius</span><span class="p">):</span>
    <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="n">radius</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">[</span><span class="n">npts</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span> <span class="o">+</span> <span class="n">center</span>
    <span class="n">cloud</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">PointCloud</span><span class="p">()</span>
    <span class="n">cloud</span><span class="o">.</span><span class="n">points</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">Vector3dVector</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">[</span><span class="n">npts</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
    <span class="n">cloud</span><span class="o">.</span><span class="n">colors</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">Vector3dVector</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cloud</span>


<span class="k">def</span> <span class="nf">high_level</span><span class="p">():</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Application</span><span class="o">.</span><span class="n">instance</span>
    <span class="n">app</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>

    <span class="n">points</span> <span class="o">=</span> <span class="n">make_point_cloud</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mf">1.0</span><span class="p">)</span>

    <span class="n">vis</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">O3DVisualizer</span><span class="p">(</span><span class="s2">&quot;Open3D - 3D Text&quot;</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="mi">768</span><span class="p">)</span>
    <span class="n">vis</span><span class="o">.</span><span class="n">show_settings</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">vis</span><span class="o">.</span><span class="n">add_geometry</span><span class="p">(</span><span class="s2">&quot;Points&quot;</span><span class="p">,</span> <span class="n">points</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="o">.</span><span class="n">points</span><span class="p">)):</span>
        <span class="n">vis</span><span class="o">.</span><span class="n">add_3d_label</span><span class="p">(</span><span class="n">points</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>
    <span class="n">vis</span><span class="o">.</span><span class="n">reset_camera_to_default</span><span class="p">()</span>

    <span class="n">app</span><span class="o">.</span><span class="n">add_window</span><span class="p">(</span><span class="n">vis</span><span class="p">)</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">low_level</span><span class="p">():</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Application</span><span class="o">.</span><span class="n">instance</span>
    <span class="n">app</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>

    <span class="n">points</span> <span class="o">=</span> <span class="n">make_point_cloud</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mf">1.0</span><span class="p">)</span>

    <span class="n">w</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">create_window</span><span class="p">(</span><span class="s2">&quot;Open3D - 3D Text&quot;</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="mi">768</span><span class="p">)</span>
    <span class="n">widget3d</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">SceneWidget</span><span class="p">()</span>
    <span class="n">widget3d</span><span class="o">.</span><span class="n">scene</span> <span class="o">=</span> <span class="n">rendering</span><span class="o">.</span><span class="n">Open3DScene</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">renderer</span><span class="p">)</span>
    <span class="n">mat</span> <span class="o">=</span> <span class="n">rendering</span><span class="o">.</span><span class="n">MaterialRecord</span><span class="p">()</span>
    <span class="n">mat</span><span class="o">.</span><span class="n">shader</span> <span class="o">=</span> <span class="s2">&quot;defaultUnlit&quot;</span>
    <span class="n">mat</span><span class="o">.</span><span class="n">point_size</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">w</span><span class="o">.</span><span class="n">scaling</span>
    <span class="n">widget3d</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">add_geometry</span><span class="p">(</span><span class="s2">&quot;Points&quot;</span><span class="p">,</span> <span class="n">points</span><span class="p">,</span> <span class="n">mat</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="o">.</span><span class="n">points</span><span class="p">)):</span>
        <span class="n">l</span> <span class="o">=</span> <span class="n">widget3d</span><span class="o">.</span><span class="n">add_3d_label</span><span class="p">(</span><span class="n">points</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>
        <span class="n">l</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="n">points</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">points</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                            <span class="n">points</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">l</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">)</span>
    <span class="n">bbox</span> <span class="o">=</span> <span class="n">widget3d</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">bounding_box</span>
    <span class="n">widget3d</span><span class="o">.</span><span class="n">setup_camera</span><span class="p">(</span><span class="mf">60.0</span><span class="p">,</span> <span class="n">bbox</span><span class="p">,</span> <span class="n">bbox</span><span class="o">.</span><span class="n">get_center</span><span class="p">())</span>
    <span class="n">w</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">widget3d</span><span class="p">)</span>

    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">high_level</span><span class="p">()</span>
    <span class="n">low_level</span><span class="p">()</span>
</pre></div></td></tr></table></div>
</div>
</div>
<div class="section" id="textured-mesh-py">
<h2>textured_mesh.py<a class="headerlink" href="#textured-mesh-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span></pre></div></td><td class="code"><div><pre><span></span><span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># -                        Open3D: www.open3d.org                            -</span>
<span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># Copyright (c) 2018-2023 www.open3d.org</span>
<span class="c1"># SPDX-License-Identifier: MIT</span>
<span class="c1"># ----------------------------------------------------------------------------</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">open3d</span> <span class="k">as</span> <span class="nn">o3d</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;Usage: textured-mesh.py [model directory]</span>
<span class="s2">    This example will load [model directory].obj plus any of albedo, normal,</span>
<span class="s2">    ao, metallic and roughness textures present. The textures should be named</span>
<span class="s2">    albedo.png, normal.png, ao.png, metallic.png and roughness.png</span>
<span class="s2">    respectively.&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

    <span class="n">model_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">model_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_dir</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">model_dir</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.obj&quot;</span><span class="p">)</span>
    <span class="n">mesh</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">TriangleMesh</span><span class="o">.</span><span class="n">from_legacy</span><span class="p">(</span>
        <span class="n">o3d</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_triangle_mesh</span><span class="p">(</span><span class="n">model_name</span><span class="p">))</span>
    <span class="n">material</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">material</span>
    <span class="n">material</span><span class="o">.</span><span class="n">material_name</span> <span class="o">=</span> <span class="s2">&quot;defaultLit&quot;</span>

    <span class="n">names_to_o3dprop</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;ao&quot;</span><span class="p">:</span> <span class="s2">&quot;ambient_occlusion&quot;</span><span class="p">}</span>
    <span class="k">for</span> <span class="n">texture</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;albedo&quot;</span><span class="p">,</span> <span class="s2">&quot;normal&quot;</span><span class="p">,</span> <span class="s2">&quot;ao&quot;</span><span class="p">,</span> <span class="s2">&quot;metallic&quot;</span><span class="p">,</span> <span class="s2">&quot;roughness&quot;</span><span class="p">):</span>
        <span class="n">texture_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_dir</span><span class="p">,</span> <span class="n">texture</span> <span class="o">+</span> <span class="s2">&quot;.png&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">texture_file</span><span class="p">):</span>
            <span class="n">texture</span> <span class="o">=</span> <span class="n">names_to_o3dprop</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">texture</span><span class="p">,</span> <span class="n">texture</span><span class="p">)</span>
            <span class="n">material</span><span class="o">.</span><span class="n">texture_maps</span><span class="p">[</span><span class="n">texture</span><span class="p">]</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_image</span><span class="p">(</span><span class="n">texture_file</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;metallic&quot;</span> <span class="ow">in</span> <span class="n">material</span><span class="o">.</span><span class="n">texture_maps</span><span class="p">:</span>
        <span class="n">material</span><span class="o">.</span><span class="n">scalar_properties</span><span class="p">[</span><span class="s2">&quot;metallic&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>

    <span class="n">o3d</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">model_name</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div></td></tr></table></div>
</div>
</div>
<div class="section" id="textured-model-py">
<h2>textured_model.py<a class="headerlink" href="#textured-model-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span></pre></div></td><td class="code"><div><pre><span></span><span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># -                        Open3D: www.open3d.org                            -</span>
<span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># Copyright (c) 2018-2023 www.open3d.org</span>
<span class="c1"># SPDX-License-Identifier: MIT</span>
<span class="c1"># ----------------------------------------------------------------------------</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">open3d</span> <span class="k">as</span> <span class="nn">o3d</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;Usage: texture-model.py [model directory]</span>
<span class="s2">    This example will load [model directory].obj plus any of albedo, normal,</span>
<span class="s2">    ao, metallic and roughness textures present.&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

    <span class="n">model_dir</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">model_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_dir</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">model_dir</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.obj&quot;</span><span class="p">)</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_triangle_mesh</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span>
    <span class="n">material</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">rendering</span><span class="o">.</span><span class="n">MaterialRecord</span><span class="p">()</span>
    <span class="n">material</span><span class="o">.</span><span class="n">shader</span> <span class="o">=</span> <span class="s2">&quot;defaultLit&quot;</span>

    <span class="n">albedo_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_dir</span><span class="p">,</span> <span class="s2">&quot;albedo.png&quot;</span><span class="p">)</span>
    <span class="n">normal_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_dir</span><span class="p">,</span> <span class="s2">&quot;normal.png&quot;</span><span class="p">)</span>
    <span class="n">ao_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_dir</span><span class="p">,</span> <span class="s2">&quot;ao.png&quot;</span><span class="p">)</span>
    <span class="n">metallic_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_dir</span><span class="p">,</span> <span class="s2">&quot;metallic.png&quot;</span><span class="p">)</span>
    <span class="n">roughness_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_dir</span><span class="p">,</span> <span class="s2">&quot;roughness.png&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">albedo_name</span><span class="p">):</span>
        <span class="n">material</span><span class="o">.</span><span class="n">albedo_img</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_image</span><span class="p">(</span><span class="n">albedo_name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">normal_name</span><span class="p">):</span>
        <span class="n">material</span><span class="o">.</span><span class="n">normal_img</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_image</span><span class="p">(</span><span class="n">normal_name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">ao_name</span><span class="p">):</span>
        <span class="n">material</span><span class="o">.</span><span class="n">ao_img</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_image</span><span class="p">(</span><span class="n">ao_name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">metallic_name</span><span class="p">):</span>
        <span class="n">material</span><span class="o">.</span><span class="n">base_metallic</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="n">material</span><span class="o">.</span><span class="n">metallic_img</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_image</span><span class="p">(</span><span class="n">metallic_name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">roughness_name</span><span class="p">):</span>
        <span class="n">material</span><span class="o">.</span><span class="n">roughness_img</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_image</span><span class="p">(</span><span class="n">roughness_name</span><span class="p">)</span>

    <span class="n">o3d</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">draw</span><span class="p">([{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;cube&quot;</span><span class="p">,</span>
        <span class="s2">&quot;geometry&quot;</span><span class="p">:</span> <span class="n">model</span><span class="p">,</span>
        <span class="s2">&quot;material&quot;</span><span class="p">:</span> <span class="n">material</span>
    <span class="p">}])</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div></td></tr></table></div>
</div>
</div>
<div class="section" id="to-mitsuba-py">
<h2>to_mitsuba.py<a class="headerlink" href="#to-mitsuba-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span></pre></div></td><td class="code"><div><pre><span></span><span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># -                        Open3D: www.open3d.org                            -</span>
<span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># Copyright (c) 2018-2023 www.open3d.org</span>
<span class="c1"># SPDX-License-Identifier: MIT</span>
<span class="c1"># ----------------------------------------------------------------------------</span>

<span class="kn">import</span> <span class="nn">open3d</span> <span class="k">as</span> <span class="nn">o3d</span>
<span class="kn">import</span> <span class="nn">mitsuba</span> <span class="k">as</span> <span class="nn">mi</span>


<span class="k">def</span> <span class="nf">render_mesh</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">mesh_center</span><span class="p">):</span>
    <span class="n">scene</span> <span class="o">=</span> <span class="n">mi</span><span class="o">.</span><span class="n">load_dict</span><span class="p">({</span>
        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;scene&#39;</span><span class="p">,</span>
        <span class="s1">&#39;integrator&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;path&#39;</span>
        <span class="p">},</span>
        <span class="s1">&#39;light&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;constant&#39;</span><span class="p">,</span>
            <span class="s1">&#39;radiance&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;rgb&#39;</span><span class="p">,</span>
                <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mf">1.0</span>
            <span class="p">}</span>
            <span class="c1"># NOTE: For better results comment out the constant emitter above</span>
            <span class="c1"># and uncomment out the lines below changing the filename to an HDRI</span>
            <span class="c1"># envmap you have.</span>
            <span class="c1"># &#39;type&#39;: &#39;envmap&#39;,</span>
            <span class="c1"># &#39;filename&#39;: &#39;/home/renes/Downloads/solitude_interior_4k.exr&#39;</span>
        <span class="p">},</span>
        <span class="s1">&#39;sensor&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span>
                <span class="s1">&#39;perspective&#39;</span><span class="p">,</span>
            <span class="s1">&#39;focal_length&#39;</span><span class="p">:</span>
                <span class="s1">&#39;50mm&#39;</span><span class="p">,</span>
            <span class="s1">&#39;to_world&#39;</span><span class="p">:</span>
                <span class="n">mi</span><span class="o">.</span><span class="n">ScalarTransform4f</span><span class="o">.</span><span class="n">look_at</span><span class="p">(</span><span class="n">origin</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
                                             <span class="n">target</span><span class="o">=</span><span class="n">mesh_center</span><span class="p">,</span>
                                             <span class="n">up</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]),</span>
            <span class="s1">&#39;thefilm&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;hdrfilm&#39;</span><span class="p">,</span>
                <span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="mi">1024</span><span class="p">,</span>
                <span class="s1">&#39;height&#39;</span><span class="p">:</span> <span class="mi">768</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s1">&#39;thesampler&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;multijitter&#39;</span><span class="p">,</span>
                <span class="s1">&#39;sample_count&#39;</span><span class="p">:</span> <span class="mi">64</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">},</span>
        <span class="s1">&#39;themesh&#39;</span><span class="p">:</span> <span class="n">mesh</span><span class="p">,</span>
    <span class="p">})</span>

    <span class="n">img</span> <span class="o">=</span> <span class="n">mi</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">scene</span><span class="p">,</span> <span class="n">spp</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">img</span>


<span class="c1"># Default to LLVM variant which should be available on all</span>
<span class="c1"># platforms. If you have a system with a CUDA device then comment out LLVM</span>
<span class="c1"># variant and uncomment cuda variant</span>
<span class="n">mi</span><span class="o">.</span><span class="n">set_variant</span><span class="p">(</span><span class="s1">&#39;llvm_ad_rgb&#39;</span><span class="p">)</span>
<span class="c1"># mi.set_variant(&#39;cuda_ad_rgb&#39;)</span>

<span class="c1"># Load mesh and maps using Open3D</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">MonkeyModel</span><span class="p">()</span>
<span class="n">mesh</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_triangle_mesh</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
<span class="n">mesh_center</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">get_axis_aligned_bounding_box</span><span class="p">()</span><span class="o">.</span><span class="n">get_center</span><span class="p">()</span>
<span class="n">mesh</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">set_default_properties</span><span class="p">()</span>
<span class="n">mesh</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">material_name</span> <span class="o">=</span> <span class="s1">&#39;defaultLit&#39;</span>
<span class="n">mesh</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">scalar_properties</span><span class="p">[</span><span class="s1">&#39;metallic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">mesh</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">texture_maps</span><span class="p">[</span><span class="s1">&#39;albedo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_image</span><span class="p">(</span>
    <span class="n">dataset</span><span class="o">.</span><span class="n">path_map</span><span class="p">[</span><span class="s1">&#39;albedo&#39;</span><span class="p">])</span>
<span class="n">mesh</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">texture_maps</span><span class="p">[</span><span class="s1">&#39;roughness&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_image</span><span class="p">(</span>
    <span class="n">dataset</span><span class="o">.</span><span class="n">path_map</span><span class="p">[</span><span class="s1">&#39;roughness&#39;</span><span class="p">])</span>
<span class="n">mesh</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">texture_maps</span><span class="p">[</span><span class="s1">&#39;metallic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_image</span><span class="p">(</span>
    <span class="n">dataset</span><span class="o">.</span><span class="n">path_map</span><span class="p">[</span><span class="s1">&#39;metallic&#39;</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Render mesh with material converted to Mitsuba principled BSDF&#39;</span><span class="p">)</span>
<span class="n">mi_mesh</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">to_mitsuba</span><span class="p">(</span><span class="s1">&#39;monkey&#39;</span><span class="p">)</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">render_mesh</span><span class="p">(</span><span class="n">mi_mesh</span><span class="p">,</span> <span class="n">mesh_center</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
<span class="n">mi</span><span class="o">.</span><span class="n">Bitmap</span><span class="p">(</span><span class="n">img</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;test.exr&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Render mesh with normal-mapped prnincipled BSDF&#39;</span><span class="p">)</span>
<span class="n">mesh</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">texture_maps</span><span class="p">[</span><span class="s1">&#39;normal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_image</span><span class="p">(</span>
    <span class="n">dataset</span><span class="o">.</span><span class="n">path_map</span><span class="p">[</span><span class="s1">&#39;normal&#39;</span><span class="p">])</span>
<span class="n">mi_mesh</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">to_mitsuba</span><span class="p">(</span><span class="s1">&#39;monkey&#39;</span><span class="p">)</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">render_mesh</span><span class="p">(</span><span class="n">mi_mesh</span><span class="p">,</span> <span class="n">mesh_center</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
<span class="n">mi</span><span class="o">.</span><span class="n">Bitmap</span><span class="p">(</span><span class="n">img</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;test2.exr&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Rendering mesh with Mitsuba smooth plastic BSDF&#39;</span><span class="p">)</span>
<span class="n">bsdf_smooth_plastic</span> <span class="o">=</span> <span class="n">mi</span><span class="o">.</span><span class="n">load_dict</span><span class="p">({</span>
    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;plastic&#39;</span><span class="p">,</span>
    <span class="s1">&#39;diffuse_reflectance&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;rgb&#39;</span><span class="p">,</span>
        <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.27</span><span class="p">,</span> <span class="mf">0.36</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="s1">&#39;int_ior&#39;</span><span class="p">:</span> <span class="mf">1.9</span>
<span class="p">})</span>
<span class="n">mi_mesh</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">to_mitsuba</span><span class="p">(</span><span class="s1">&#39;monkey&#39;</span><span class="p">,</span> <span class="n">bsdf</span><span class="o">=</span><span class="n">bsdf_smooth_plastic</span><span class="p">)</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">render_mesh</span><span class="p">(</span><span class="n">mi_mesh</span><span class="p">,</span> <span class="n">mesh_center</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
<span class="n">mi</span><span class="o">.</span><span class="n">Bitmap</span><span class="p">(</span><span class="n">img</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;test3.exr&#39;</span><span class="p">)</span>

<span class="c1"># Render with Open3D</span>
<span class="n">o3d</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">mesh</span><span class="p">)</span>
</pre></div></td></tr></table></div>
</div>
</div>
<div class="section" id="video-py">
<h2>video.py<a class="headerlink" href="#video-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span></pre></div></td><td class="code"><div><pre><span></span><span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># -                        Open3D: www.open3d.org                            -</span>
<span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># Copyright (c) 2018-2023 www.open3d.org</span>
<span class="c1"># SPDX-License-Identifier: MIT</span>
<span class="c1"># ----------------------------------------------------------------------------</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">open3d</span> <span class="k">as</span> <span class="nn">o3d</span>
<span class="kn">import</span> <span class="nn">open3d.visualization.gui</span> <span class="k">as</span> <span class="nn">gui</span>
<span class="kn">import</span> <span class="nn">open3d.visualization.rendering</span> <span class="k">as</span> <span class="nn">rendering</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">threading</span>


<span class="k">def</span> <span class="nf">rescale_greyscale</span><span class="p">(</span><span class="n">img</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
    <span class="k">assert</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># requires 1 channel image</span>
    <span class="n">dataFloat</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    <span class="n">max_val</span> <span class="o">=</span> <span class="n">dataFloat</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="c1"># We don&#39;t currently support 16-bit images, so convert to 8-bit</span>
    <span class="n">dataFloat</span> <span class="o">*=</span> <span class="mf">255.0</span> <span class="o">/</span> <span class="n">max_val</span>
    <span class="n">data8</span> <span class="o">=</span> <span class="n">dataFloat</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="n">data8</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">VideoWindow</span><span class="p">:</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rgb_images</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">rgbd_data</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">SampleRedwoodRGBDImages</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">rgbd_data</span><span class="o">.</span><span class="n">color_paths</span><span class="p">:</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_image</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rgb_images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depth_images</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">rgbd_data</span><span class="o">.</span><span class="n">depth_paths</span><span class="p">:</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_image</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="c1"># The images are pretty dark, so rescale them so that it is</span>
            <span class="c1"># obvious that this is a depth image, for the sake of the example</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">rescale_greyscale</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">depth_images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
        <span class="k">assert</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rgb_images</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">depth_images</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">window</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Application</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">create_window</span><span class="p">(</span>
            <span class="s2">&quot;Open3D - Video Example&quot;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">set_on_layout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_layout</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">set_on_close</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_close</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">widget3d</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">SceneWidget</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">widget3d</span><span class="o">.</span><span class="n">scene</span> <span class="o">=</span> <span class="n">rendering</span><span class="o">.</span><span class="n">Open3DScene</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">renderer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">widget3d</span><span class="p">)</span>

        <span class="n">lit</span> <span class="o">=</span> <span class="n">rendering</span><span class="o">.</span><span class="n">MaterialRecord</span><span class="p">()</span>
        <span class="n">lit</span><span class="o">.</span><span class="n">shader</span> <span class="o">=</span> <span class="s2">&quot;defaultLit&quot;</span>
        <span class="n">tet</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">TriangleMesh</span><span class="o">.</span><span class="n">create_tetrahedron</span><span class="p">()</span>
        <span class="n">tet</span><span class="o">.</span><span class="n">compute_vertex_normals</span><span class="p">()</span>
        <span class="n">tet</span><span class="o">.</span><span class="n">paint_uniform_color</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">widget3d</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">add_geometry</span><span class="p">(</span><span class="s2">&quot;tetrahedron&quot;</span><span class="p">,</span> <span class="n">tet</span><span class="p">,</span> <span class="n">lit</span><span class="p">)</span>
        <span class="n">bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">widget3d</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">bounding_box</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">widget3d</span><span class="o">.</span><span class="n">setup_camera</span><span class="p">(</span><span class="mf">60.0</span><span class="p">,</span> <span class="n">bounds</span><span class="p">,</span> <span class="n">bounds</span><span class="o">.</span><span class="n">get_center</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">widget3d</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">show_axes</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">em</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">theme</span><span class="o">.</span><span class="n">font_size</span>
        <span class="n">margin</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">em</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">panel</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Vert</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">em</span><span class="p">,</span> <span class="n">gui</span><span class="o">.</span><span class="n">Margins</span><span class="p">(</span><span class="n">margin</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="s2">&quot;Color image&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rgb_widget</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">ImageWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rgb_images</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rgb_widget</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="s2">&quot;Depth image (normalized)&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depth_widget</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">ImageWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">depth_images</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">depth_widget</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">is_done</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_update_thread</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_on_layout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layout_context</span><span class="p">):</span>
        <span class="n">contentRect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">content_rect</span>
        <span class="n">panel_width</span> <span class="o">=</span> <span class="mi">15</span> <span class="o">*</span> <span class="n">layout_context</span><span class="o">.</span><span class="n">theme</span><span class="o">.</span><span class="n">font_size</span>  <span class="c1"># 15 ems wide</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">widget3d</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Rect</span><span class="p">(</span><span class="n">contentRect</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">contentRect</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
                                       <span class="n">contentRect</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="n">panel_width</span><span class="p">,</span>
                                       <span class="n">contentRect</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Rect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">widget3d</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">get_right</span><span class="p">(),</span>
                                    <span class="n">contentRect</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">panel_width</span><span class="p">,</span>
                                    <span class="n">contentRect</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_on_close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_done</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">True</span>  <span class="c1"># False would cancel the close</span>

    <span class="k">def</span> <span class="nf">_update_thread</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># This is NOT the UI thread, need to call post_to_main_thread() to update</span>
        <span class="c1"># the scene or any part of the UI.</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_done</span><span class="p">:</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.100</span><span class="p">)</span>

            <span class="c1"># Get the next frame, for instance, reading a frame from the camera.</span>
            <span class="n">rgb_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rgb_images</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            <span class="n">depth_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth_images</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            <span class="n">idx</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">idx</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rgb_images</span><span class="p">):</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="c1"># Update the images. This must be done on the UI thread.</span>
            <span class="k">def</span> <span class="nf">update</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rgb_widget</span><span class="o">.</span><span class="n">update_image</span><span class="p">(</span><span class="n">rgb_frame</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">depth_widget</span><span class="o">.</span><span class="n">update_image</span><span class="p">(</span><span class="n">depth_frame</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">widget3d</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">set_background</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">rgb_frame</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_done</span><span class="p">:</span>
                <span class="n">gui</span><span class="o">.</span><span class="n">Application</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">post_to_main_thread</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="p">,</span> <span class="n">update</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">Application</span><span class="o">.</span><span class="n">instance</span>
    <span class="n">app</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>

    <span class="n">win</span> <span class="o">=</span> <span class="n">VideoWindow</span><span class="p">()</span>

    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div></td></tr></table></div>
</div>
</div>
<div class="section" id="vis-gui-py">
<h2>vis_gui.py<a class="headerlink" href="#vis-gui-py" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span></pre></div></td><td class="code"><div><pre><span></span><span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># -                        Open3D: www.open3d.org                            -</span>
<span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># Copyright (c) 2018-2023 www.open3d.org</span>
<span class="c1"># SPDX-License-Identifier: MIT</span>
<span class="c1"># ----------------------------------------------------------------------------</span>

<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">open3d</span> <span class="k">as</span> <span class="nn">o3d</span>
<span class="kn">import</span> <span class="nn">open3d.visualization.gui</span> <span class="k">as</span> <span class="nn">gui</span>
<span class="kn">import</span> <span class="nn">open3d.visualization.rendering</span> <span class="k">as</span> <span class="nn">rendering</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">platform</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">isMacOS</span> <span class="o">=</span> <span class="p">(</span><span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Darwin&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Settings</span><span class="p">:</span>
    <span class="n">UNLIT</span> <span class="o">=</span> <span class="s2">&quot;defaultUnlit&quot;</span>
    <span class="n">LIT</span> <span class="o">=</span> <span class="s2">&quot;defaultLit&quot;</span>
    <span class="n">NORMALS</span> <span class="o">=</span> <span class="s2">&quot;normals&quot;</span>
    <span class="n">DEPTH</span> <span class="o">=</span> <span class="s2">&quot;depth&quot;</span>

    <span class="n">DEFAULT_PROFILE_NAME</span> <span class="o">=</span> <span class="s2">&quot;Bright day with sun at +Y [default]&quot;</span>
    <span class="n">POINT_CLOUD_PROFILE_NAME</span> <span class="o">=</span> <span class="s2">&quot;Cloudy day (no direct sun)&quot;</span>
    <span class="n">CUSTOM_PROFILE_NAME</span> <span class="o">=</span> <span class="s2">&quot;Custom&quot;</span>
    <span class="n">LIGHTING_PROFILES</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">DEFAULT_PROFILE_NAME</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;ibl_intensity&quot;</span><span class="p">:</span> <span class="mi">45000</span><span class="p">,</span>
            <span class="s2">&quot;sun_intensity&quot;</span><span class="p">:</span> <span class="mi">45000</span><span class="p">,</span>
            <span class="s2">&quot;sun_dir&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.577</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.577</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.577</span><span class="p">],</span>
            <span class="c1"># &quot;ibl_rotation&quot;:</span>
            <span class="s2">&quot;use_ibl&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;use_sun&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;Bright day with sun at -Y&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;ibl_intensity&quot;</span><span class="p">:</span> <span class="mi">45000</span><span class="p">,</span>
            <span class="s2">&quot;sun_intensity&quot;</span><span class="p">:</span> <span class="mi">45000</span><span class="p">,</span>
            <span class="s2">&quot;sun_dir&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.577</span><span class="p">,</span> <span class="mf">0.577</span><span class="p">,</span> <span class="mf">0.577</span><span class="p">],</span>
            <span class="c1"># &quot;ibl_rotation&quot;:</span>
            <span class="s2">&quot;use_ibl&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;use_sun&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;Bright day with sun at +Z&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;ibl_intensity&quot;</span><span class="p">:</span> <span class="mi">45000</span><span class="p">,</span>
            <span class="s2">&quot;sun_intensity&quot;</span><span class="p">:</span> <span class="mi">45000</span><span class="p">,</span>
            <span class="s2">&quot;sun_dir&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.577</span><span class="p">,</span> <span class="mf">0.577</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.577</span><span class="p">],</span>
            <span class="c1"># &quot;ibl_rotation&quot;:</span>
            <span class="s2">&quot;use_ibl&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;use_sun&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;Less Bright day with sun at +Y&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;ibl_intensity&quot;</span><span class="p">:</span> <span class="mi">35000</span><span class="p">,</span>
            <span class="s2">&quot;sun_intensity&quot;</span><span class="p">:</span> <span class="mi">50000</span><span class="p">,</span>
            <span class="s2">&quot;sun_dir&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.577</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.577</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.577</span><span class="p">],</span>
            <span class="c1"># &quot;ibl_rotation&quot;:</span>
            <span class="s2">&quot;use_ibl&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;use_sun&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;Less Bright day with sun at -Y&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;ibl_intensity&quot;</span><span class="p">:</span> <span class="mi">35000</span><span class="p">,</span>
            <span class="s2">&quot;sun_intensity&quot;</span><span class="p">:</span> <span class="mi">50000</span><span class="p">,</span>
            <span class="s2">&quot;sun_dir&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.577</span><span class="p">,</span> <span class="mf">0.577</span><span class="p">,</span> <span class="mf">0.577</span><span class="p">],</span>
            <span class="c1"># &quot;ibl_rotation&quot;:</span>
            <span class="s2">&quot;use_ibl&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;use_sun&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;Less Bright day with sun at +Z&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;ibl_intensity&quot;</span><span class="p">:</span> <span class="mi">35000</span><span class="p">,</span>
            <span class="s2">&quot;sun_intensity&quot;</span><span class="p">:</span> <span class="mi">50000</span><span class="p">,</span>
            <span class="s2">&quot;sun_dir&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.577</span><span class="p">,</span> <span class="mf">0.577</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.577</span><span class="p">],</span>
            <span class="c1"># &quot;ibl_rotation&quot;:</span>
            <span class="s2">&quot;use_ibl&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;use_sun&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="n">POINT_CLOUD_PROFILE_NAME</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;ibl_intensity&quot;</span><span class="p">:</span> <span class="mi">60000</span><span class="p">,</span>
            <span class="s2">&quot;sun_intensity&quot;</span><span class="p">:</span> <span class="mi">50000</span><span class="p">,</span>
            <span class="s2">&quot;use_ibl&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;use_sun&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="c1"># &quot;ibl_rotation&quot;:</span>
        <span class="p">},</span>
    <span class="p">}</span>

    <span class="n">DEFAULT_MATERIAL_NAME</span> <span class="o">=</span> <span class="s2">&quot;Polished ceramic [default]&quot;</span>
    <span class="n">PREFAB</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">DEFAULT_MATERIAL_NAME</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;metallic&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="s2">&quot;roughness&quot;</span><span class="p">:</span> <span class="mf">0.7</span><span class="p">,</span>
            <span class="s2">&quot;reflectance&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
            <span class="s2">&quot;clearcoat&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span>
            <span class="s2">&quot;clearcoat_roughness&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span>
            <span class="s2">&quot;anisotropy&quot;</span><span class="p">:</span> <span class="mf">0.0</span>
        <span class="p">},</span>
        <span class="s2">&quot;Metal (rougher)&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;metallic&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
            <span class="s2">&quot;roughness&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
            <span class="s2">&quot;reflectance&quot;</span><span class="p">:</span> <span class="mf">0.9</span><span class="p">,</span>
            <span class="s2">&quot;clearcoat&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="s2">&quot;clearcoat_roughness&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="s2">&quot;anisotropy&quot;</span><span class="p">:</span> <span class="mf">0.0</span>
        <span class="p">},</span>
        <span class="s2">&quot;Metal (smoother)&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;metallic&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
            <span class="s2">&quot;roughness&quot;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span>
            <span class="s2">&quot;reflectance&quot;</span><span class="p">:</span> <span class="mf">0.9</span><span class="p">,</span>
            <span class="s2">&quot;clearcoat&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="s2">&quot;clearcoat_roughness&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="s2">&quot;anisotropy&quot;</span><span class="p">:</span> <span class="mf">0.0</span>
        <span class="p">},</span>
        <span class="s2">&quot;Plastic&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;metallic&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="s2">&quot;roughness&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
            <span class="s2">&quot;reflectance&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
            <span class="s2">&quot;clearcoat&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
            <span class="s2">&quot;clearcoat_roughness&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span>
            <span class="s2">&quot;anisotropy&quot;</span><span class="p">:</span> <span class="mf">0.0</span>
        <span class="p">},</span>
        <span class="s2">&quot;Glazed ceramic&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;metallic&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="s2">&quot;roughness&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
            <span class="s2">&quot;reflectance&quot;</span><span class="p">:</span> <span class="mf">0.9</span><span class="p">,</span>
            <span class="s2">&quot;clearcoat&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
            <span class="s2">&quot;clearcoat_roughness&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
            <span class="s2">&quot;anisotropy&quot;</span><span class="p">:</span> <span class="mf">0.0</span>
        <span class="p">},</span>
        <span class="s2">&quot;Clay&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;metallic&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="s2">&quot;roughness&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
            <span class="s2">&quot;reflectance&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
            <span class="s2">&quot;clearcoat&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
            <span class="s2">&quot;clearcoat_roughness&quot;</span><span class="p">:</span> <span class="mf">0.287</span><span class="p">,</span>
            <span class="s2">&quot;anisotropy&quot;</span><span class="p">:</span> <span class="mf">0.0</span>
        <span class="p">},</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mouse_model</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">SceneWidget</span><span class="o">.</span><span class="n">Controls</span><span class="o">.</span><span class="n">ROTATE_CAMERA</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bg_color</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_skybox</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_axes</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_ibl</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_sun</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new_ibl_name</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># clear to None after loading</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ibl_intensity</span> <span class="o">=</span> <span class="mi">45000</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sun_intensity</span> <span class="o">=</span> <span class="mi">45000</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sun_dir</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.577</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.577</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.577</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sun_color</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">apply_material</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># clear to False after processing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_materials</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">Settings</span><span class="o">.</span><span class="n">LIT</span><span class="p">:</span> <span class="n">rendering</span><span class="o">.</span><span class="n">MaterialRecord</span><span class="p">(),</span>
            <span class="n">Settings</span><span class="o">.</span><span class="n">UNLIT</span><span class="p">:</span> <span class="n">rendering</span><span class="o">.</span><span class="n">MaterialRecord</span><span class="p">(),</span>
            <span class="n">Settings</span><span class="o">.</span><span class="n">NORMALS</span><span class="p">:</span> <span class="n">rendering</span><span class="o">.</span><span class="n">MaterialRecord</span><span class="p">(),</span>
            <span class="n">Settings</span><span class="o">.</span><span class="n">DEPTH</span><span class="p">:</span> <span class="n">rendering</span><span class="o">.</span><span class="n">MaterialRecord</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_materials</span><span class="p">[</span><span class="n">Settings</span><span class="o">.</span><span class="n">LIT</span><span class="p">]</span><span class="o">.</span><span class="n">base_color</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_materials</span><span class="p">[</span><span class="n">Settings</span><span class="o">.</span><span class="n">LIT</span><span class="p">]</span><span class="o">.</span><span class="n">shader</span> <span class="o">=</span> <span class="n">Settings</span><span class="o">.</span><span class="n">LIT</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_materials</span><span class="p">[</span><span class="n">Settings</span><span class="o">.</span><span class="n">UNLIT</span><span class="p">]</span><span class="o">.</span><span class="n">base_color</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_materials</span><span class="p">[</span><span class="n">Settings</span><span class="o">.</span><span class="n">UNLIT</span><span class="p">]</span><span class="o">.</span><span class="n">shader</span> <span class="o">=</span> <span class="n">Settings</span><span class="o">.</span><span class="n">UNLIT</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_materials</span><span class="p">[</span><span class="n">Settings</span><span class="o">.</span><span class="n">NORMALS</span><span class="p">]</span><span class="o">.</span><span class="n">shader</span> <span class="o">=</span> <span class="n">Settings</span><span class="o">.</span><span class="n">NORMALS</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_materials</span><span class="p">[</span><span class="n">Settings</span><span class="o">.</span><span class="n">DEPTH</span><span class="p">]</span><span class="o">.</span><span class="n">shader</span> <span class="o">=</span> <span class="n">Settings</span><span class="o">.</span><span class="n">DEPTH</span>

        <span class="c1"># Conveniently, assigning from self._materials[...] assigns a reference,</span>
        <span class="c1"># not a copy, so if we change the property of a material, then switch</span>
        <span class="c1"># to another one, then come back, the old setting will still be there.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">material</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_materials</span><span class="p">[</span><span class="n">Settings</span><span class="o">.</span><span class="n">LIT</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">set_material</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">material</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_materials</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">apply_material</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">apply_material_prefab</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">assert</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">shader</span> <span class="o">==</span> <span class="n">Settings</span><span class="o">.</span><span class="n">LIT</span><span class="p">)</span>
        <span class="n">prefab</span> <span class="o">=</span> <span class="n">Settings</span><span class="o">.</span><span class="n">PREFAB</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">prefab</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">material</span><span class="p">,</span> <span class="s2">&quot;base_&quot;</span> <span class="o">+</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">apply_lighting_profile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="n">profile</span> <span class="o">=</span> <span class="n">Settings</span><span class="o">.</span><span class="n">LIGHTING_PROFILES</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">profile</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">AppWindow</span><span class="p">:</span>
    <span class="n">MENU_OPEN</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">MENU_EXPORT</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">MENU_QUIT</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">MENU_SHOW_SETTINGS</span> <span class="o">=</span> <span class="mi">11</span>
    <span class="n">MENU_ABOUT</span> <span class="o">=</span> <span class="mi">21</span>

    <span class="n">DEFAULT_IBL</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span>

    <span class="n">MATERIAL_NAMES</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Lit&quot;</span><span class="p">,</span> <span class="s2">&quot;Unlit&quot;</span><span class="p">,</span> <span class="s2">&quot;Normals&quot;</span><span class="p">,</span> <span class="s2">&quot;Depth&quot;</span><span class="p">]</span>
    <span class="n">MATERIAL_SHADERS</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">Settings</span><span class="o">.</span><span class="n">LIT</span><span class="p">,</span> <span class="n">Settings</span><span class="o">.</span><span class="n">UNLIT</span><span class="p">,</span> <span class="n">Settings</span><span class="o">.</span><span class="n">NORMALS</span><span class="p">,</span> <span class="n">Settings</span><span class="o">.</span><span class="n">DEPTH</span>
    <span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span> <span class="o">=</span> <span class="n">Settings</span><span class="p">()</span>
        <span class="n">resource_path</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Application</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">resource_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">new_ibl_name</span> <span class="o">=</span> <span class="n">resource_path</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">AppWindow</span><span class="o">.</span><span class="n">DEFAULT_IBL</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">window</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Application</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">create_window</span><span class="p">(</span>
            <span class="s2">&quot;Open3D&quot;</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>
        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">window</span>  <span class="c1"># to make the code more concise</span>

        <span class="c1"># 3D widget</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scene</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">SceneWidget</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scene</span><span class="o">.</span><span class="n">scene</span> <span class="o">=</span> <span class="n">rendering</span><span class="o">.</span><span class="n">Open3DScene</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">renderer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scene</span><span class="o">.</span><span class="n">set_on_sun_direction_changed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_sun_dir</span><span class="p">)</span>

        <span class="c1"># ---- Settings panel ----</span>
        <span class="c1"># Rather than specifying sizes in pixels, which may vary in size based</span>
        <span class="c1"># on the monitor, especially on macOS which has 220 dpi monitors, use</span>
        <span class="c1"># the em-size. This way sizings will be proportional to the font size,</span>
        <span class="c1"># which will create a more visually consistent size across platforms.</span>
        <span class="n">em</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">theme</span><span class="o">.</span><span class="n">font_size</span>
        <span class="n">separation_height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">em</span><span class="p">))</span>

        <span class="c1"># Widgets are laid out in layouts: gui.Horiz, gui.Vert,</span>
        <span class="c1"># gui.CollapsableVert, and gui.VGrid. By nesting the layouts we can</span>
        <span class="c1"># achieve complex designs. Usually we use a vertical layout as the</span>
        <span class="c1"># topmost widget, since widgets tend to be organized from top to bottom.</span>
        <span class="c1"># Within that, we usually have a series of horizontal layouts for each</span>
        <span class="c1"># row. All layouts take a spacing parameter, which is the spacing</span>
        <span class="c1"># between items in the widget, and a margins parameter, which specifies</span>
        <span class="c1"># the spacing of the left, top, right, bottom margins. (This acts like</span>
        <span class="c1"># the &#39;padding&#39; property in CSS.)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_settings_panel</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Vert</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span> <span class="n">gui</span><span class="o">.</span><span class="n">Margins</span><span class="p">(</span><span class="mf">0.25</span> <span class="o">*</span> <span class="n">em</span><span class="p">,</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="n">em</span><span class="p">,</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="n">em</span><span class="p">,</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="n">em</span><span class="p">))</span>

        <span class="c1"># Create a collapsible vertical widget, which takes up enough vertical</span>
        <span class="c1"># space for all its children when open, but only enough for text when</span>
        <span class="c1"># closed. This is useful for property pages, so the user can hide sets</span>
        <span class="c1"># of properties they rarely use.</span>
        <span class="n">view_ctrls</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">CollapsableVert</span><span class="p">(</span><span class="s2">&quot;View controls&quot;</span><span class="p">,</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="n">em</span><span class="p">,</span>
                                         <span class="n">gui</span><span class="o">.</span><span class="n">Margins</span><span class="p">(</span><span class="n">em</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_arcball_button</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="s2">&quot;Arcball&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_arcball_button</span><span class="o">.</span><span class="n">horizontal_padding_em</span> <span class="o">=</span> <span class="mf">0.5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_arcball_button</span><span class="o">.</span><span class="n">vertical_padding_em</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_arcball_button</span><span class="o">.</span><span class="n">set_on_clicked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_set_mouse_mode_rotate</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fly_button</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="s2">&quot;Fly&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fly_button</span><span class="o">.</span><span class="n">horizontal_padding_em</span> <span class="o">=</span> <span class="mf">0.5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fly_button</span><span class="o">.</span><span class="n">vertical_padding_em</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fly_button</span><span class="o">.</span><span class="n">set_on_clicked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_set_mouse_mode_fly</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_model_button</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="s2">&quot;Model&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_model_button</span><span class="o">.</span><span class="n">horizontal_padding_em</span> <span class="o">=</span> <span class="mf">0.5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_model_button</span><span class="o">.</span><span class="n">vertical_padding_em</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_model_button</span><span class="o">.</span><span class="n">set_on_clicked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_set_mouse_mode_model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sun_button</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="s2">&quot;Sun&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sun_button</span><span class="o">.</span><span class="n">horizontal_padding_em</span> <span class="o">=</span> <span class="mf">0.5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sun_button</span><span class="o">.</span><span class="n">vertical_padding_em</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sun_button</span><span class="o">.</span><span class="n">set_on_clicked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_set_mouse_mode_sun</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ibl_button</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="s2">&quot;Environment&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ibl_button</span><span class="o">.</span><span class="n">horizontal_padding_em</span> <span class="o">=</span> <span class="mf">0.5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ibl_button</span><span class="o">.</span><span class="n">vertical_padding_em</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ibl_button</span><span class="o">.</span><span class="n">set_on_clicked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_set_mouse_mode_ibl</span><span class="p">)</span>
        <span class="n">view_ctrls</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="s2">&quot;Mouse controls&quot;</span><span class="p">))</span>
        <span class="c1"># We want two rows of buttons, so make two horizontal layouts. We also</span>
        <span class="c1"># want the buttons centered, which we can do be putting a stretch item</span>
        <span class="c1"># as the first and last item. Stretch items take up as much space as</span>
        <span class="c1"># possible, and since there are two, they will each take half the extra</span>
        <span class="c1"># space, thus centering the buttons.</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Horiz</span><span class="p">(</span><span class="mf">0.25</span> <span class="o">*</span> <span class="n">em</span><span class="p">)</span>  <span class="c1"># row 1</span>
        <span class="n">h</span><span class="o">.</span><span class="n">add_stretch</span><span class="p">()</span>
        <span class="n">h</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_arcball_button</span><span class="p">)</span>
        <span class="n">h</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fly_button</span><span class="p">)</span>
        <span class="n">h</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model_button</span><span class="p">)</span>
        <span class="n">h</span><span class="o">.</span><span class="n">add_stretch</span><span class="p">()</span>
        <span class="n">view_ctrls</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Horiz</span><span class="p">(</span><span class="mf">0.25</span> <span class="o">*</span> <span class="n">em</span><span class="p">)</span>  <span class="c1"># row 2</span>
        <span class="n">h</span><span class="o">.</span><span class="n">add_stretch</span><span class="p">()</span>
        <span class="n">h</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sun_button</span><span class="p">)</span>
        <span class="n">h</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ibl_button</span><span class="p">)</span>
        <span class="n">h</span><span class="o">.</span><span class="n">add_stretch</span><span class="p">()</span>
        <span class="n">view_ctrls</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_show_skybox</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Checkbox</span><span class="p">(</span><span class="s2">&quot;Show skymap&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_show_skybox</span><span class="o">.</span><span class="n">set_on_checked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_show_skybox</span><span class="p">)</span>
        <span class="n">view_ctrls</span><span class="o">.</span><span class="n">add_fixed</span><span class="p">(</span><span class="n">separation_height</span><span class="p">)</span>
        <span class="n">view_ctrls</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_show_skybox</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_bg_color</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">ColorEdit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bg_color</span><span class="o">.</span><span class="n">set_on_value_changed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_bg_color</span><span class="p">)</span>

        <span class="n">grid</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">VGrid</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="n">em</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="s2">&quot;BG Color&quot;</span><span class="p">))</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bg_color</span><span class="p">)</span>
        <span class="n">view_ctrls</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_show_axes</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Checkbox</span><span class="p">(</span><span class="s2">&quot;Show axes&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_show_axes</span><span class="o">.</span><span class="n">set_on_checked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_show_axes</span><span class="p">)</span>
        <span class="n">view_ctrls</span><span class="o">.</span><span class="n">add_fixed</span><span class="p">(</span><span class="n">separation_height</span><span class="p">)</span>
        <span class="n">view_ctrls</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_show_axes</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_profiles</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Combobox</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">Settings</span><span class="o">.</span><span class="n">LIGHTING_PROFILES</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_profiles</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_profiles</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="n">Settings</span><span class="o">.</span><span class="n">CUSTOM_PROFILE_NAME</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_profiles</span><span class="o">.</span><span class="n">set_on_selection_changed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_lighting_profile</span><span class="p">)</span>
        <span class="n">view_ctrls</span><span class="o">.</span><span class="n">add_fixed</span><span class="p">(</span><span class="n">separation_height</span><span class="p">)</span>
        <span class="n">view_ctrls</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="s2">&quot;Lighting profiles&quot;</span><span class="p">))</span>
        <span class="n">view_ctrls</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_profiles</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_settings_panel</span><span class="o">.</span><span class="n">add_fixed</span><span class="p">(</span><span class="n">separation_height</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_settings_panel</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">view_ctrls</span><span class="p">)</span>

        <span class="n">advanced</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">CollapsableVert</span><span class="p">(</span><span class="s2">&quot;Advanced lighting&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                       <span class="n">gui</span><span class="o">.</span><span class="n">Margins</span><span class="p">(</span><span class="n">em</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="n">advanced</span><span class="o">.</span><span class="n">set_is_open</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_use_ibl</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Checkbox</span><span class="p">(</span><span class="s2">&quot;HDR map&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_use_ibl</span><span class="o">.</span><span class="n">set_on_checked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_use_ibl</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_use_sun</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Checkbox</span><span class="p">(</span><span class="s2">&quot;Sun&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_use_sun</span><span class="o">.</span><span class="n">set_on_checked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_use_sun</span><span class="p">)</span>
        <span class="n">advanced</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="s2">&quot;Light sources&quot;</span><span class="p">))</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Horiz</span><span class="p">(</span><span class="n">em</span><span class="p">)</span>
        <span class="n">h</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_use_ibl</span><span class="p">)</span>
        <span class="n">h</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_use_sun</span><span class="p">)</span>
        <span class="n">advanced</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_ibl_map</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Combobox</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">ibl</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">Application</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">resource_path</span> <span class="o">+</span>
                             <span class="s2">&quot;/*_ibl.ktx&quot;</span><span class="p">):</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_ibl_map</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">ibl</span><span class="p">[:</span><span class="o">-</span><span class="mi">8</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ibl_map</span><span class="o">.</span><span class="n">selected_text</span> <span class="o">=</span> <span class="n">AppWindow</span><span class="o">.</span><span class="n">DEFAULT_IBL</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ibl_map</span><span class="o">.</span><span class="n">set_on_selection_changed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_new_ibl</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ibl_intensity</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Slider</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">Slider</span><span class="o">.</span><span class="n">INT</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ibl_intensity</span><span class="o">.</span><span class="n">set_limits</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">200000</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ibl_intensity</span><span class="o">.</span><span class="n">set_on_value_changed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_ibl_intensity</span><span class="p">)</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">VGrid</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="n">em</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="s2">&quot;HDR map&quot;</span><span class="p">))</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ibl_map</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="s2">&quot;Intensity&quot;</span><span class="p">))</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ibl_intensity</span><span class="p">)</span>
        <span class="n">advanced</span><span class="o">.</span><span class="n">add_fixed</span><span class="p">(</span><span class="n">separation_height</span><span class="p">)</span>
        <span class="n">advanced</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="s2">&quot;Environment&quot;</span><span class="p">))</span>
        <span class="n">advanced</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_sun_intensity</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Slider</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">Slider</span><span class="o">.</span><span class="n">INT</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sun_intensity</span><span class="o">.</span><span class="n">set_limits</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">200000</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sun_intensity</span><span class="o">.</span><span class="n">set_on_value_changed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_sun_intensity</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sun_dir</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">VectorEdit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sun_dir</span><span class="o">.</span><span class="n">set_on_value_changed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_sun_dir</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sun_color</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">ColorEdit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sun_color</span><span class="o">.</span><span class="n">set_on_value_changed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_sun_color</span><span class="p">)</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">VGrid</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="n">em</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="s2">&quot;Intensity&quot;</span><span class="p">))</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sun_intensity</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="s2">&quot;Direction&quot;</span><span class="p">))</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sun_dir</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="s2">&quot;Color&quot;</span><span class="p">))</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sun_color</span><span class="p">)</span>
        <span class="n">advanced</span><span class="o">.</span><span class="n">add_fixed</span><span class="p">(</span><span class="n">separation_height</span><span class="p">)</span>
        <span class="n">advanced</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="s2">&quot;Sun (Directional light)&quot;</span><span class="p">))</span>
        <span class="n">advanced</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_settings_panel</span><span class="o">.</span><span class="n">add_fixed</span><span class="p">(</span><span class="n">separation_height</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_settings_panel</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">advanced</span><span class="p">)</span>

        <span class="n">material_settings</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">CollapsableVert</span><span class="p">(</span><span class="s2">&quot;Material settings&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                                <span class="n">gui</span><span class="o">.</span><span class="n">Margins</span><span class="p">(</span><span class="n">em</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_shader</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Combobox</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_shader</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="n">AppWindow</span><span class="o">.</span><span class="n">MATERIAL_NAMES</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_shader</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="n">AppWindow</span><span class="o">.</span><span class="n">MATERIAL_NAMES</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_shader</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="n">AppWindow</span><span class="o">.</span><span class="n">MATERIAL_NAMES</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_shader</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="n">AppWindow</span><span class="o">.</span><span class="n">MATERIAL_NAMES</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_shader</span><span class="o">.</span><span class="n">set_on_selection_changed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_shader</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_material_prefab</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Combobox</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">prefab_name</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">Settings</span><span class="o">.</span><span class="n">PREFAB</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_material_prefab</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="n">prefab_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_material_prefab</span><span class="o">.</span><span class="n">selected_text</span> <span class="o">=</span> <span class="n">Settings</span><span class="o">.</span><span class="n">DEFAULT_MATERIAL_NAME</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_material_prefab</span><span class="o">.</span><span class="n">set_on_selection_changed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_material_prefab</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_material_color</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">ColorEdit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_material_color</span><span class="o">.</span><span class="n">set_on_value_changed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_material_color</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_point_size</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Slider</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">Slider</span><span class="o">.</span><span class="n">INT</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_point_size</span><span class="o">.</span><span class="n">set_limits</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_point_size</span><span class="o">.</span><span class="n">set_on_value_changed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_point_size</span><span class="p">)</span>

        <span class="n">grid</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">VGrid</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="n">em</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="s2">&quot;Type&quot;</span><span class="p">))</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_shader</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="s2">&quot;Material&quot;</span><span class="p">))</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_material_prefab</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="s2">&quot;Color&quot;</span><span class="p">))</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_material_color</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="s2">&quot;Point size&quot;</span><span class="p">))</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_point_size</span><span class="p">)</span>
        <span class="n">material_settings</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_settings_panel</span><span class="o">.</span><span class="n">add_fixed</span><span class="p">(</span><span class="n">separation_height</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_settings_panel</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">material_settings</span><span class="p">)</span>
        <span class="c1"># ----</span>

        <span class="c1"># Normally our user interface can be children of all one layout (usually</span>
        <span class="c1"># a vertical layout), which is then the only child of the window. In our</span>
        <span class="c1"># case we want the scene to take up all the space and the settings panel</span>
        <span class="c1"># to go above it. We can do this custom layout by providing an on_layout</span>
        <span class="c1"># callback. The on_layout callback should set the frame</span>
        <span class="c1"># (position + size) of every child correctly. After the callback is</span>
        <span class="c1"># done the window will layout the grandchildren.</span>
        <span class="n">w</span><span class="o">.</span><span class="n">set_on_layout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_layout</span><span class="p">)</span>
        <span class="n">w</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scene</span><span class="p">)</span>
        <span class="n">w</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_settings_panel</span><span class="p">)</span>

        <span class="c1"># ---- Menu ----</span>
        <span class="c1"># The menu is global (because the macOS menu is global), so only create</span>
        <span class="c1"># it once, no matter how many windows are created</span>
        <span class="k">if</span> <span class="n">gui</span><span class="o">.</span><span class="n">Application</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">menubar</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">isMacOS</span><span class="p">:</span>
                <span class="n">app_menu</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Menu</span><span class="p">()</span>
                <span class="n">app_menu</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="s2">&quot;About&quot;</span><span class="p">,</span> <span class="n">AppWindow</span><span class="o">.</span><span class="n">MENU_ABOUT</span><span class="p">)</span>
                <span class="n">app_menu</span><span class="o">.</span><span class="n">add_separator</span><span class="p">()</span>
                <span class="n">app_menu</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="s2">&quot;Quit&quot;</span><span class="p">,</span> <span class="n">AppWindow</span><span class="o">.</span><span class="n">MENU_QUIT</span><span class="p">)</span>
            <span class="n">file_menu</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Menu</span><span class="p">()</span>
            <span class="n">file_menu</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="s2">&quot;Open...&quot;</span><span class="p">,</span> <span class="n">AppWindow</span><span class="o">.</span><span class="n">MENU_OPEN</span><span class="p">)</span>
            <span class="n">file_menu</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="s2">&quot;Export Current Image...&quot;</span><span class="p">,</span> <span class="n">AppWindow</span><span class="o">.</span><span class="n">MENU_EXPORT</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">isMacOS</span><span class="p">:</span>
                <span class="n">file_menu</span><span class="o">.</span><span class="n">add_separator</span><span class="p">()</span>
                <span class="n">file_menu</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="s2">&quot;Quit&quot;</span><span class="p">,</span> <span class="n">AppWindow</span><span class="o">.</span><span class="n">MENU_QUIT</span><span class="p">)</span>
            <span class="n">settings_menu</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Menu</span><span class="p">()</span>
            <span class="n">settings_menu</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="s2">&quot;Lighting &amp; Materials&quot;</span><span class="p">,</span>
                                   <span class="n">AppWindow</span><span class="o">.</span><span class="n">MENU_SHOW_SETTINGS</span><span class="p">)</span>
            <span class="n">settings_menu</span><span class="o">.</span><span class="n">set_checked</span><span class="p">(</span><span class="n">AppWindow</span><span class="o">.</span><span class="n">MENU_SHOW_SETTINGS</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">help_menu</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Menu</span><span class="p">()</span>
            <span class="n">help_menu</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="s2">&quot;About&quot;</span><span class="p">,</span> <span class="n">AppWindow</span><span class="o">.</span><span class="n">MENU_ABOUT</span><span class="p">)</span>

            <span class="n">menu</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Menu</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">isMacOS</span><span class="p">:</span>
                <span class="c1"># macOS will name the first menu item for the running application</span>
                <span class="c1"># (in our case, probably &quot;Python&quot;), regardless of what we call</span>
                <span class="c1"># it. This is the application menu, and it is where the</span>
                <span class="c1"># About..., Preferences..., and Quit menu items typically go.</span>
                <span class="n">menu</span><span class="o">.</span><span class="n">add_menu</span><span class="p">(</span><span class="s2">&quot;Example&quot;</span><span class="p">,</span> <span class="n">app_menu</span><span class="p">)</span>
                <span class="n">menu</span><span class="o">.</span><span class="n">add_menu</span><span class="p">(</span><span class="s2">&quot;File&quot;</span><span class="p">,</span> <span class="n">file_menu</span><span class="p">)</span>
                <span class="n">menu</span><span class="o">.</span><span class="n">add_menu</span><span class="p">(</span><span class="s2">&quot;Settings&quot;</span><span class="p">,</span> <span class="n">settings_menu</span><span class="p">)</span>
                <span class="c1"># Don&#39;t include help menu unless it has something more than</span>
                <span class="c1"># About...</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">menu</span><span class="o">.</span><span class="n">add_menu</span><span class="p">(</span><span class="s2">&quot;File&quot;</span><span class="p">,</span> <span class="n">file_menu</span><span class="p">)</span>
                <span class="n">menu</span><span class="o">.</span><span class="n">add_menu</span><span class="p">(</span><span class="s2">&quot;Settings&quot;</span><span class="p">,</span> <span class="n">settings_menu</span><span class="p">)</span>
                <span class="n">menu</span><span class="o">.</span><span class="n">add_menu</span><span class="p">(</span><span class="s2">&quot;Help&quot;</span><span class="p">,</span> <span class="n">help_menu</span><span class="p">)</span>
            <span class="n">gui</span><span class="o">.</span><span class="n">Application</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">menubar</span> <span class="o">=</span> <span class="n">menu</span>

        <span class="c1"># The menubar is global, but we need to connect the menu items to the</span>
        <span class="c1"># window, so that the window can call the appropriate function when the</span>
        <span class="c1"># menu item is activated.</span>
        <span class="n">w</span><span class="o">.</span><span class="n">set_on_menu_item_activated</span><span class="p">(</span><span class="n">AppWindow</span><span class="o">.</span><span class="n">MENU_OPEN</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_on_menu_open</span><span class="p">)</span>
        <span class="n">w</span><span class="o">.</span><span class="n">set_on_menu_item_activated</span><span class="p">(</span><span class="n">AppWindow</span><span class="o">.</span><span class="n">MENU_EXPORT</span><span class="p">,</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">_on_menu_export</span><span class="p">)</span>
        <span class="n">w</span><span class="o">.</span><span class="n">set_on_menu_item_activated</span><span class="p">(</span><span class="n">AppWindow</span><span class="o">.</span><span class="n">MENU_QUIT</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_on_menu_quit</span><span class="p">)</span>
        <span class="n">w</span><span class="o">.</span><span class="n">set_on_menu_item_activated</span><span class="p">(</span><span class="n">AppWindow</span><span class="o">.</span><span class="n">MENU_SHOW_SETTINGS</span><span class="p">,</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">_on_menu_toggle_settings_panel</span><span class="p">)</span>
        <span class="n">w</span><span class="o">.</span><span class="n">set_on_menu_item_activated</span><span class="p">(</span><span class="n">AppWindow</span><span class="o">.</span><span class="n">MENU_ABOUT</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_on_menu_about</span><span class="p">)</span>
        <span class="c1"># ----</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_apply_settings</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_apply_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">bg_color</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">bg_color</span><span class="o">.</span><span class="n">red</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">bg_color</span><span class="o">.</span><span class="n">green</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">bg_color</span><span class="o">.</span><span class="n">blue</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">bg_color</span><span class="o">.</span><span class="n">alpha</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scene</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">set_background</span><span class="p">(</span><span class="n">bg_color</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scene</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">show_skybox</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">show_skybox</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scene</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">show_axes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">show_axes</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">new_ibl_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scene</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">set_indirect_light</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">new_ibl_name</span><span class="p">)</span>
            <span class="c1"># Clear new_ibl_name, so we don&#39;t keep reloading this image every</span>
            <span class="c1"># time the settings are applied.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">new_ibl_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scene</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">enable_indirect_light</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">use_ibl</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scene</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">set_indirect_light_intensity</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">ibl_intensity</span><span class="p">)</span>
        <span class="n">sun_color</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">sun_color</span><span class="o">.</span><span class="n">red</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">sun_color</span><span class="o">.</span><span class="n">green</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">sun_color</span><span class="o">.</span><span class="n">blue</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scene</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">set_sun_light</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">sun_dir</span><span class="p">,</span> <span class="n">sun_color</span><span class="p">,</span>
                                              <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">sun_intensity</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scene</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">enable_sun_light</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">use_sun</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">apply_material</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scene</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">update_material</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">material</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">apply_material</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_bg_color</span><span class="o">.</span><span class="n">color_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">bg_color</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_show_skybox</span><span class="o">.</span><span class="n">checked</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">show_skybox</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_show_axes</span><span class="o">.</span><span class="n">checked</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">show_axes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_use_ibl</span><span class="o">.</span><span class="n">checked</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">use_ibl</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_use_sun</span><span class="o">.</span><span class="n">checked</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">use_sun</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ibl_intensity</span><span class="o">.</span><span class="n">int_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">ibl_intensity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sun_intensity</span><span class="o">.</span><span class="n">int_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">sun_intensity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sun_dir</span><span class="o">.</span><span class="n">vector_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">sun_dir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sun_color</span><span class="o">.</span><span class="n">color_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">sun_color</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_material_prefab</span><span class="o">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">shader</span> <span class="o">==</span> <span class="n">Settings</span><span class="o">.</span><span class="n">LIT</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">base_color</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">base_color</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">base_color</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">base_color</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_material_color</span><span class="o">.</span><span class="n">color_value</span> <span class="o">=</span> <span class="n">c</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_point_size</span><span class="o">.</span><span class="n">double_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">point_size</span>

    <span class="k">def</span> <span class="nf">_on_layout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layout_context</span><span class="p">):</span>
        <span class="c1"># The on_layout callback should set the frame (position + size) of every</span>
        <span class="c1"># child correctly. After the callback is done the window will layout</span>
        <span class="c1"># the grandchildren.</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">content_rect</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scene</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">r</span>
        <span class="n">width</span> <span class="o">=</span> <span class="mi">17</span> <span class="o">*</span> <span class="n">layout_context</span><span class="o">.</span><span class="n">theme</span><span class="o">.</span><span class="n">font_size</span>
        <span class="n">height</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
            <span class="n">r</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_settings_panel</span><span class="o">.</span><span class="n">calc_preferred_size</span><span class="p">(</span>
                <span class="n">layout_context</span><span class="p">,</span> <span class="n">gui</span><span class="o">.</span><span class="n">Widget</span><span class="o">.</span><span class="n">Constraints</span><span class="p">())</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_settings_panel</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Rect</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">get_right</span><span class="p">()</span> <span class="o">-</span> <span class="n">width</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span>
                                              <span class="n">height</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_mouse_mode_rotate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scene</span><span class="o">.</span><span class="n">set_view_controls</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">SceneWidget</span><span class="o">.</span><span class="n">Controls</span><span class="o">.</span><span class="n">ROTATE_CAMERA</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_mouse_mode_fly</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scene</span><span class="o">.</span><span class="n">set_view_controls</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">SceneWidget</span><span class="o">.</span><span class="n">Controls</span><span class="o">.</span><span class="n">FLY</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_mouse_mode_sun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scene</span><span class="o">.</span><span class="n">set_view_controls</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">SceneWidget</span><span class="o">.</span><span class="n">Controls</span><span class="o">.</span><span class="n">ROTATE_SUN</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_mouse_mode_ibl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scene</span><span class="o">.</span><span class="n">set_view_controls</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">SceneWidget</span><span class="o">.</span><span class="n">Controls</span><span class="o">.</span><span class="n">ROTATE_IBL</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_mouse_mode_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scene</span><span class="o">.</span><span class="n">set_view_controls</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">SceneWidget</span><span class="o">.</span><span class="n">Controls</span><span class="o">.</span><span class="n">ROTATE_MODEL</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_on_bg_color</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_color</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">bg_color</span> <span class="o">=</span> <span class="n">new_color</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_apply_settings</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_on_show_skybox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">show</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">show_skybox</span> <span class="o">=</span> <span class="n">show</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_apply_settings</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_on_show_axes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">show</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">show_axes</span> <span class="o">=</span> <span class="n">show</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_apply_settings</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_on_use_ibl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">use</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">use_ibl</span> <span class="o">=</span> <span class="n">use</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_profiles</span><span class="o">.</span><span class="n">selected_text</span> <span class="o">=</span> <span class="n">Settings</span><span class="o">.</span><span class="n">CUSTOM_PROFILE_NAME</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_apply_settings</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_on_use_sun</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">use</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">use_sun</span> <span class="o">=</span> <span class="n">use</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_profiles</span><span class="o">.</span><span class="n">selected_text</span> <span class="o">=</span> <span class="n">Settings</span><span class="o">.</span><span class="n">CUSTOM_PROFILE_NAME</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_apply_settings</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_on_lighting_profile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">!=</span> <span class="n">Settings</span><span class="o">.</span><span class="n">CUSTOM_PROFILE_NAME</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">apply_lighting_profile</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_apply_settings</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_on_new_ibl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">new_ibl_name</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Application</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">resource_path</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_profiles</span><span class="o">.</span><span class="n">selected_text</span> <span class="o">=</span> <span class="n">Settings</span><span class="o">.</span><span class="n">CUSTOM_PROFILE_NAME</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_apply_settings</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_on_ibl_intensity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">intensity</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">ibl_intensity</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">intensity</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_profiles</span><span class="o">.</span><span class="n">selected_text</span> <span class="o">=</span> <span class="n">Settings</span><span class="o">.</span><span class="n">CUSTOM_PROFILE_NAME</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_apply_settings</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_on_sun_intensity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">intensity</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">sun_intensity</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">intensity</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_profiles</span><span class="o">.</span><span class="n">selected_text</span> <span class="o">=</span> <span class="n">Settings</span><span class="o">.</span><span class="n">CUSTOM_PROFILE_NAME</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_apply_settings</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_on_sun_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sun_dir</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">sun_dir</span> <span class="o">=</span> <span class="n">sun_dir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_profiles</span><span class="o">.</span><span class="n">selected_text</span> <span class="o">=</span> <span class="n">Settings</span><span class="o">.</span><span class="n">CUSTOM_PROFILE_NAME</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_apply_settings</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_on_sun_color</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">color</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">sun_color</span> <span class="o">=</span> <span class="n">color</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_apply_settings</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_on_shader</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">set_material</span><span class="p">(</span><span class="n">AppWindow</span><span class="o">.</span><span class="n">MATERIAL_SHADERS</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_apply_settings</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_on_material_prefab</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">apply_material_prefab</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">apply_material</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_apply_settings</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_on_material_color</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">color</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">base_color</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">color</span><span class="o">.</span><span class="n">red</span><span class="p">,</span> <span class="n">color</span><span class="o">.</span><span class="n">green</span><span class="p">,</span> <span class="n">color</span><span class="o">.</span><span class="n">blue</span><span class="p">,</span> <span class="n">color</span><span class="o">.</span><span class="n">alpha</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">apply_material</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_apply_settings</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_on_point_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">point_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">apply_material</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_apply_settings</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_on_menu_open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">dlg</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">FileDialog</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">FileDialog</span><span class="o">.</span><span class="n">OPEN</span><span class="p">,</span> <span class="s2">&quot;Choose file to load&quot;</span><span class="p">,</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">theme</span><span class="p">)</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">add_filter</span><span class="p">(</span>
            <span class="s2">&quot;.ply .stl .fbx .obj .off .gltf .glb&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Triangle mesh files (.ply, .stl, .fbx, .obj, .off, &quot;</span>
            <span class="s2">&quot;.gltf, .glb)&quot;</span><span class="p">)</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">add_filter</span><span class="p">(</span>
            <span class="s2">&quot;.xyz .xyzn .xyzrgb .ply .pcd .pts&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Point cloud files (.xyz, .xyzn, .xyzrgb, .ply, &quot;</span>
            <span class="s2">&quot;.pcd, .pts)&quot;</span><span class="p">)</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">add_filter</span><span class="p">(</span><span class="s2">&quot;.ply&quot;</span><span class="p">,</span> <span class="s2">&quot;Polygon files (.ply)&quot;</span><span class="p">)</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">add_filter</span><span class="p">(</span><span class="s2">&quot;.stl&quot;</span><span class="p">,</span> <span class="s2">&quot;Stereolithography files (.stl)&quot;</span><span class="p">)</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">add_filter</span><span class="p">(</span><span class="s2">&quot;.fbx&quot;</span><span class="p">,</span> <span class="s2">&quot;Autodesk Filmbox files (.fbx)&quot;</span><span class="p">)</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">add_filter</span><span class="p">(</span><span class="s2">&quot;.obj&quot;</span><span class="p">,</span> <span class="s2">&quot;Wavefront OBJ files (.obj)&quot;</span><span class="p">)</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">add_filter</span><span class="p">(</span><span class="s2">&quot;.off&quot;</span><span class="p">,</span> <span class="s2">&quot;Object file format (.off)&quot;</span><span class="p">)</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">add_filter</span><span class="p">(</span><span class="s2">&quot;.gltf&quot;</span><span class="p">,</span> <span class="s2">&quot;OpenGL transfer files (.gltf)&quot;</span><span class="p">)</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">add_filter</span><span class="p">(</span><span class="s2">&quot;.glb&quot;</span><span class="p">,</span> <span class="s2">&quot;OpenGL binary transfer files (.glb)&quot;</span><span class="p">)</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">add_filter</span><span class="p">(</span><span class="s2">&quot;.xyz&quot;</span><span class="p">,</span> <span class="s2">&quot;ASCII point cloud files (.xyz)&quot;</span><span class="p">)</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">add_filter</span><span class="p">(</span><span class="s2">&quot;.xyzn&quot;</span><span class="p">,</span> <span class="s2">&quot;ASCII point cloud with normals (.xyzn)&quot;</span><span class="p">)</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">add_filter</span><span class="p">(</span><span class="s2">&quot;.xyzrgb&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;ASCII point cloud files with colors (.xyzrgb)&quot;</span><span class="p">)</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">add_filter</span><span class="p">(</span><span class="s2">&quot;.pcd&quot;</span><span class="p">,</span> <span class="s2">&quot;Point Cloud Data files (.pcd)&quot;</span><span class="p">)</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">add_filter</span><span class="p">(</span><span class="s2">&quot;.pts&quot;</span><span class="p">,</span> <span class="s2">&quot;3D Points files (.pts)&quot;</span><span class="p">)</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">add_filter</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;All files&quot;</span><span class="p">)</span>

        <span class="c1"># A file dialog MUST define on_cancel and on_done functions</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">set_on_cancel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_file_dialog_cancel</span><span class="p">)</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">set_on_done</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_load_dialog_done</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">show_dialog</span><span class="p">(</span><span class="n">dlg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_on_file_dialog_cancel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">close_dialog</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_on_load_dialog_done</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">close_dialog</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_on_menu_export</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">dlg</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">FileDialog</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">FileDialog</span><span class="o">.</span><span class="n">SAVE</span><span class="p">,</span> <span class="s2">&quot;Choose file to save&quot;</span><span class="p">,</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">theme</span><span class="p">)</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">add_filter</span><span class="p">(</span><span class="s2">&quot;.png&quot;</span><span class="p">,</span> <span class="s2">&quot;PNG files (.png)&quot;</span><span class="p">)</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">set_on_cancel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_file_dialog_cancel</span><span class="p">)</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">set_on_done</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_export_dialog_done</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">show_dialog</span><span class="p">(</span><span class="n">dlg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_on_export_dialog_done</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">close_dialog</span><span class="p">()</span>
        <span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scene</span><span class="o">.</span><span class="n">frame</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">export_image</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">frame</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">frame</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_on_menu_quit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">gui</span><span class="o">.</span><span class="n">Application</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_on_menu_toggle_settings_panel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_settings_panel</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings_panel</span><span class="o">.</span><span class="n">visible</span>
        <span class="n">gui</span><span class="o">.</span><span class="n">Application</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">menubar</span><span class="o">.</span><span class="n">set_checked</span><span class="p">(</span>
            <span class="n">AppWindow</span><span class="o">.</span><span class="n">MENU_SHOW_SETTINGS</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings_panel</span><span class="o">.</span><span class="n">visible</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_on_menu_about</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Show a simple dialog. Although the Dialog is actually a widget, you can</span>
        <span class="c1"># treat it similar to a Window for layout and put all the widgets in a</span>
        <span class="c1"># layout which you make the only child of the Dialog.</span>
        <span class="n">em</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">theme</span><span class="o">.</span><span class="n">font_size</span>
        <span class="n">dlg</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Dialog</span><span class="p">(</span><span class="s2">&quot;About&quot;</span><span class="p">)</span>

        <span class="c1"># Add the text</span>
        <span class="n">dlg_layout</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Vert</span><span class="p">(</span><span class="n">em</span><span class="p">,</span> <span class="n">gui</span><span class="o">.</span><span class="n">Margins</span><span class="p">(</span><span class="n">em</span><span class="p">,</span> <span class="n">em</span><span class="p">,</span> <span class="n">em</span><span class="p">,</span> <span class="n">em</span><span class="p">))</span>
        <span class="n">dlg_layout</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="s2">&quot;Open3D GUI Example&quot;</span><span class="p">))</span>

        <span class="c1"># Add the Ok button. We need to define a callback function to handle</span>
        <span class="c1"># the click.</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="s2">&quot;OK&quot;</span><span class="p">)</span>
        <span class="n">ok</span><span class="o">.</span><span class="n">set_on_clicked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_about_ok</span><span class="p">)</span>

        <span class="c1"># We want the Ok button to be an the right side, so we need to add</span>
        <span class="c1"># a stretch item to the layout, otherwise the button will be the size</span>
        <span class="c1"># of the entire row. A stretch item takes up as much space as it can,</span>
        <span class="c1"># which forces the button to be its minimum size.</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">Horiz</span><span class="p">()</span>
        <span class="n">h</span><span class="o">.</span><span class="n">add_stretch</span><span class="p">()</span>
        <span class="n">h</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">ok</span><span class="p">)</span>
        <span class="n">h</span><span class="o">.</span><span class="n">add_stretch</span><span class="p">()</span>
        <span class="n">dlg_layout</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>

        <span class="n">dlg</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">dlg_layout</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">show_dialog</span><span class="p">(</span><span class="n">dlg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_on_about_ok</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">close_dialog</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scene</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">clear_geometry</span><span class="p">()</span>

        <span class="n">geometry</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">geometry_type</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_file_geometry_type</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="n">mesh</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">geometry_type</span> <span class="o">&amp;</span> <span class="n">o3d</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">CONTAINS_TRIANGLES</span><span class="p">:</span>
            <span class="n">mesh</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_triangle_model</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mesh</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Info]&quot;</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="s2">&quot;appears to be a point cloud&quot;</span><span class="p">)</span>
            <span class="n">cloud</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">cloud</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_point_cloud</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">if</span> <span class="n">cloud</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Info] Successfully read&quot;</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">cloud</span><span class="o">.</span><span class="n">has_normals</span><span class="p">():</span>
                    <span class="n">cloud</span><span class="o">.</span><span class="n">estimate_normals</span><span class="p">()</span>
                <span class="n">cloud</span><span class="o">.</span><span class="n">normalize_normals</span><span class="p">()</span>
                <span class="n">geometry</span> <span class="o">=</span> <span class="n">cloud</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[WARNING] Failed to read points&quot;</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">geometry</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">mesh</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">mesh</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="c1"># Triangle model</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_scene</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">add_model</span><span class="p">(</span><span class="s2">&quot;__model__&quot;</span><span class="p">,</span> <span class="n">mesh</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Point cloud</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_scene</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">add_geometry</span><span class="p">(</span><span class="s2">&quot;__model__&quot;</span><span class="p">,</span> <span class="n">geometry</span><span class="p">,</span>
                                                   <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">material</span><span class="p">)</span>
                <span class="n">bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scene</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">bounding_box</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_scene</span><span class="o">.</span><span class="n">setup_camera</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="n">bounds</span><span class="p">,</span> <span class="n">bounds</span><span class="o">.</span><span class="n">get_center</span><span class="p">())</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">export_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">on_image</span><span class="p">(</span><span class="n">image</span><span class="p">):</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">image</span>

            <span class="n">quality</span> <span class="o">=</span> <span class="mi">9</span>  <span class="c1"># png</span>
            <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.jpg&quot;</span><span class="p">):</span>
                <span class="n">quality</span> <span class="o">=</span> <span class="mi">100</span>
            <span class="n">o3d</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">write_image</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="n">quality</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_scene</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">render_to_image</span><span class="p">(</span><span class="n">on_image</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="c1"># We need to initialize the application, which finds the necessary shaders</span>
    <span class="c1"># for rendering and prepares the cross-platform window abstraction.</span>
    <span class="n">gui</span><span class="o">.</span><span class="n">Application</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>

    <span class="n">w</span> <span class="o">=</span> <span class="n">AppWindow</span><span class="p">(</span><span class="mi">1024</span><span class="p">,</span> <span class="mi">768</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="n">w</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">w</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">show_message_box</span><span class="p">(</span><span class="s2">&quot;Error&quot;</span><span class="p">,</span>
                                      <span class="s2">&quot;Could not open file &#39;&quot;</span> <span class="o">+</span> <span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>

    <span class="c1"># Run the event loop. This will not return until the last window is closed.</span>
    <span class="n">gui</span><span class="o">.</span><span class="n">Application</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div></td></tr></table></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="../utility/index.html" class="btn btn-neutral float-left" title="Utility" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018 - 2021, www.open3d.org

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org/">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
<span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Docs version</span>
    0.17.0
    <span class="fa fa-caret-down"></span>
</span>

<!-- A hack to include an external page to get around CORS policy -->
<!-- https://stackoverflow.com/a/15250208/1255535 -->
<div class="rst-other-versions">
    <dl>
    <dt>Versions</dt>
        <dd><ul>
            <script src="../../../versions.js"></script>
        </ul></dd>
    </dl>
</div>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>

<!-- Mirrored from www.open3d.org/docs/release/python_example/visualization/index.html by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 14 May 2023 10:14:40 GMT -->
</html>